<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>services/email.service.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AdminController.html">AdminController</a></li><li><a href="AdminModel.html">AdminModel</a></li><li><a href="AdminService.html">AdminService</a></li><li><a href="AulaController.html">AulaController</a></li><li><a href="AulaModel.html">AulaModel</a></li><li><a href="AulaService.html">AulaService</a></li><li><a href="CoordinadorController.html">CoordinadorController</a></li><li><a href="CoordinadorService.html">CoordinadorService</a></li><li><a href="CurricularController.html">CurricularController</a></li><li><a href="CurricularModel.html">CurricularModel</a></li><li><a href="CurricularService.html">CurricularService</a></li><li><a href="DocumentServices.html">DocumentServices</a><ul class='methods'><li data-type='method'><a href="DocumentServices.html#.crearCeldaEstilizada">crearCeldaEstilizada</a></li><li data-type='method'><a href="DocumentServices.html#.crearDocumentoHorario">crearDocumentoHorario</a></li><li data-type='method'><a href="DocumentServices.html#.crearFilaInformacion">crearFilaInformacion</a></li><li data-type='method'><a href="DocumentServices.html#.crearFilasTabla">crearFilasTabla</a></li><li data-type='method'><a href="DocumentServices.html#.crearParrafoEstilizado">crearParrafoEstilizado</a></li><li data-type='method'><a href="DocumentServices.html#.crearTextoEstilizado">crearTextoEstilizado</a></li><li data-type='method'><a href="DocumentServices.html#.generarDocumentoHorario">generarDocumentoHorario</a></li><li data-type='method'><a href="DocumentServices.html#.generarHorasDisponibles">generarHorasDisponibles</a></li><li data-type='method'><a href="DocumentServices.html#.procesarHorario">procesarHorario</a></li><li data-type='method'><a href="DocumentServices.html#.traerLogoMarcaAgua">traerLogoMarcaAgua</a></li></ul></li><li><a href="EmailService.html">EmailService</a></li><li><a href="FormatterResponseController.html">FormatterResponseController</a></li><li><a href="FormatterResponseModel.html">FormatterResponseModel</a></li><li><a href="FormatterResponseService.html">FormatterResponseService</a></li><li><a href="HorarioController.html">HorarioController</a></li><li><a href="HorarioService.html">HorarioService</a></li><li><a href="NotificationController.html">NotificationController</a></li><li><a href="ProfesorController.html">ProfesorController</a></li><li><a href="ProfesorModel.html">ProfesorModel</a></li><li><a href="ProfesorService.html">ProfesorService</a></li><li><a href="SedeController.html">SedeController</a></li><li><a href="SedeModel.html">SedeModel</a></li><li><a href="SedeService.html">SedeService</a></li><li><a href="SystemController.html">SystemController</a></li><li><a href="SystemModel.html">SystemModel</a></li><li><a href="UserController.html">UserController</a></li><li><a href="UserModel.html">UserModel</a></li><li><a href="UserService.html">UserService</a></li><li><a href="ValidationService.html">ValidationService</a></li><li><a href="module.exports_module.exports.html">exports</a></li></ul><h3>Modules</h3><ul><li><a href="module-CoordinadorModel.html">CoordinadorModel</a><ul class='methods'><li data-type='method'><a href="module-CoordinadorModel.html#.actualizarCoordinador">actualizarCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.asignarCoordinador">asignarCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.destituirCoordinador">destituirCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerCoordinador">obtenerCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerCoordinadorPorId">obtenerCoordinadorPorId</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerCoordinadorPorPnf">obtenerCoordinadorPorPnf</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerCoordinadoresActivos">obtenerCoordinadoresActivos</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerDatosCoordinadorCompletos">obtenerDatosCoordinadorCompletos</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerHistorialCoordinador">obtenerHistorialCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerHistorialDestituciones">obtenerHistorialDestituciones</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerTodos">obtenerTodos</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.reasignarCoordinador">reasignarCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.restituirCoordinador">restituirCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.validarCoordinadorActivo">validarCoordinadorActivo</a></li></ul></li><li><a href="module-CurricularRouter.html">CurricularRouter</a></li><li><a href="module-passwordUtils.html">passwordUtils</a><ul class='methods'><li data-type='method'><a href="module-passwordUtils.html#~comparePassword">comparePassword</a></li><li data-type='method'><a href="module-passwordUtils.html#~generarPassword">generarPassword</a></li><li data-type='method'><a href="module-passwordUtils.html#~hashPassword">hashPassword</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html">CrearSecciones</a></li><li><a href="global.html#DELETE/admins/:id">DELETE /admins/:id</a></li><li><a href="global.html#DELETE/aulas/:id">DELETE /aulas/:id</a></li><li><a href="global.html#DELETE/coordinadores/:id/destituir">DELETE /coordinadores/:id/destituir</a></li><li><a href="global.html#DELETE/horarios/:id">DELETE /horarios/:id</a></li><li><a href="global.html#DELETE/profesores/:id">DELETE /profesores/:id</a></li><li><a href="global.html#DELETE/profesores/:id_profesor/disponibilidad/:id_disponibilidad">DELETE /profesores/:id_profesor/disponibilidad/:id_disponibilidad</a></li><li><a href="global.html#DELETE/sedes/:id">DELETE /sedes/:id</a></li><li><a href="global.html#DELETE/system/backups/:backupFileName">DELETE /system/backups/:backupFileName</a></li><li><a href="global.html#DELETE/system/backups/cleanup">DELETE /system/backups/cleanup</a></li><li><a href="global.html#DELETE/user/:id_usuario/desactivar">DELETE /user/:id_usuario/desactivar</a></li><li><a href="global.html#EMAIL_CONFIG">EMAIL_CONFIG</a></li><li><a href="global.html#EnviarTokenEmail">EnviarTokenEmail</a></li><li><a href="global.html#GET/admin/logs">GET /admin/logs</a></li><li><a href="global.html#GET/admin/profile">GET /admin/profile</a></li><li><a href="global.html#GET/admin/reports">GET /admin/reports</a></li><li><a href="global.html#GET/admin/stats">GET /admin/stats</a></li><li><a href="global.html#GET/admins">GET /admins</a></li><li><a href="global.html#GET/admins/search">GET /admins/search</a></li><li><a href="global.html#GET/api/aulas">GET /api/aulas</a></li><li><a href="global.html#GET/api/profesores">GET /api/profesores</a></li><li><a href="global.html#GET/api/system/backups">GET /api/system/backups</a></li><li><a href="global.html#GET/api/system/estadisticas">GET /api/system/estadisticas</a></li><li><a href="global.html#GET/api/system/metricas">GET /api/system/metricas</a></li><li><a href="global.html#GET/api/system/status">GET /api/system/status</a></li><li><a href="global.html#GET/auditory/system">GET /auditory/system</a></li><li><a href="global.html#GET/aulas">GET /aulas</a></li><li><a href="global.html#GET/aulas/:id">GET /aulas/:id</a></li><li><a href="global.html#GET/aulas/pnf/:codigoPNF">GET /aulas/pnf/:codigoPNF</a></li><li><a href="global.html#GET/aulas/sede/:sede">GET /aulas/sede/:sede</a></li><li><a href="global.html#GET/aulas/tipo/:tipo">GET /aulas/tipo/:tipo</a></li><li><a href="global.html#GET/auth/verify">GET /auth/verify</a></li><li><a href="global.html#GET/catalogos/areas-conocimiento">GET /catalogos/areas-conocimiento</a></li><li><a href="global.html#GET/catalogos/posgrados">GET /catalogos/posgrados</a></li><li><a href="global.html#GET/catalogos/pregrados">GET /catalogos/pregrados</a></li><li><a href="global.html#GET/coordinadores">GET /coordinadores</a></li><li><a href="global.html#GET/coordinadores/:id">GET /coordinadores/:id</a></li><li><a href="global.html#GET/coordinadores/:id/historial-destituciones">GET /coordinadores/:id/historial-destituciones</a></li><li><a href="global.html#GET/coordinadores/destituidos">GET /coordinadores/destituidos</a></li><li><a href="global.html#GET/exportar/seccion/:id_seccion">GET /exportar/seccion/:id_seccion</a></li><li><a href="global.html#GET/horarios/aula/:id_aula">GET /horarios/aula/:id_aula</a></li><li><a href="global.html#GET/horarios/profesor/:id_profesor">GET /horarios/profesor/:id_profesor</a></li><li><a href="global.html#GET/horarios/seccion/:id_seccion">GET /horarios/seccion/:id_seccion</a></li><li><a href="global.html#GET/notifications">GET /notifications</a></li><li><a href="global.html#GET/profesores">GET /profesores</a></li><li><a href="global.html#GET/profesores/:id">GET /profesores/:id</a></li><li><a href="global.html#GET/profesores/:id/imagen">GET /profesores/:id/imagen</a></li><li><a href="global.html#GET/profesores/search">GET /profesores/search</a></li><li><a href="global.html#GET/profile">GET /profile</a></li><li><a href="global.html#GET/sedes">GET /sedes</a></li><li><a href="global.html#GET/sedes/:id">GET /sedes/:id</a></li><li><a href="global.html#GET/system/backups">GET /system/backups</a></li><li><a href="global.html#GET/system/backups/download/:backupFileName">GET /system/backups/download/:backupFileName</a></li><li><a href="global.html#GET/system/estado">GET /system/estado</a></li><li><a href="global.html#GET/system/info">GET /system/info</a></li><li><a href="global.html#GET/system/logs">GET /system/logs</a></li><li><a href="global.html#GET/system/mapa-calor/horarios">GET /system/mapa-calor/horarios</a></li><li><a href="global.html#GET/system/metricas/academicas">GET /system/metricas/academicas</a></li><li><a href="global.html#GET/system/metricas/sistema">GET /system/metricas/sistema</a></li><li><a href="global.html#GET/system/reportes/estadisticas">GET /system/reportes/estadisticas</a></li><li><a href="global.html">GuardarTokenEmail</a></li><li><a href="global.html#PATCH/admins/:id/rol">PATCH /admins/:id/rol</a></li><li><a href="global.html#POST/admins">POST /admins</a></li><li><a href="global.html#POST/aulas">POST /aulas</a></li><li><a href="global.html#POST/aulas/to/horarios">POST /aulas/to/horarios</a></li><li><a href="global.html#POST/auth/login">POST /auth/login</a></li><li><a href="global.html#POST/catalogos/areas-conocimiento">POST /catalogos/areas-conocimiento</a></li><li><a href="global.html#POST/catalogos/posgrados">POST /catalogos/posgrados</a></li><li><a href="global.html#POST/catalogos/pregrados">POST /catalogos/pregrados</a></li><li><a href="global.html#POST/coordinadores">POST /coordinadores</a></li><li><a href="global.html#POST/coordinadores/:id/restitur">POST /coordinadores/:id/restitur</a></li><li><a href="global.html#POST/horarios">POST /horarios</a></li><li><a href="global.html#POST/profesores">POST /profesores</a></li><li><a href="global.html#POST/profesores/:id/disponibilidad">POST /profesores/:id/disponibilidad</a></li><li><a href="global.html#POST/profesores/:id/reingresar">POST /profesores/:id/reingresar</a></li><li><a href="global.html#POST/profesores/to/seccion/:id_seccion">POST /profesores/to/seccion/:id_seccion</a></li><li><a href="global.html#POST/sedes">POST /sedes</a></li><li><a href="global.html#POST/system/backup">POST /system/backup</a></li><li><a href="global.html#POST/system/backup/manual">POST /system/backup/manual</a></li><li><a href="global.html#POST/system/restore">POST /system/restore</a></li><li><a href="global.html#PUT/admin/profile">PUT /admin/profile</a></li><li><a href="global.html#PUT/admins/:id">PUT /admins/:id</a></li><li><a href="global.html#PUT/aulas/:id">PUT /aulas/:id</a></li><li><a href="global.html#PUT/auth/password">PUT /auth/password</a></li><li><a href="global.html#PUT/coordinadores/:cedula/reasignar-pnf">PUT /coordinadores/:cedula/reasignar-pnf</a></li><li><a href="global.html#PUT/coordinadores/:id">PUT /coordinadores/:id</a></li><li><a href="global.html#PUT/horarios/:id">PUT /horarios/:id</a></li><li><a href="global.html#PUT/profesores/:id">PUT /profesores/:id</a></li><li><a href="global.html#PUT/profesores/:id_profesor/disponibilidad">PUT /profesores/:id_profesor/disponibilidad</a></li><li><a href="global.html#PUT/sedes/:id">PUT /sedes/:id</a></li><li><a href="global.html#PUT/user/:id_usuario/activar">PUT /user/:id_usuario/activar</a></li><li><a href="global.html">VerificarToken</a></li><li><a href="global.html">activar</a></li><li><a href="global.html">activarUsuario</a></li><li><a href="global.html">actualizar</a></li><li><a href="global.html">actualizarAdmin</a></li><li><a href="global.html">actualizarAula</a></li><li><a href="global.html">actualizarContrase√±aYLimpiarToken</a></li><li><a href="global.html">actualizarCoordinador</a></li><li><a href="global.html">actualizarDescripcionTrayecto</a></li><li><a href="global.html">actualizarDisponibilidad</a></li><li><a href="global.html#actualizarHorario">actualizarHorario</a></li><li><a href="global.html">actualizarPNF</a></li><li><a href="global.html">actualizarPerfil</a></li><li><a href="global.html#actualizarProfesor">actualizarProfesor</a></li><li><a href="global.html">actualizarSede</a></li><li><a href="global.html">actualizarUltimoAcceso</a></li><li><a href="global.html">actualizarUnidadCurricular</a></li><li><a href="global.html#agregarRolDestinatario">agregarRolDestinatario</a></li><li><a href="global.html#agregarUsuarioDestinatario">agregarUsuarioDestinatario</a></li><li><a href="global.html#asegurarStringEnMinusculas">asegurarStringEnMinusculas</a></li><li><a href="global.html">asignacionTurnoSeccion</a></li><li><a href="global.html">asignarCoordinador</a></li><li><a href="global.html">asignarTurnoSeccion</a></li><li><a href="global.html">buscar</a></li><li><a href="global.html">buscarAdmin</a></li><li><a href="global.html">buscarPorEmail</a></li><li><a href="global.html">buscarPorId</a></li><li><a href="global.html#buscarProfesor">buscarProfesor</a></li><li><a href="global.html">cambiarContrase√±a</a></li><li><a href="global.html">cambiarRol</a></li><li><a href="global.html">cambiarRolAdmin</a></li><li><a href="global.html">cerrarSesion</a></li><li><a href="global.html#closeSession">closeSession</a></li><li><a href="global.html">conflict</a></li><li><a href="global.html#connectDB">connectDB</a></li><li><a href="global.html">contarPorRolYEstado</a></li><li><a href="global.html#corsOptions">corsOptions</a></li><li><a href="global.html">crear</a></li><li><a href="global.html">crearAreaConocimiento</a></li><li><a href="global.html">crearDisponibilidad</a></li><li><a href="global.html#crearNotificacionCompleta">crearNotificacionCompleta</a></li><li><a href="global.html#crearNotificacionIndividual">crearNotificacionIndividual</a></li><li><a href="global.html#crearNotificacionMasiva">crearNotificacionMasiva</a></li><li><a href="global.html">crearPosgrado</a></li><li><a href="global.html">crearPregrado</a></li><li><a href="global.html">crearRespaldo</a></li><li><a href="global.html">crearSecciones</a></li><li><a href="global.html#crearSede">crearSede</a></li><li><a href="global.html#createValidationResponse">createValidationResponse</a></li><li><a href="global.html">created</a></li><li><a href="global.html">desactivar</a></li><li><a href="global.html">desactivarAdmin</a></li><li><a href="global.html">desactivarUsuario</a></li><li><a href="global.html#descargarRespaldo">descargarRespaldo</a></li><li><a href="global.html#destituirProfesor">destituirProfesor</a></li><li><a href="global.html#disconnectDB">disconnectDB</a></li><li><a href="global.html">eliminar</a></li><li><a href="global.html">eliminarAula</a></li><li><a href="global.html">eliminarCoordinador</a></li><li><a href="global.html">eliminarDisponibilidad</a></li><li><a href="global.html#eliminarHorario">eliminarHorario</a></li><li><a href="global.html">eliminarPnf</a></li><li><a href="global.html">eliminarRespaldo</a></li><li><a href="global.html">eliminarSede</a></li><li><a href="global.html">eliminarUnidadCurricular</a></li><li><a href="global.html#enviarEmail">enviarEmail</a></li><li><a href="global.html#enviarEmailMultiple">enviarEmailMultiple</a></li><li><a href="global.html">error</a></li><li><a href="global.html#exportarHorarioWord">exportarHorarioWord</a></li><li><a href="global.html">extractData</a></li><li><a href="global.html">extractError</a></li><li><a href="global.html">filtrarPorEstado</a></li><li><a href="global.html">filtrarPorRol</a></li><li><a href="global.html">filtrarPorSede</a></li><li><a href="global.html">filtrarPorTipo</a></li><li><a href="global.html">forbidden</a></li><li><a href="global.html">formatValidationErrors</a></li><li><a href="global.html">fromDatabaseResponse</a></li><li><a href="global.html#generarDocumentoHorario">generarDocumentoHorario</a></li><li><a href="global.html#generateEmailTemplate">generateEmailTemplate</a></li><li><a href="global.html#get/auth/logout">get /auth/logout</a></li><li><a href="global.html#getCookie">getCookie</a></li><li><a href="global.html">getDefaultTitle</a></li><li><a href="global.html">getErrorCode</a></li><li><a href="global.html#getFilterCondition">getFilterCondition</a></li><li><a href="global.html#getImageProfesorDirect">getImageProfesorDirect</a></li><li><a href="global.html">getMinimalFallback</a></li><li><a href="global.html">getProfile</a></li><li><a href="global.html">getTranslation</a></li><li><a href="global.html">isError</a></li><li><a href="global.html">isSuccess</a></li><li><a href="global.html#joinRoleRooms">joinRoleRooms</a></li><li><a href="global.html#jsonSyntaxErrorHandler">jsonSyntaxErrorHandler</a></li><li><a href="global.html">limpiarRespaldosAntiguos</a></li><li><a href="global.html">listarCoordinadores</a></li><li><a href="global.html">listarCoordinadoresDestituidos</a></li><li><a href="global.html">listarRespaldos</a></li><li><a href="global.html#listenNotifications">listenNotifications</a></li><li><a href="global.html#loadEnv">loadEnv</a></li><li><a href="global.html">login</a></li><li><a href="global.html">loginUser</a></li><li><a href="global.html">manejarServicio</a></li><li><a href="global.html">marcarComoLeida</a></li><li><a href="global.html#markAsRead">markAsRead</a></li><li><a href="global.html#middlewareAuth">middlewareAuth</a></li><li><a href="global.html">mostrarAdmin</a></li><li><a href="global.html#mostrarAreasConocimiento">mostrarAreasConocimiento</a></li><li><a href="global.html#mostrarAulaCambiarHorario">mostrarAulaCambiarHorario</a></li><li><a href="global.html">mostrarAulas</a></li><li><a href="global.html#mostrarAulasParaHorario">mostrarAulasParaHorario</a></li><li><a href="global.html">mostrarDisponibilidad</a></li><li><a href="global.html#mostrarHorariosPorAula">mostrarHorariosPorAula</a></li><li><a href="global.html#mostrarHorariosPorSeccion">mostrarHorariosPorSeccion</a></li><li><a href="global.html#mostrarHorariosProfesores">mostrarHorariosProfesores</a></li><li><a href="global.html">mostrarLineasInvestigacion</a></li><li><a href="global.html">mostrarNotificacion</a></li><li><a href="global.html">mostrarPNF</a></li><li><a href="global.html#mostrarPosGrados">mostrarPosGrados</a></li><li><a href="global.html#mostrarPreGrados">mostrarPreGrados</a></li><li><a href="global.html#mostrarProfesor">mostrarProfesor</a></li><li><a href="global.html#mostrarProfesorAPI">mostrarProfesorAPI</a></li><li><a href="global.html#mostrarProfesorCambiarHorario">mostrarProfesorCambiarHorario</a></li><li><a href="global.html">mostrarProfesoresEliminados</a></li><li><a href="global.html#mostrarProfesoresParaHorario">mostrarProfesoresParaHorario</a></li><li><a href="global.html">mostrarSecciones</a></li><li><a href="global.html">mostrarSeccionesByPnfAndValueTrayecto</a></li><li><a href="global.html">mostrarSeccionesByPnfAndValueUnidadCurricular</a></li><li><a href="global.html">mostrarSedes</a></li><li><a href="global.html">mostrarTrayectos</a></li><li><a href="global.html">mostrarTurnos</a></li><li><a href="global.html">mostrarUnidadesCurriculares</a></li><li><a href="global.html">notFound</a></li><li><a href="global.html">obtenerAdminPorId</a></li><li><a href="global.html">obtenerAdminsPorEstado</a></li><li><a href="global.html">obtenerAdminsPorRol</a></li><li><a href="global.html">obtenerAreasConocimiento</a></li><li><a href="global.html#obtenerAuditoria">obtenerAuditoria</a></li><li><a href="global.html">obtenerAuditoriaCompleta</a></li><li><a href="global.html">obtenerAulaPorId</a></li><li><a href="global.html">obtenerAulasDisponibles</a></li><li><a href="global.html">obtenerAulasPorPnf</a></li><li><a href="global.html">obtenerAulasPorSede</a></li><li><a href="global.html">obtenerAulasPorTipo</a></li><li><a href="global.html">obtenerConFiltros</a></li><li><a href="global.html">obtenerCoordinador</a></li><li><a href="global.html">obtenerEstadoSistema</a></li><li><a href="global.html">obtenerHistorialDestituciones</a></li><li><a href="global.html#obtenerHorariosPorAula">obtenerHorariosPorAula</a></li><li><a href="global.html#obtenerHorariosPorProfesor">obtenerHorariosPorProfesor</a></li><li><a href="global.html#obtenerHorariosPorSeccion">obtenerHorariosPorSeccion</a></li><li><a href="global.html#obtenerIdUSerProfesor">obtenerIdUSerProfesor</a></li><li><a href="global.html">obtenerImagen</a></li><li><a href="global.html#obtenerInformacionSistema">obtenerInformacionSistema</a></li><li><a href="global.html#obtenerLogsSistema">obtenerLogsSistema</a></li><li><a href="global.html">obtenerMapaCalorHorarios</a></li><li><a href="global.html#obtenerMapaCalorOcupacion">obtenerMapaCalorOcupacion</a></li><li><a href="global.html">obtenerMetricasAcademicas</a></li><li><a href="global.html">obtenerMetricasSistema</a></li><li><a href="global.html">obtenerPerfil</a></li><li><a href="global.html#obtenerPorAula">obtenerPorAula</a></li><li><a href="global.html#obtenerPorId">obtenerPorId</a></li><li><a href="global.html#obtenerPorProfesor">obtenerPorProfesor</a></li><li><a href="global.html#obtenerPorSeccion">obtenerPorSeccion</a></li><li><a href="global.html">obtenerPosgrados</a></li><li><a href="global.html">obtenerPregrados</a></li><li><a href="global.html#obtenerProfesoresDisponibles">obtenerProfesoresDisponibles</a></li><li><a href="global.html">obtenerReportesEstadisticas</a></li><li><a href="global.html">obtenerRolesDisponibles</a></li><li><a href="global.html">obtenerSedePorId</a></li><li><a href="global.html">obtenerTodas</a></li><li><a href="global.html">obtenerTodos</a></li><li><a href="global.html">obtenerUnidadCurricularPorId</a></li><li><a href="global.html">obtenerUsuarioPorEmail</a></li><li><a href="global.html">obtenerUsuarioPorEmailConToken</a></li><li><a href="global.html">obtenerUsuarioPorId</a></li><li><a href="global.html">paginated</a></li><li><a href="global.html#parseJSONField">parseJSONField</a></li><li><a href="global.html#post/auth/logout">post /auth/logout</a></li><li><a href="global.html">quitarRol</a></li><li><a href="global.html">reactivarPnf</a></li><li><a href="global.html">reasignarCoordinador</a></li><li><a href="global.html#registerAreaConocimiento">registerAreaConocimiento</a></li><li><a href="global.html#registerAula">registerAula</a></li><li><a href="global.html#registerPosGrado">registerPosGrado</a></li><li><a href="global.html#registerPreGrado">registerPreGrado</a></li><li><a href="global.html#registerSede">registerSede</a></li><li><a href="global.html">registrarAdmin</a></li><li><a href="global.html">registrarAula</a></li><li><a href="global.html#registrarHorario">registrarHorario</a></li><li><a href="global.html">registrarLineaInvestigacion</a></li><li><a href="global.html">registrarLineasInvestigacion</a></li><li><a href="global.html">registrarPNF</a></li><li><a href="global.html#registrarProfesor">registrarProfesor</a></li><li><a href="global.html">registrarSede</a></li><li><a href="global.html">registrarUnidadCurricular</a></li><li><a href="global.html#regitrarPNF">regitrarPNF</a></li><li><a href="global.html#regitrarUnidadCurricular">regitrarUnidadCurricular</a></li><li><a href="global.html">reingresar</a></li><li><a href="global.html">reingresoProfesor</a></li><li><a href="global.html#reportesEstadisticas">reportesEstadisticas</a></li><li><a href="global.html">respuestaDatos</a></li><li><a href="global.html">respuestaError</a></li><li><a href="global.html">respuestaExito</a></li><li><a href="global.html">respuestaPaginada</a></li><li><a href="global.html">respuestaPostgres</a></li><li><a href="global.html">respuestaServicio</a></li><li><a href="global.html">respuestaSuccess</a></li><li><a href="global.html">respuestaValidacionError</a></li><li><a href="global.html">restaurarRespaldo</a></li><li><a href="global.html">restituirCoordinador</a></li><li><a href="global.html#searchNotificationDestinatario">searchNotificationDestinatario</a></li><li><a href="global.html#searchNotificationGlobales">searchNotificationGlobales</a></li><li><a href="global.html#searchNotificationRoles">searchNotificationRoles</a></li><li><a href="global.html#searchNotificationUser">searchNotificationUser</a></li><li><a href="global.html#searchNotifications">searchNotifications</a></li><li><a href="global.html#securityMiddleware">securityMiddleware</a></li><li><a href="global.html#sendToGlobals">sendToGlobals</a></li><li><a href="global.html#sendToRoles">sendToRoles</a></li><li><a href="global.html#sendToUser">sendToUser</a></li><li><a href="global.html#socketAuth">socketAuth</a></li><li><a href="global.html#storage">storage</a></li><li><a href="global.html">success</a></li><li><a href="global.html">unauthorized</a></li><li><a href="global.html">updateProfile</a></li><li><a href="global.html">validacionesComunes</a></li><li><a href="global.html#validarFormatoEmail">validarFormatoEmail</a></li><li><a href="global.html#validateAdmins">validateAdmins</a></li><li><a href="global.html#validateAreaConocimiento">validateAreaConocimiento</a></li><li><a href="global.html#validateAsignacionCoordinador">validateAsignacionCoordinador</a></li><li><a href="global.html#validateAula">validateAula</a></li><li><a href="global.html#validateContrasenia">validateContrasenia</a></li><li><a href="global.html#validateCoordinador">validateCoordinador</a></li><li><a href="global.html">validateCreacionSecciones</a></li><li><a href="global.html#validateDestitucion">validateDestitucion</a></li><li><a href="global.html#validateDisponibilidadDocente">validateDisponibilidadDocente</a></li><li><a href="global.html#validateHorario">validateHorario</a></li><li><a href="global.html#validateId">validateId</a></li><li><a href="global.html#validateLineaInvestigacion">validateLineaInvestigacion</a></li><li><a href="global.html#validateLogin">validateLogin</a></li><li><a href="global.html">validateNuevaAreaConocimiento</a></li><li><a href="global.html">validateNuevoPosgrado</a></li><li><a href="global.html">validateNuevoPregrado</a></li><li><a href="global.html#validatePartialAdmins">validatePartialAdmins</a></li><li><a href="global.html#validatePartialAreaConocimiento">validatePartialAreaConocimiento</a></li><li><a href="global.html#validatePartialAula">validatePartialAula</a></li><li><a href="global.html#validatePartialCoordinador">validatePartialCoordinador</a></li><li><a href="global.html#validatePartialDestitucion">validatePartialDestitucion</a></li><li><a href="global.html#validatePartialDisponibilidadDocente">validatePartialDisponibilidadDocente</a></li><li><a href="global.html#validatePartialHorario">validatePartialHorario</a></li><li><a href="global.html#validatePartialLogin">validatePartialLogin</a></li><li><a href="global.html#validatePartialPnf">validatePartialPnf</a></li><li><a href="global.html#validatePartialPosgrado">validatePartialPosgrado</a></li><li><a href="global.html#validatePartialPregrado">validatePartialPregrado</a></li><li><a href="global.html#validatePartialProfesor">validatePartialProfesor</a></li><li><a href="global.html#validatePartialSeccion">validatePartialSeccion</a></li><li><a href="global.html#validatePartialSede">validatePartialSede</a></li><li><a href="global.html#validatePartialUnidadCurricular">validatePartialUnidadCurricular</a></li><li><a href="global.html#validatePartialUser">validatePartialUser</a></li><li><a href="global.html#validatePnf">validatePnf</a></li><li><a href="global.html#validatePosgrado">validatePosgrado</a></li><li><a href="global.html#validatePregrado">validatePregrado</a></li><li><a href="global.html#validateProfesor">validateProfesor</a></li><li><a href="global.html#validateQueryParams">validateQueryParams</a></li><li><a href="global.html#validateRecoveryPassword">validateRecoveryPassword</a></li><li><a href="global.html#validateReingreso">validateReingreso</a></li><li><a href="global.html#validateRequiredFields">validateRequiredFields</a></li><li><a href="global.html#validateSeccion">validateSeccion</a></li><li><a href="global.html#validateSede">validateSede</a></li><li><a href="global.html#validateUnidadCurricular">validateUnidadCurricular</a></li><li><a href="global.html#validateUser">validateUser</a></li><li><a href="global.html">validationError</a></li><li><a href="global.html#verificarConexion">verificarConexion</a></li><li><a href="global.html#verificarConexionInternet">verificarConexionInternet</a></li><li><a href="global.html#verificarDependencias">verificarDependencias</a></li><li><a href="global.html#verificarEmailConAPI">verificarEmailConAPI</a></li><li><a href="global.html">verificarSesion</a></li><li><a href="global.html#verificarUsers">verificarUsers</a></li><li><a href="global.html#verificarYValidarEmails">verificarYValidarEmails</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">services/email.service.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @class EmailService
 * @description Clase para el env√≠o de correos electr√≥nicos utilizando nodemailer.
 * Proporciona m√©todos para enviar emails con plantillas HTML y manejo de adjuntos.
 * @requires nodemailer
 */

import nodemailer from "nodemailer";
import fs from "fs";
import path from "path";
import { fileURLToPath } from "url";
import { loadEnv } from "../utils/utilis.js";
loadEnv();

// Para manejar rutas en ES modules
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

export default class EmailService {
  /**
   * @constructor
   * @description Inicializa el servicio de correo con la configuraci√≥n necesaria
   * @throws {Error} Cuando no se encuentra el archivo logo.png
   */
  constructor() {
    // Corregir la ruta del logo - buscar en varias ubicaciones posibles
    this.logoPath = this.findLogoPath();

    if (!this.logoPath) {
      console.warn("‚ö†Ô∏è Logo no encontrado. Los correos se enviar√°n sin logo.");
      // No lanzar error, permitir que el servicio funcione sin logo
    }

    /**
     * @constant {Object} EMAIL_CONFIG
     * @description Configuraci√≥n b√°sica para el servicio de correo electr√≥nico
     */
    this.EMAIL_CONFIG = {
      user: process.env.EMAIL_USER,
      pass: process.env.EMAIL_CREDENTIAL,
    };

    this.a√±o = new Date().getUTCFullYear();

    /**
     * @type {nodemailer.Transporter}
     * @description Instancia del transporter de nodemailer
     */
    this.transporter = this.createTransporter();
  }
  /**
   * @private
   * @method findLogoPath
   * @description Busca el archivo logo.png en varias ubicaciones posibles
   * @returns {string|null} Ruta del logo o null si no se encuentra
   */
  findLogoPath() {
    const possiblePaths = [
      // Ruta relativa desde el servicio
      path.join(__dirname, "../utils/logo.png"),
      // Ruta desde el directorio ra√≠z del proyecto
      path.join(process.cwd(), "utils/logo.png"),
      // Ruta desde el directorio actual
      path.join(__dirname, "../../utils/logo.png"),
      // Otras posibles ubicaciones
      path.join(process.cwd(), "server/utils/logo.png"),
      path.join(__dirname, "../../../utils/logo.png"),
    ];

    for (const logoPath of possiblePaths) {
      if (fs.existsSync(logoPath)) {
        console.log(`‚úÖ Logo encontrado en: ${logoPath}`);
        return logoPath;
      }
    }

    console.warn("‚ùå Logo no encontrado en las siguientes ubicaciones:");
    possiblePaths.forEach((p) => console.log(`   - ${p}`));
    return null;
  }

  /**
   * @private
   * @method createTransporter
   * @description Crea y configura el transporter de nodemailer
   * @returns {nodemailer.Transporter} Transporter configurado
   */
  createTransporter() {
    return nodemailer.createTransport({
      service: "gmail",
      tls: {
        rejectUnauthorized: false,
      },
      auth: {
        user: this.EMAIL_CONFIG.user,
        pass: this.EMAIL_CONFIG.pass,
      },
    });
  }

  /**
   * @private√±
   * @method generateEmailTemplate
   * @description Genera la plantilla HTML estructurada para el correo
   * @param {string} content - Contenido HTML del cuerpo del correo
   * @returns {string} Plantilla HTML completa
   */
  generateEmailTemplate(content) {
    const logoSection = this.logoPath
      ? `&lt;img src="cid:logo" alt="Logo UPTAMCA" style="width: 100px;">`
      : `&lt;h1 style="color: white; margin: 0;">UPTAMCA&lt;/h1>`;

    return `
      &lt;div style="font-family: Poppins, sans-serif; max-width: 600px; margin: 0 auto;">
          &lt;header style="background-color: #1C75BA; padding: 20px; text-align: center;">
              ${logoSection}
          &lt;/header>

          &lt;div style="padding: 20px;">
            ${content}
            &lt;p style="color: #7f8c8d; font-size: 0.9em; border-top: 1px solid #eee; padding-top: 15px;">
                      Este mensaje est√° dirigido exclusivamente al destinatario. Si usted no es la persona
                      a quien va dirigido, le solicitamos eliminarlo y notificarlo al remitente.
            &lt;/p>
          &lt;/div>
          &lt;footer style="background-color: #f3f4f6; padding: 15px; text-align: center; font-size: 12px;">
              ¬© ${this.a√±o} UPTAMCA. Todos los derechos reservados.
          &lt;/footer>
      &lt;/div>
    `;
  }

  /**
   * @private
   * @method createMailOptions
   * @description Crea las opciones de env√≠o del correo
   * @param {Object} params - Par√°metros del correo
   * @param {string} params.Destinatario - Direcci√≥n de correo del destinatario
   * @param {Object} params.Correo - Configuraci√≥n espec√≠fica del correo
   * @param {string} params.Correo.asunto - Asunto del correo electr√≥nico
   * @param {string} params.Correo.html - Contenido HTML del cuerpo del correo
   * @returns {nodemailer.SendMailOptions} Opciones del correo
   */
  createMailOptions({ Destinatario, Correo }) {
    return {
      from: this.EMAIL_CONFIG.user,
      to: Destinatario,
      subject: Correo.asunto,
      html: this.generateEmailTemplate(Correo.html),
      attachments: [
        {
          filename: "logo.png",
          path: this.logoPath,
          cid: "logo",
        },
      ],
    };
  }

  /**
   * @method validarFormatoEmail
   * @description Valida el formato del email con expresi√≥n regular
   * @param {string} email - Direcci√≥n de correo a validar
   * @returns {Object} Resultado de la validaci√≥n
   */
  validarFormatoEmail(email) {
    const emailRegex =
      /^[a-zA-Z0-9.!#$%&amp;'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;

    const esValido = emailRegex.test(email);

    return {
      valido: esValido,
      mensaje: esValido
        ? "Formato de email v√°lido"
        : "Formato de email inv√°lido",
    };
  }

  /**
   * @async
   * @method verificarEmailConAPI
   * @description Verifica un email usando AbstractAPI Email Reputation con manejo robusto de errores
   * @param {string} email - Direcci√≥n de correo a verificar
   * @returns {Promise&lt;Object>} Resultado de la verificaci√≥n
   */
  async verificarEmailConAPI(email) {
    try {
      const API_KEY = process.env.EMAIL_VERIFICATION_API_KEY;

      // Si no hay API key, usar validaci√≥n local inmediatamente
      if (!API_KEY) {
        console.warn(
          "‚ö†Ô∏è [EmailService] No hay API key, usando validaci√≥n local"
        );
        return this.validarEmailLocal(email);
      }

      console.log(`üåê [EmailService] Verificando email con API: ${email}`);

      // Timeout para evitar esperas infinitas
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 segundos timeout

      const response = await fetch(
        `https://emailreputation.abstractapi.com/v1/?api_key=${API_KEY}&amp;email=${encodeURIComponent(
          email
        )}`,
        {
          signal: controller.signal,
          headers: {
            Accept: "application/json",
          },
        }
      );

      clearTimeout(timeoutId);

      if (!response.ok) {
        console.warn(
          `‚ö†Ô∏è [EmailService] API respondi√≥ con status: ${response.status}`
        );
        // Si es error del servidor (5xx) o rate limiting (429), usar validaci√≥n local
        if (response.status >= 500 || response.status === 429) {
          return this.validarEmailLocal(email);
        }
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }

      const data = await response.json();

      // Debug: Ver respuesta completa de la API
      if (process.env.NODE_ENV === "development") {
        console.log(
          "üì® [EmailService] Respuesta API:",
          JSON.stringify(data, null, 2)
        );
      }

      // Verificar estructura de respuesta
      if (!data || typeof data !== "object") {
        console.warn("‚ö†Ô∏è [EmailService] Respuesta API inv√°lida");
        return this.validarEmailLocal(email);
      }

      // Usar los campos correctos de la API de Reputation
      const esValido = data.email_deliverability?.is_format_valid === true;
      const esEntregable = data.email_deliverability?.status === "deliverable";
      const noEsDesechable = data.email_quality?.is_disposable === false;

      return {
        existe: esValido &amp;&amp; esEntregable &amp;&amp; noEsDesechable,
        valido: esValido,
        calidad: parseFloat(data.email_quality?.score) || 0,
        mensaje: this.generarMensajeReputacion(data),
        datos: data,
        verificadoCon: "api_reputacion_email",
      };
    } catch (error) {
      console.warn(`‚ö†Ô∏è [EmailService] Error en API: ${error.message}`);

      // Clasificar el tipo de error
      if (error.name === "AbortError") {
        console.warn(
          "‚è∞ [EmailService] Timeout en API, usando validaci√≥n local"
        );
      } else if (
        error.message.includes("network") ||
        error.message.includes("fetch")
      ) {
        console.warn("üåê [EmailService] Error de red, usando validaci√≥n local");
      }

      // Para cualquier error de API, usar validaci√≥n local como respaldo
      return this.validarEmailLocal(email);
    }
  }

  /**
   * @private
   * @method validarEmailLocal
   * @description Validaci√≥n local de email cuando la API no est√° disponible
   * Realiza una verificaci√≥n b√°sica de formato y dominios comunes
   * @param {string} email - Direcci√≥n de correo a validar
   * @returns {Object} Resultado de la validaci√≥n local
   */
  validarEmailLocal(email) {
    // Validaci√≥n b√°sica de formato
    const emailRegex =
      /^[a-zA-Z0-9.!#$%&amp;'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;

    if (!emailRegex.test(email)) {
      return {
        existe: false,
        valido: false,
        calidad: 0,
        mensaje: "Formato de email inv√°lido",
        verificadoCon: "validacion_local",
      };
    }

    // Extraer dominio del email
    const dominio = email.split("@")[1]?.toLowerCase();

    if (!dominio) {
      return {
        existe: false,
        valido: false,
        calidad: 0,
        mensaje: "Dominio de email inv√°lido",
        verificadoCon: "validacion_local",
      };
    }

    // Lista de dominios de email desechables/temporales comunes
    const dominiosDesechables = [
      "tempmail.com",
      "guerrillamail.com",
      "mailinator.com",
      "10minutemail.com",
      "yopmail.com",
      "throwawaymail.com",
      "fakeinbox.com",
      "temp-mail.org",
      "trashmail.com",
      "disposablemail.com",
      "getairmail.com",
      "tmpmail.org",
    ];

    // Verificar si es un dominio desechable
    const esDesechable = dominiosDesechables.some(
      (dom) => dominio.includes(dom) || dominio.endsWith(dom)
    );

    if (esDesechable) {
      return {
        existe: false,
        valido: false,
        calidad: 0.1,
        mensaje: "Email desechable (temporal) detectado",
        verificadoCon: "validacion_local",
      };
    }

    // Lista de dominios de proveedores leg√≠timos comunes
    const dominiosLegitimos = [
      "gmail.com",
      "yahoo.com",
      "hotmail.com",
      "outlook.com",
      "aol.com",
      "icloud.com",
      "protonmail.com",
      "live.com",
      "msn.com",
      "ymail.com",
    ];

    // Verificar si es un dominio leg√≠timo conocido
    const esLegitimo = dominiosLegitimos.some((dom) => dominio === dom);

    // Calcular puntuaci√≥n de calidad basada en el dominio
    let calidad = 0.5; // Puntuaci√≥n base para dominios desconocidos

    if (esLegitimo) {
      calidad = 0.8; // Puntuaci√≥n alta para proveedores conocidos
    }

    // Verificaci√≥n adicional de estructura del dominio
    const partesDominio = dominio.split(".");
    const tieneExtensionValida =
      partesDominio.length >= 2 &amp;&amp;
      partesDominio[partesDominio.length - 1].length >= 2;

    if (!tieneExtensionValida) {
      return {
        existe: false,
        valido: false,
        calidad: 0.1,
        mensaje: "Extensi√≥n de dominio inv√°lida",
        verificadoCon: "validacion_local",
      };
    }

    return {
      existe: true, // Asumimos que existe (no podemos verificarlo localmente)
      valido: true,
      calidad: calidad,
      mensaje: esLegitimo
        ? "Email v√°lido y de proveedor confiable"
        : "Email v√°lido (verificaci√≥n limitada sin API)",
      verificadoCon: "validacion_local",
      detalles: {
        dominio: dominio,
        esDesechable: esDesechable,
        esLegitimo: esLegitimo,
        extensionValida: tieneExtensionValida,
      },
    };
  }

  /**
   * @private
   * @method generarMensajeReputacion
   * @description Genera un mensaje descriptivo basado en la respuesta de Email Reputation API
   * @param {Object} data - Datos de la API
   * @returns {string} Mensaje descriptivo
   */
  generarMensajeReputacion(data) {
    const deliverability = data.email_deliverability;
    const quality = data.email_quality;

    if (!deliverability?.is_format_valid) {
      return "Formato de email inv√°lido";
    }

    if (quality?.is_disposable) {
      return "Email desechable (temporal) detectado";
    }

    if (deliverability?.status === "deliverable") {
      const score = parseFloat(quality?.score) || 0;
      if (score > 0.8) {
        return "Email v√°lido y de alta calidad";
      } else if (score > 0.5) {
        return "Email v√°lido y de calidad media";
      } else {
        return "Email v√°lido pero de baja calidad";
      }
    } else if (deliverability?.status === "undeliverable") {
      return "Email no entregable";
    } else {
      return "Estado de email desconocido";
    }
  }

  /**
   * @private
   * @method crearRespuestaErrorEmail
   * @description Crea una respuesta de error estandarizada para emails inv√°lidos
   * @param {Array} errors - Array de errores de validaci√≥n
   * @returns {Object} Respuesta de error formateada
   */
  crearRespuestaErrorEmail(errors) {
    return {
      state: "email_error",
      status: 400,
      title: "Datos Err√≥neos",
      message: "Los datos de entrada no son v√°lidos",
      error: errors,
    };
  }

  /**
   * @async
   * @method verificarYValidarEmails
   * @description Verifica y valida uno o m√∫ltiples emails antes del env√≠o
   * Implementa validaci√≥n local como respaldo cuando la API falla
   * @param {string|string[]} destinatarios - Email o array de emails a verificar
   * @returns {Promise&lt;Object>} Resultado de la verificaci√≥n
   */
  async verificarYValidarEmails(destinatarios) {
    const emails = Array.isArray(destinatarios)
      ? destinatarios
      : [destinatarios];
    const errores = [];
    const emailsValidos = [];
    const resultadosIndividuales = [];
    let apiDisponible = true;

    console.log(`üîç [EmailService] Verificando ${emails.length} email(s)`);

    for (const email of emails) {
      try {
        // Validaci√≥n b√°sica de formato primero (siempre local)
        const validacionFormato = this.validarFormatoEmail(email);

        if (!validacionFormato.valido) {
          const error = {
            email: email,
            mensaje: validacionFormato.mensaje,
            tipo: "formato_invalido",
            metodo: "validacion_local",
          };
          errores.push(error);
          resultadosIndividuales.push({ email, valido: false, error });
          continue;
        }

        let verificacion;
        let metodoVerificacion = "api_reputacion_email";

        // Intentar verificaci√≥n con API primero
        if (apiDisponible) {
          try {
            verificacion = await this.verificarEmailConAPI(email);
            metodoVerificacion = verificacion.verificadoCon;

            // Si la API fall√≥ fatalmente, desactivar para pr√≥ximos emails
            if (verificacion.verificadoCon === "validacion_local") {
              apiDisponible = false;
              console.warn(
                `‚ö†Ô∏è [EmailService] API no disponible, usando validaci√≥n local para email: ${email}`
              );
            }
          } catch (apiError) {
            // Error fatal en API, usar validaci√≥n local
            apiDisponible = false;
            console.warn(
              `‚ö†Ô∏è [EmailService] Error en API, cambiando a validaci√≥n local: ${apiError.message}`
            );
            verificacion = this.validarEmailLocal(email);
            metodoVerificacion = "validacion_local_fallback";
          }
        } else {
          // API no disponible, usar solo validaci√≥n local
          verificacion = this.validarEmailLocal(email);
          metodoVerificacion = "validacion_local_fallback";
        }

        // Evaluar el resultado de la verificaci√≥n
        const esValido = verificacion.valido &amp;&amp; verificacion.existe;

        if (!esValido) {
          const error = {
            email: email,
            mensaje: verificacion.mensaje,
            tipo: "email_no_verificado",
            metodo: metodoVerificacion,
            detalles: verificacion,
            calidad: verificacion.calidad || 0,
          };
          errores.push(error);
          resultadosIndividuales.push({ email, valido: false, error });
        } else {
          emailsValidos.push(email);
          resultadosIndividuales.push({
            email,
            valido: true,
            metodo: metodoVerificacion,
            calidad: verificacion.calidad || 0.5,
            mensaje: verificacion.mensaje,
          });

          console.log(
            `‚úÖ [EmailService] Email v√°lido: ${email} (${metodoVerificacion})`
          );
        }
      } catch (error) {
        // Error inesperado en el proceso de verificaci√≥n
        console.error(
          `üí• [EmailService] Error inesperado verificando ${email}:`,
          error
        );

        const errorObj = {
          email: email,
          mensaje: "Error inesperado en verificaci√≥n",
          tipo: "error_proceso",
          metodo: "error",
          detalles: error.message,
        };

        errores.push(errorObj);
        resultadosIndividuales.push({ email, valido: false, error: errorObj });
      }
    }

    // Resumen final
    const resultadoFinal = {
      todosValidos: errores.length === 0,
      emailsValidos: emailsValidos,
      errores: errores,
      totalVerificados: emails.length,
      totalValidos: emailsValidos.length,
      totalErrores: errores.length,
      metodoPrincipal: apiDisponible
        ? "api_reputacion_email"
        : "validacion_local",
      apiDisponible: apiDisponible,
      resultadosIndividuales: resultadosIndividuales,
    };

    console.log(`üìä [EmailService] Resumen verificaci√≥n:`, {
      total: resultadoFinal.totalVerificados,
      validos: resultadoFinal.totalValidos,
      errores: resultadoFinal.totalErrores,
      metodo: resultadoFinal.metodoPrincipal,
      apiDisponible: resultadoFinal.apiDisponible,
    });

    return resultadoFinal;
  }

  /**
   * @async
   * @method enviarEmail
   * @description Env√≠a un correo electr√≥nico verificando primero la existencia del destinatario
   * @param {Object} params - Objeto con par√°metros de env√≠o
   * @param {string} params.Destinatario - Direcci√≥n de correo del destinatario
   * @param {Object} params.Correo - Configuraci√≥n espec√≠fica del correo
   * @param {string} params.Correo.asunto - Asunto del correo electr√≥nico
   * @param {string} params.Correo.html - Contenido HTML del cuerpo del correo
   * @param {boolean} params.verificarEmail - Si debe verificar el email antes de enviar (default: true)
   * @returns {Promise&lt;Object>} Resultado del env√≠o
   * @throws {Error} Cuando falla el env√≠o del correo
   */
  async enviarEmail({ Destinatario, Correo, verificarEmail = true }) {
    try {
      console.log(
        `üìß [EmailService] Intentando enviar email a: ${Destinatario}`
      );

      // Verificar email antes del env√≠o
      if (verificarEmail) {
        const verificacion = await this.verificarYValidarEmails(Destinatario);

        if (!verificacion.todosValidos) {
          console.error(
            `‚ùå Email inv√°lido: ${Destinatario}`,
            verificacion.errores
          );
          return this.crearRespuestaErrorEmail(verificacion.errores);
        }
      }

      const mailOptions = this.createMailOptions({ Destinatario, Correo });

      // Enviar email y esperar confirmaci√≥n
      const resultado = await this.transporter.sendMail(mailOptions);

      console.log(
        `‚úÖ [EmailService] Email enviado exitosamente a: ${Destinatario}`,
        {
          messageId: resultado.messageId,
          asunto: Correo.asunto,
        }
      );

      return {
        success: true,
        state: "success",
        status: 200,
        title: "Correo Enviado",
        message: "El correo electr√≥nico fue enviado exitosamente",
        data: {
          destinatario: Destinatario,
          asunto: Correo.asunto,
          messageId: resultado.messageId,
        },
      };
    } catch (error) {
      console.error(
        `üí• [EmailService] Error al enviar email a: ${Destinatario}`,
        {
          error: error.message,
          asunto: Correo.asunto,
        }
      );

      // Devolver error REAL, no √©xito falso
      return {
        success: false,
        state: "error",
        status: 500,
        title: "Error de Env√≠o",
        message: "No se pudo enviar el correo electr√≥nico",
        error: error.message,
        data: {
          destinatario: Destinatario,
          asunto: Correo.asunto,
        },
      };
    }
  }

  /**
   * @async
   * @method enviarEmailMultiple
   * @description Env√≠a un correo electr√≥nico a m√∫ltiples destinatarios verificando primero los emails
   * @param {Object} params - Objeto con par√°metros de env√≠o
   * @param {string[]} params.Destinatarios - Array de direcciones de correo
   * @param {Object} params.Correo - Configuraci√≥n espec√≠fica del correo
   * @param {string} params.Correo.asunto - Asunto del correo electr√≥nico
   * @param {string} params.Correo.html - Contenido HTML del cuerpo del correo
   * @param {boolean} params.verificarEmails - Si debe verificar los emails antes de enviar (default: true)
   * @returns {Promise&lt;Object>} Resultado del env√≠o
   * @throws {Error} Cuando falla el env√≠o del correo
   */
  async enviarEmailMultiple({ Destinatarios, Correo, verificarEmails = true }) {
    try {
      // Verificar emails antes del env√≠o
      if (verificarEmails) {
        const verificacion = await this.verificarYValidarEmails(Destinatarios);

        if (!verificacion.todosValidos) {
          return this.crearRespuestaErrorEmail(verificacion.errores);
        }
      }

      const mailOptions = {
        from: this.EMAIL_CONFIG.user,
        to: Destinatarios.join(", "),
        subject: Correo.asunto,
        html: this.generateEmailTemplate(Correo.html),
        attachments: [
          {
            filename: "logo.png",
            path: this.logoPath,
            cid: "logo",
          },
        ],
      };

      await this.transporter.sendMail(mailOptions);

      return {
        state: "success",
        status: 200,
        title: "Correos Enviados",
        message: `El correo electr√≥nico fue enviado exitosamente a ${Destinatarios.length} destinatarios`,
        data: {
          totalDestinatarios: Destinatarios.length,
          asunto: Correo.asunto,
        },
      };
    } catch (error) {
      throw {
        message:
          "Error al enviar el correo electr√≥nico a m√∫ltiples destinatarios",
        tipo: "Correo",
        error: error.message,
      };
    }
  }

  /**
   * @async
   * @method verificarConexion
   * @description Verifica la conexi√≥n con el servicio de correo
   * @returns {Promise&lt;boolean>} True si la conexi√≥n es exitosa
   * @throws {Error} Cuando falla la verificaci√≥n de conexi√≥n
   */
  async verificarConexion() {
    try {
      await this.transporter.verify();
      return true;
    } catch (error) {
      throw {
        message: "Error al verificar la conexi√≥n con el servicio de correo",
        tipo: "Conexion",
        error: error.message,
      };
    }
  }
}

/**
 * @description Consideraciones de seguridad importantes para el m√≥dulo de correo:
 * 1. Las credenciales deber√≠an manejarse mediante variables de entorno en producci√≥n
 * 2. Gmail tiene l√≠mites de env√≠o (500 correos/d√≠a para cuentas est√°ndar)
 * 3. Para producci√≥n considerar servicios especializados como SendGrid o Mailgun
 * 4. Nunca incluir contrase√±as directamente en el c√≥digo fuente
 * 5. Implementar mecanismos de reintento para fallos temporales
 */
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.4</a> on Thu Dec 04 2025 12:35:39 GMT-0400 (hora de Venezuela) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
