<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>services/curricular.service.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AdminController.html">AdminController</a></li><li><a href="AdminModel.html">AdminModel</a></li><li><a href="AdminService.html">AdminService</a></li><li><a href="AulaController.html">AulaController</a></li><li><a href="AulaModel.html">AulaModel</a></li><li><a href="AulaService.html">AulaService</a></li><li><a href="CoordinadorController.html">CoordinadorController</a></li><li><a href="CoordinadorService.html">CoordinadorService</a></li><li><a href="CurricularController.html">CurricularController</a></li><li><a href="CurricularModel.html">CurricularModel</a></li><li><a href="CurricularService.html">CurricularService</a></li><li><a href="DocumentServices.html">DocumentServices</a><ul class='methods'><li data-type='method'><a href="DocumentServices.html#.crearCeldaEstilizada">crearCeldaEstilizada</a></li><li data-type='method'><a href="DocumentServices.html#.crearDocumentoHorario">crearDocumentoHorario</a></li><li data-type='method'><a href="DocumentServices.html#.crearFilaInformacion">crearFilaInformacion</a></li><li data-type='method'><a href="DocumentServices.html#.crearFilasTabla">crearFilasTabla</a></li><li data-type='method'><a href="DocumentServices.html#.crearParrafoEstilizado">crearParrafoEstilizado</a></li><li data-type='method'><a href="DocumentServices.html#.crearTextoEstilizado">crearTextoEstilizado</a></li><li data-type='method'><a href="DocumentServices.html#.generarDocumentoHorario">generarDocumentoHorario</a></li><li data-type='method'><a href="DocumentServices.html#.generarHorasDisponibles">generarHorasDisponibles</a></li><li data-type='method'><a href="DocumentServices.html#.procesarHorario">procesarHorario</a></li><li data-type='method'><a href="DocumentServices.html#.traerLogoMarcaAgua">traerLogoMarcaAgua</a></li></ul></li><li><a href="EmailService.html">EmailService</a></li><li><a href="FormatterResponseController.html">FormatterResponseController</a></li><li><a href="FormatterResponseModel.html">FormatterResponseModel</a></li><li><a href="FormatterResponseService.html">FormatterResponseService</a></li><li><a href="HorarioController.html">HorarioController</a></li><li><a href="HorarioService.html">HorarioService</a></li><li><a href="NotificationController.html">NotificationController</a></li><li><a href="ProfesorController.html">ProfesorController</a></li><li><a href="ProfesorModel.html">ProfesorModel</a></li><li><a href="ProfesorService.html">ProfesorService</a></li><li><a href="SedeController.html">SedeController</a></li><li><a href="SedeModel.html">SedeModel</a></li><li><a href="SedeService.html">SedeService</a></li><li><a href="SystemController.html">SystemController</a></li><li><a href="SystemModel.html">SystemModel</a></li><li><a href="UserController.html">UserController</a></li><li><a href="UserModel.html">UserModel</a></li><li><a href="UserService.html">UserService</a></li><li><a href="ValidationService.html">ValidationService</a></li><li><a href="module.exports_module.exports.html">exports</a></li></ul><h3>Modules</h3><ul><li><a href="module-CoordinadorModel.html">CoordinadorModel</a><ul class='methods'><li data-type='method'><a href="module-CoordinadorModel.html#.actualizarCoordinador">actualizarCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.asignarCoordinador">asignarCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.destituirCoordinador">destituirCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerCoordinador">obtenerCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerCoordinadorPorId">obtenerCoordinadorPorId</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerCoordinadorPorPnf">obtenerCoordinadorPorPnf</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerCoordinadoresActivos">obtenerCoordinadoresActivos</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerDatosCoordinadorCompletos">obtenerDatosCoordinadorCompletos</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerHistorialCoordinador">obtenerHistorialCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerHistorialDestituciones">obtenerHistorialDestituciones</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerTodos">obtenerTodos</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.reasignarCoordinador">reasignarCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.restituirCoordinador">restituirCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.validarCoordinadorActivo">validarCoordinadorActivo</a></li></ul></li><li><a href="module-CurricularRouter.html">CurricularRouter</a></li><li><a href="module-passwordUtils.html">passwordUtils</a><ul class='methods'><li data-type='method'><a href="module-passwordUtils.html#~comparePassword">comparePassword</a></li><li data-type='method'><a href="module-passwordUtils.html#~generarPassword">generarPassword</a></li><li data-type='method'><a href="module-passwordUtils.html#~hashPassword">hashPassword</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html">CrearSecciones</a></li><li><a href="global.html#DELETE/admins/:id">DELETE /admins/:id</a></li><li><a href="global.html#DELETE/aulas/:id">DELETE /aulas/:id</a></li><li><a href="global.html#DELETE/coordinadores/:id/destituir">DELETE /coordinadores/:id/destituir</a></li><li><a href="global.html#DELETE/horarios/:id">DELETE /horarios/:id</a></li><li><a href="global.html#DELETE/profesores/:id">DELETE /profesores/:id</a></li><li><a href="global.html#DELETE/profesores/:id_profesor/disponibilidad/:id_disponibilidad">DELETE /profesores/:id_profesor/disponibilidad/:id_disponibilidad</a></li><li><a href="global.html#DELETE/sedes/:id">DELETE /sedes/:id</a></li><li><a href="global.html#DELETE/system/backups/:backupFileName">DELETE /system/backups/:backupFileName</a></li><li><a href="global.html#DELETE/system/backups/cleanup">DELETE /system/backups/cleanup</a></li><li><a href="global.html#DELETE/user/:id_usuario/desactivar">DELETE /user/:id_usuario/desactivar</a></li><li><a href="global.html#EMAIL_CONFIG">EMAIL_CONFIG</a></li><li><a href="global.html#EnviarTokenEmail">EnviarTokenEmail</a></li><li><a href="global.html#GET/admin/logs">GET /admin/logs</a></li><li><a href="global.html#GET/admin/profile">GET /admin/profile</a></li><li><a href="global.html#GET/admin/reports">GET /admin/reports</a></li><li><a href="global.html#GET/admin/stats">GET /admin/stats</a></li><li><a href="global.html#GET/admins">GET /admins</a></li><li><a href="global.html#GET/admins/search">GET /admins/search</a></li><li><a href="global.html#GET/api/aulas">GET /api/aulas</a></li><li><a href="global.html#GET/api/profesores">GET /api/profesores</a></li><li><a href="global.html#GET/api/system/backups">GET /api/system/backups</a></li><li><a href="global.html#GET/api/system/estadisticas">GET /api/system/estadisticas</a></li><li><a href="global.html#GET/api/system/metricas">GET /api/system/metricas</a></li><li><a href="global.html#GET/api/system/status">GET /api/system/status</a></li><li><a href="global.html#GET/auditory/system">GET /auditory/system</a></li><li><a href="global.html#GET/aulas">GET /aulas</a></li><li><a href="global.html#GET/aulas/:id">GET /aulas/:id</a></li><li><a href="global.html#GET/aulas/pnf/:codigoPNF">GET /aulas/pnf/:codigoPNF</a></li><li><a href="global.html#GET/aulas/sede/:sede">GET /aulas/sede/:sede</a></li><li><a href="global.html#GET/aulas/tipo/:tipo">GET /aulas/tipo/:tipo</a></li><li><a href="global.html#GET/auth/verify">GET /auth/verify</a></li><li><a href="global.html#GET/catalogos/areas-conocimiento">GET /catalogos/areas-conocimiento</a></li><li><a href="global.html#GET/catalogos/posgrados">GET /catalogos/posgrados</a></li><li><a href="global.html#GET/catalogos/pregrados">GET /catalogos/pregrados</a></li><li><a href="global.html#GET/coordinadores">GET /coordinadores</a></li><li><a href="global.html#GET/coordinadores/:id">GET /coordinadores/:id</a></li><li><a href="global.html#GET/coordinadores/:id/historial-destituciones">GET /coordinadores/:id/historial-destituciones</a></li><li><a href="global.html#GET/coordinadores/destituidos">GET /coordinadores/destituidos</a></li><li><a href="global.html#GET/exportar/seccion/:id_seccion">GET /exportar/seccion/:id_seccion</a></li><li><a href="global.html#GET/horarios/aula/:id_aula">GET /horarios/aula/:id_aula</a></li><li><a href="global.html#GET/horarios/profesor/:id_profesor">GET /horarios/profesor/:id_profesor</a></li><li><a href="global.html#GET/horarios/seccion/:id_seccion">GET /horarios/seccion/:id_seccion</a></li><li><a href="global.html#GET/notifications">GET /notifications</a></li><li><a href="global.html#GET/profesores">GET /profesores</a></li><li><a href="global.html#GET/profesores/:id">GET /profesores/:id</a></li><li><a href="global.html#GET/profesores/:id/imagen">GET /profesores/:id/imagen</a></li><li><a href="global.html#GET/profesores/search">GET /profesores/search</a></li><li><a href="global.html#GET/profile">GET /profile</a></li><li><a href="global.html#GET/sedes">GET /sedes</a></li><li><a href="global.html#GET/sedes/:id">GET /sedes/:id</a></li><li><a href="global.html#GET/system/backups">GET /system/backups</a></li><li><a href="global.html#GET/system/backups/download/:backupFileName">GET /system/backups/download/:backupFileName</a></li><li><a href="global.html#GET/system/estado">GET /system/estado</a></li><li><a href="global.html#GET/system/info">GET /system/info</a></li><li><a href="global.html#GET/system/logs">GET /system/logs</a></li><li><a href="global.html#GET/system/mapa-calor/horarios">GET /system/mapa-calor/horarios</a></li><li><a href="global.html#GET/system/metricas/academicas">GET /system/metricas/academicas</a></li><li><a href="global.html#GET/system/metricas/sistema">GET /system/metricas/sistema</a></li><li><a href="global.html#GET/system/reportes/estadisticas">GET /system/reportes/estadisticas</a></li><li><a href="global.html">GuardarTokenEmail</a></li><li><a href="global.html#PATCH/admins/:id/rol">PATCH /admins/:id/rol</a></li><li><a href="global.html#POST/admins">POST /admins</a></li><li><a href="global.html#POST/aulas">POST /aulas</a></li><li><a href="global.html#POST/aulas/to/horarios">POST /aulas/to/horarios</a></li><li><a href="global.html#POST/auth/login">POST /auth/login</a></li><li><a href="global.html#POST/catalogos/areas-conocimiento">POST /catalogos/areas-conocimiento</a></li><li><a href="global.html#POST/catalogos/posgrados">POST /catalogos/posgrados</a></li><li><a href="global.html#POST/catalogos/pregrados">POST /catalogos/pregrados</a></li><li><a href="global.html#POST/coordinadores">POST /coordinadores</a></li><li><a href="global.html#POST/coordinadores/:id/restitur">POST /coordinadores/:id/restitur</a></li><li><a href="global.html#POST/horarios">POST /horarios</a></li><li><a href="global.html#POST/profesores">POST /profesores</a></li><li><a href="global.html#POST/profesores/:id/disponibilidad">POST /profesores/:id/disponibilidad</a></li><li><a href="global.html#POST/profesores/:id/reingresar">POST /profesores/:id/reingresar</a></li><li><a href="global.html#POST/profesores/to/seccion/:id_seccion">POST /profesores/to/seccion/:id_seccion</a></li><li><a href="global.html#POST/sedes">POST /sedes</a></li><li><a href="global.html#POST/system/backup">POST /system/backup</a></li><li><a href="global.html#POST/system/backup/manual">POST /system/backup/manual</a></li><li><a href="global.html#POST/system/restore">POST /system/restore</a></li><li><a href="global.html#PUT/admin/profile">PUT /admin/profile</a></li><li><a href="global.html#PUT/admins/:id">PUT /admins/:id</a></li><li><a href="global.html#PUT/aulas/:id">PUT /aulas/:id</a></li><li><a href="global.html#PUT/auth/password">PUT /auth/password</a></li><li><a href="global.html#PUT/coordinadores/:cedula/reasignar-pnf">PUT /coordinadores/:cedula/reasignar-pnf</a></li><li><a href="global.html#PUT/coordinadores/:id">PUT /coordinadores/:id</a></li><li><a href="global.html#PUT/horarios/:id">PUT /horarios/:id</a></li><li><a href="global.html#PUT/profesores/:id">PUT /profesores/:id</a></li><li><a href="global.html#PUT/profesores/:id_profesor/disponibilidad">PUT /profesores/:id_profesor/disponibilidad</a></li><li><a href="global.html#PUT/sedes/:id">PUT /sedes/:id</a></li><li><a href="global.html#PUT/user/:id_usuario/activar">PUT /user/:id_usuario/activar</a></li><li><a href="global.html">VerificarToken</a></li><li><a href="global.html">activar</a></li><li><a href="global.html">activarUsuario</a></li><li><a href="global.html">actualizar</a></li><li><a href="global.html">actualizarAdmin</a></li><li><a href="global.html">actualizarAula</a></li><li><a href="global.html">actualizarContrase√±aYLimpiarToken</a></li><li><a href="global.html">actualizarCoordinador</a></li><li><a href="global.html">actualizarDescripcionTrayecto</a></li><li><a href="global.html">actualizarDisponibilidad</a></li><li><a href="global.html#actualizarHorario">actualizarHorario</a></li><li><a href="global.html">actualizarPNF</a></li><li><a href="global.html">actualizarPerfil</a></li><li><a href="global.html#actualizarProfesor">actualizarProfesor</a></li><li><a href="global.html">actualizarSede</a></li><li><a href="global.html">actualizarUltimoAcceso</a></li><li><a href="global.html">actualizarUnidadCurricular</a></li><li><a href="global.html#agregarRolDestinatario">agregarRolDestinatario</a></li><li><a href="global.html#agregarUsuarioDestinatario">agregarUsuarioDestinatario</a></li><li><a href="global.html#asegurarStringEnMinusculas">asegurarStringEnMinusculas</a></li><li><a href="global.html">asignacionTurnoSeccion</a></li><li><a href="global.html">asignarCoordinador</a></li><li><a href="global.html">asignarTurnoSeccion</a></li><li><a href="global.html">buscar</a></li><li><a href="global.html">buscarAdmin</a></li><li><a href="global.html">buscarPorEmail</a></li><li><a href="global.html">buscarPorId</a></li><li><a href="global.html#buscarProfesor">buscarProfesor</a></li><li><a href="global.html">cambiarContrase√±a</a></li><li><a href="global.html">cambiarRol</a></li><li><a href="global.html">cambiarRolAdmin</a></li><li><a href="global.html">cerrarSesion</a></li><li><a href="global.html#closeSession">closeSession</a></li><li><a href="global.html">conflict</a></li><li><a href="global.html#connectDB">connectDB</a></li><li><a href="global.html">contarPorRolYEstado</a></li><li><a href="global.html#corsOptions">corsOptions</a></li><li><a href="global.html">crear</a></li><li><a href="global.html">crearAreaConocimiento</a></li><li><a href="global.html">crearDisponibilidad</a></li><li><a href="global.html#crearNotificacionCompleta">crearNotificacionCompleta</a></li><li><a href="global.html#crearNotificacionIndividual">crearNotificacionIndividual</a></li><li><a href="global.html#crearNotificacionMasiva">crearNotificacionMasiva</a></li><li><a href="global.html">crearPosgrado</a></li><li><a href="global.html">crearPregrado</a></li><li><a href="global.html">crearRespaldo</a></li><li><a href="global.html">crearSecciones</a></li><li><a href="global.html#crearSede">crearSede</a></li><li><a href="global.html#createValidationResponse">createValidationResponse</a></li><li><a href="global.html">created</a></li><li><a href="global.html">desactivar</a></li><li><a href="global.html">desactivarAdmin</a></li><li><a href="global.html">desactivarUsuario</a></li><li><a href="global.html#descargarRespaldo">descargarRespaldo</a></li><li><a href="global.html#destituirProfesor">destituirProfesor</a></li><li><a href="global.html#disconnectDB">disconnectDB</a></li><li><a href="global.html">eliminar</a></li><li><a href="global.html">eliminarAula</a></li><li><a href="global.html">eliminarCoordinador</a></li><li><a href="global.html">eliminarDisponibilidad</a></li><li><a href="global.html#eliminarHorario">eliminarHorario</a></li><li><a href="global.html">eliminarPnf</a></li><li><a href="global.html">eliminarRespaldo</a></li><li><a href="global.html">eliminarSede</a></li><li><a href="global.html">eliminarUnidadCurricular</a></li><li><a href="global.html#enviarEmail">enviarEmail</a></li><li><a href="global.html#enviarEmailMultiple">enviarEmailMultiple</a></li><li><a href="global.html">error</a></li><li><a href="global.html#exportarHorarioWord">exportarHorarioWord</a></li><li><a href="global.html">extractData</a></li><li><a href="global.html">extractError</a></li><li><a href="global.html">filtrarPorEstado</a></li><li><a href="global.html">filtrarPorRol</a></li><li><a href="global.html">filtrarPorSede</a></li><li><a href="global.html">filtrarPorTipo</a></li><li><a href="global.html">forbidden</a></li><li><a href="global.html">formatValidationErrors</a></li><li><a href="global.html">fromDatabaseResponse</a></li><li><a href="global.html#generarDocumentoHorario">generarDocumentoHorario</a></li><li><a href="global.html#generateEmailTemplate">generateEmailTemplate</a></li><li><a href="global.html#get/auth/logout">get /auth/logout</a></li><li><a href="global.html#getCookie">getCookie</a></li><li><a href="global.html">getDefaultTitle</a></li><li><a href="global.html">getErrorCode</a></li><li><a href="global.html#getFilterCondition">getFilterCondition</a></li><li><a href="global.html#getImageProfesorDirect">getImageProfesorDirect</a></li><li><a href="global.html">getMinimalFallback</a></li><li><a href="global.html">getProfile</a></li><li><a href="global.html">getTranslation</a></li><li><a href="global.html">isError</a></li><li><a href="global.html">isSuccess</a></li><li><a href="global.html#joinRoleRooms">joinRoleRooms</a></li><li><a href="global.html#jsonSyntaxErrorHandler">jsonSyntaxErrorHandler</a></li><li><a href="global.html">limpiarRespaldosAntiguos</a></li><li><a href="global.html">listarCoordinadores</a></li><li><a href="global.html">listarCoordinadoresDestituidos</a></li><li><a href="global.html">listarRespaldos</a></li><li><a href="global.html#listenNotifications">listenNotifications</a></li><li><a href="global.html#loadEnv">loadEnv</a></li><li><a href="global.html">login</a></li><li><a href="global.html">loginUser</a></li><li><a href="global.html">manejarServicio</a></li><li><a href="global.html">marcarComoLeida</a></li><li><a href="global.html#markAsRead">markAsRead</a></li><li><a href="global.html#middlewareAuth">middlewareAuth</a></li><li><a href="global.html">mostrarAdmin</a></li><li><a href="global.html#mostrarAreasConocimiento">mostrarAreasConocimiento</a></li><li><a href="global.html#mostrarAulaCambiarHorario">mostrarAulaCambiarHorario</a></li><li><a href="global.html">mostrarAulas</a></li><li><a href="global.html#mostrarAulasParaHorario">mostrarAulasParaHorario</a></li><li><a href="global.html">mostrarDisponibilidad</a></li><li><a href="global.html#mostrarHorariosPorAula">mostrarHorariosPorAula</a></li><li><a href="global.html#mostrarHorariosPorSeccion">mostrarHorariosPorSeccion</a></li><li><a href="global.html#mostrarHorariosProfesores">mostrarHorariosProfesores</a></li><li><a href="global.html">mostrarLineasInvestigacion</a></li><li><a href="global.html">mostrarNotificacion</a></li><li><a href="global.html">mostrarPNF</a></li><li><a href="global.html#mostrarPosGrados">mostrarPosGrados</a></li><li><a href="global.html#mostrarPreGrados">mostrarPreGrados</a></li><li><a href="global.html#mostrarProfesor">mostrarProfesor</a></li><li><a href="global.html#mostrarProfesorAPI">mostrarProfesorAPI</a></li><li><a href="global.html#mostrarProfesorCambiarHorario">mostrarProfesorCambiarHorario</a></li><li><a href="global.html">mostrarProfesoresEliminados</a></li><li><a href="global.html#mostrarProfesoresParaHorario">mostrarProfesoresParaHorario</a></li><li><a href="global.html">mostrarSecciones</a></li><li><a href="global.html">mostrarSeccionesByPnfAndValueTrayecto</a></li><li><a href="global.html">mostrarSeccionesByPnfAndValueUnidadCurricular</a></li><li><a href="global.html">mostrarSedes</a></li><li><a href="global.html">mostrarTrayectos</a></li><li><a href="global.html">mostrarTurnos</a></li><li><a href="global.html">mostrarUnidadesCurriculares</a></li><li><a href="global.html">notFound</a></li><li><a href="global.html">obtenerAdminPorId</a></li><li><a href="global.html">obtenerAdminsPorEstado</a></li><li><a href="global.html">obtenerAdminsPorRol</a></li><li><a href="global.html">obtenerAreasConocimiento</a></li><li><a href="global.html#obtenerAuditoria">obtenerAuditoria</a></li><li><a href="global.html">obtenerAuditoriaCompleta</a></li><li><a href="global.html">obtenerAulaPorId</a></li><li><a href="global.html">obtenerAulasDisponibles</a></li><li><a href="global.html">obtenerAulasPorPnf</a></li><li><a href="global.html">obtenerAulasPorSede</a></li><li><a href="global.html">obtenerAulasPorTipo</a></li><li><a href="global.html">obtenerConFiltros</a></li><li><a href="global.html">obtenerCoordinador</a></li><li><a href="global.html">obtenerEstadoSistema</a></li><li><a href="global.html">obtenerHistorialDestituciones</a></li><li><a href="global.html#obtenerHorariosPorAula">obtenerHorariosPorAula</a></li><li><a href="global.html#obtenerHorariosPorProfesor">obtenerHorariosPorProfesor</a></li><li><a href="global.html#obtenerHorariosPorSeccion">obtenerHorariosPorSeccion</a></li><li><a href="global.html#obtenerIdUSerProfesor">obtenerIdUSerProfesor</a></li><li><a href="global.html">obtenerImagen</a></li><li><a href="global.html#obtenerInformacionSistema">obtenerInformacionSistema</a></li><li><a href="global.html#obtenerLogsSistema">obtenerLogsSistema</a></li><li><a href="global.html">obtenerMapaCalorHorarios</a></li><li><a href="global.html#obtenerMapaCalorOcupacion">obtenerMapaCalorOcupacion</a></li><li><a href="global.html">obtenerMetricasAcademicas</a></li><li><a href="global.html">obtenerMetricasSistema</a></li><li><a href="global.html">obtenerPerfil</a></li><li><a href="global.html#obtenerPorAula">obtenerPorAula</a></li><li><a href="global.html#obtenerPorId">obtenerPorId</a></li><li><a href="global.html#obtenerPorProfesor">obtenerPorProfesor</a></li><li><a href="global.html#obtenerPorSeccion">obtenerPorSeccion</a></li><li><a href="global.html">obtenerPosgrados</a></li><li><a href="global.html">obtenerPregrados</a></li><li><a href="global.html#obtenerProfesoresDisponibles">obtenerProfesoresDisponibles</a></li><li><a href="global.html">obtenerReportesEstadisticas</a></li><li><a href="global.html">obtenerRolesDisponibles</a></li><li><a href="global.html">obtenerSedePorId</a></li><li><a href="global.html">obtenerTodas</a></li><li><a href="global.html">obtenerTodos</a></li><li><a href="global.html">obtenerUnidadCurricularPorId</a></li><li><a href="global.html">obtenerUsuarioPorEmail</a></li><li><a href="global.html">obtenerUsuarioPorEmailConToken</a></li><li><a href="global.html">obtenerUsuarioPorId</a></li><li><a href="global.html">paginated</a></li><li><a href="global.html#parseJSONField">parseJSONField</a></li><li><a href="global.html#post/auth/logout">post /auth/logout</a></li><li><a href="global.html">quitarRol</a></li><li><a href="global.html">reactivarPnf</a></li><li><a href="global.html">reasignarCoordinador</a></li><li><a href="global.html#registerAreaConocimiento">registerAreaConocimiento</a></li><li><a href="global.html#registerAula">registerAula</a></li><li><a href="global.html#registerPosGrado">registerPosGrado</a></li><li><a href="global.html#registerPreGrado">registerPreGrado</a></li><li><a href="global.html#registerSede">registerSede</a></li><li><a href="global.html">registrarAdmin</a></li><li><a href="global.html">registrarAula</a></li><li><a href="global.html#registrarHorario">registrarHorario</a></li><li><a href="global.html">registrarLineaInvestigacion</a></li><li><a href="global.html">registrarLineasInvestigacion</a></li><li><a href="global.html">registrarPNF</a></li><li><a href="global.html#registrarProfesor">registrarProfesor</a></li><li><a href="global.html">registrarSede</a></li><li><a href="global.html">registrarUnidadCurricular</a></li><li><a href="global.html#regitrarPNF">regitrarPNF</a></li><li><a href="global.html#regitrarUnidadCurricular">regitrarUnidadCurricular</a></li><li><a href="global.html">reingresar</a></li><li><a href="global.html">reingresoProfesor</a></li><li><a href="global.html#reportesEstadisticas">reportesEstadisticas</a></li><li><a href="global.html">respuestaDatos</a></li><li><a href="global.html">respuestaError</a></li><li><a href="global.html">respuestaExito</a></li><li><a href="global.html">respuestaPaginada</a></li><li><a href="global.html">respuestaPostgres</a></li><li><a href="global.html">respuestaServicio</a></li><li><a href="global.html">respuestaSuccess</a></li><li><a href="global.html">respuestaValidacionError</a></li><li><a href="global.html">restaurarRespaldo</a></li><li><a href="global.html">restituirCoordinador</a></li><li><a href="global.html#searchNotificationDestinatario">searchNotificationDestinatario</a></li><li><a href="global.html#searchNotificationGlobales">searchNotificationGlobales</a></li><li><a href="global.html#searchNotificationRoles">searchNotificationRoles</a></li><li><a href="global.html#searchNotificationUser">searchNotificationUser</a></li><li><a href="global.html#searchNotifications">searchNotifications</a></li><li><a href="global.html#securityMiddleware">securityMiddleware</a></li><li><a href="global.html#sendToGlobals">sendToGlobals</a></li><li><a href="global.html#sendToRoles">sendToRoles</a></li><li><a href="global.html#sendToUser">sendToUser</a></li><li><a href="global.html#socketAuth">socketAuth</a></li><li><a href="global.html#storage">storage</a></li><li><a href="global.html">success</a></li><li><a href="global.html">unauthorized</a></li><li><a href="global.html">updateProfile</a></li><li><a href="global.html">validacionesComunes</a></li><li><a href="global.html#validarFormatoEmail">validarFormatoEmail</a></li><li><a href="global.html#validateAdmins">validateAdmins</a></li><li><a href="global.html#validateAreaConocimiento">validateAreaConocimiento</a></li><li><a href="global.html#validateAsignacionCoordinador">validateAsignacionCoordinador</a></li><li><a href="global.html#validateAula">validateAula</a></li><li><a href="global.html#validateContrasenia">validateContrasenia</a></li><li><a href="global.html#validateCoordinador">validateCoordinador</a></li><li><a href="global.html">validateCreacionSecciones</a></li><li><a href="global.html#validateDestitucion">validateDestitucion</a></li><li><a href="global.html#validateDisponibilidadDocente">validateDisponibilidadDocente</a></li><li><a href="global.html#validateHorario">validateHorario</a></li><li><a href="global.html#validateId">validateId</a></li><li><a href="global.html#validateLineaInvestigacion">validateLineaInvestigacion</a></li><li><a href="global.html#validateLogin">validateLogin</a></li><li><a href="global.html">validateNuevaAreaConocimiento</a></li><li><a href="global.html">validateNuevoPosgrado</a></li><li><a href="global.html">validateNuevoPregrado</a></li><li><a href="global.html#validatePartialAdmins">validatePartialAdmins</a></li><li><a href="global.html#validatePartialAreaConocimiento">validatePartialAreaConocimiento</a></li><li><a href="global.html#validatePartialAula">validatePartialAula</a></li><li><a href="global.html#validatePartialCoordinador">validatePartialCoordinador</a></li><li><a href="global.html#validatePartialDestitucion">validatePartialDestitucion</a></li><li><a href="global.html#validatePartialDisponibilidadDocente">validatePartialDisponibilidadDocente</a></li><li><a href="global.html#validatePartialHorario">validatePartialHorario</a></li><li><a href="global.html#validatePartialLogin">validatePartialLogin</a></li><li><a href="global.html#validatePartialPnf">validatePartialPnf</a></li><li><a href="global.html#validatePartialPosgrado">validatePartialPosgrado</a></li><li><a href="global.html#validatePartialPregrado">validatePartialPregrado</a></li><li><a href="global.html#validatePartialProfesor">validatePartialProfesor</a></li><li><a href="global.html#validatePartialSeccion">validatePartialSeccion</a></li><li><a href="global.html#validatePartialSede">validatePartialSede</a></li><li><a href="global.html#validatePartialUnidadCurricular">validatePartialUnidadCurricular</a></li><li><a href="global.html#validatePartialUser">validatePartialUser</a></li><li><a href="global.html#validatePnf">validatePnf</a></li><li><a href="global.html#validatePosgrado">validatePosgrado</a></li><li><a href="global.html#validatePregrado">validatePregrado</a></li><li><a href="global.html#validateProfesor">validateProfesor</a></li><li><a href="global.html#validateQueryParams">validateQueryParams</a></li><li><a href="global.html#validateRecoveryPassword">validateRecoveryPassword</a></li><li><a href="global.html#validateReingreso">validateReingreso</a></li><li><a href="global.html#validateRequiredFields">validateRequiredFields</a></li><li><a href="global.html#validateSeccion">validateSeccion</a></li><li><a href="global.html#validateSede">validateSede</a></li><li><a href="global.html#validateUnidadCurricular">validateUnidadCurricular</a></li><li><a href="global.html#validateUser">validateUser</a></li><li><a href="global.html">validationError</a></li><li><a href="global.html#verificarConexion">verificarConexion</a></li><li><a href="global.html#verificarConexionInternet">verificarConexionInternet</a></li><li><a href="global.html#verificarDependencias">verificarDependencias</a></li><li><a href="global.html#verificarEmailConAPI">verificarEmailConAPI</a></li><li><a href="global.html">verificarSesion</a></li><li><a href="global.html#verificarUsers">verificarUsers</a></li><li><a href="global.html#verificarYValidarEmails">verificarYValidarEmails</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">services/curricular.service.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import ValidationService from "./validation.service.js";
import CurricularModel from "../models/curricular.model.js";
import FormatterResponseService from "../utils/FormatterResponseService.js";
import NotificationService from "./notification.service.js";

/**
 * @class CurricularService
 * @description Servicio para operaciones de negocio relacionadas con:
 * - Programas Nacionales de Formaci√≥n (PNF)
 * - Unidades Curriculares
 * - Trayectos acad√©micos
 * - Secciones
 */
export default class CurricularService {
  /**
   * @static
   * @async
   * @method registrarPNF
   * @description Registrar un nuevo Programa Nacional de Formaci√≥n (PNF)
   * @param {Object} datos - Datos del PNF
   * @param {Object} user_action - Usuario que realiza la acci√≥n
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async registrarPNF(datos, user_action) {
    try {
      console.log("üîç [registrarPNF] Iniciando registro de PNF...");

      if (process.env.MODE === "DEVELOPMENT") {
        console.log("üìù Datos recibidos:", {
          datos: JSON.stringify(datos, null, 2),
          user_action: user_action,
        });
      }

      // 1. Validar datos del PNF
      console.log("‚úÖ Validando datos del PNF...");
      const validation = ValidationService.validatePnf(datos);

      if (!validation.isValid) {
        console.error("‚ùå Validaci√≥n de datos fallida:", validation.errors);
        return FormatterResponseService.validationError(
          validation.errors,
          "Error de validaci√≥n en registro de PNF"
        );
      }

      // 2. Validar ID de usuario
      console.log("‚úÖ Validando ID de usuario...");
      const idValidation = ValidationService.validateId(
        user_action.id,
        "usuario"
      );

      if (!idValidation.isValid) {
        console.error("‚ùå Validaci√≥n de ID fallida:", idValidation.errors);
        return FormatterResponseService.validationError(
          idValidation.errors,
          "ID de usuario inv√°lido"
        );
      }

      // 3. Crear PNF en el modelo
      console.log("üéì Creando PNF en base de datos...");
      const respuestaModel = await CurricularModel.registrarPNF(
        datos,
        user_action.id
      );

      // Verificar si la respuesta del modelo indica error
      if (respuestaModel.state === "error" || respuestaModel.status >= 400) {
        console.error("‚ùå Error en modelo crear PNF:", respuestaModel);

        return FormatterResponseService.error(
          respuestaModel.title || "Error en base de datos",
          respuestaModel.message || "Error al crear el PNF",
          respuestaModel.status || 500,
          respuestaModel.code || "DB_ERROR",
          {
            originalError:
              process.env.MODE === "DEVELOPMENT" ? respuestaModel : undefined,
          }
        );
      }

      // 4. Enviar notificaci√≥n GLOBAL (PNF es informaci√≥n institucional importante)
      console.log("üîî Enviando notificaci√≥n GLOBAL de PNF...");
      const notificationService = new NotificationService();
      await notificationService.crearNotificacionMasiva({
        titulo: "Nuevo Programa Nacional de Formaci√≥n (PNF)",
        tipo: "pnf_creado",
        contenido: `Se ha registrado el nuevo PNF "${datos.nombrePNF}" (C√≥digo: ${datos.codigoPNF}) en el sistema acad√©mico`,
        metadatos: {
          pnf_nombre: datos.nombrePNF,
          pnf_codigo: datos.codigoPNF,
          pnf_descripcion: datos.descripcionPNF,
          usuario_creador: user_action.id,
          fecha_registro: new Date().toISOString(),
          url_action: `/academico/pnf`,
        },
        // NO se pasan roles_ids ni users_ids ‚Üí Notificaci√≥n global para todos
      });

      console.log("üéâ PNF registrado exitosamente");

      return FormatterResponseService.success(
        {
          message: "PNF creado exitosamente",
          pnf: {
            id: respuestaModel.data?.id_pnf || respuestaModel.data?.id,
            nombre: datos.nombrePNF,
            codigo: datos.codigoPNF,
            descripcion: datos.descripcionPNF,
            estado: "activo",
          },
        },
        "PNF registrado exitosamente",
        {
          status: 201,
          title: "PNF Creado",
        }
      );
    } catch (error) {
      console.error("üí• Error en servicio registrar PNF:", error);

      // Si es un error conocido del modelo, convertirlo a respuesta del servicio
      if (error.state === "error" || error.status >= 400) {
        return FormatterResponseService.error(
          error.title || "Error en base de datos",
          error.message || "Error al crear el PNF",
          error.status || 500,
          error.code || "DB_ERROR",
          {
            originalError:
              process.env.MODE === "DEVELOPMENT" ? error : undefined,
          }
        );
      }

      throw error;
    }
  }

  /**
   * @static
   * @async
   * @method registrarUnidadCurricular
   * @description Registrar una nueva Unidad Curricular
   * @param {number} idTrayecto - ID del trayecto
   * @param {Object} datos - Datos de la unidad curricular
   * @param {Object} user_action - Usuario que realiza la acci√≥n
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async registrarUnidadCurricular(idTrayecto, datos, user_action) {
    try {
      console.log(
        "üîç [registrarUnidadCurricular] Iniciando registro de unidad curricular..."
      );

      if (process.env.MODE === "DEVELOPMENT") {
        console.log("üìù Datos recibidos:", {
          datos: JSON.stringify(datos, null, 2),
          idTrayecto: idTrayecto,
          user_action: user_action,
        });
      }

      // 1. Validar datos de la unidad curricular
      console.log("‚úÖ Validando datos de la unidad curricular...");
      const validation = ValidationService.validateUnidadCurricular(datos);

      if (!validation.isValid) {
        return FormatterResponseService.validationError(
          validation.errors,
          "Error de validaci√≥n en registro de unidad curricular"
        );
      }

      // 2. Validar ID de usuario
      const idValidation = ValidationService.validateId(
        user_action.id,
        "usuario"
      );

      if (!idValidation.isValid) {
        console.error("‚ùå Validaci√≥n de ID fallida:", idValidation.errors);
        return FormatterResponseService.validationError(
          idValidation.errors,
          "ID de usuario inv√°lido"
        );
      }

      // 2. Validar ID de trayecto
      const idTrayectoValidation = ValidationService.validateId(
        idTrayecto,
        "id del trayecto"
      );

      if (!idTrayectoValidation.isValid) {
        console.error(
          "‚ùå Validaci√≥n de ID fallida:",
          idTrayectoValidation.errors
        );
        return FormatterResponseService.validationError(
          idTrayectoValidation.errors,
          "ID de trayecto inv√°lido"
        );
      }

      // 3. Crear unidad curricular en el modelo
      console.log("üìö Creando unidad curricular en base de datos...");
      const respuestaModel = await CurricularModel.registrarUnidadCurricular(
        idTrayecto,
        datos,
        user_action.id
      );

      if (FormatterResponseService.isError(respuestaModel)) {
        console.error(
          "‚ùå Error en modelo crear unidad curricular:",
          respuestaModel
        );
        return respuestaModel;
      }

      // 4. Enviar notificaci√≥n espec√≠fica para coordinaci√≥n acad√©mica
      console.log("üîî Enviando notificaciones de unidad curricular...");
      const notificationService = new NotificationService();
      await notificationService.crearNotificacionMasiva({
        titulo: "Nueva Unidad Curricular Registrada",
        tipo: "unidad_curricular_creada",
        contenido: `Se ha registrado la unidad curricular "${datos.nombreUnidadCurricular}" (C√≥digo: ${datos.codigoUnidadCurricular}) en el sistema`,
        metadatos: {
          unidad_curricular_nombre: datos.nombreUnidadCurricular,
          unidad_curricular_codigo: datos.codigoUnidadCurricular,
          trayecto_id: idTrayecto,
          creditos: datos.creditos,
          horas_academicas: datos.horasAcademicas,
          usuario_creador: user_action.id,
          fecha_registro: new Date().toISOString(),
          url_action: `/academico/unidades-curriculares`,
        },
        roles_ids: [2, 7, 8, 20], // Solo Coordinador, Directores y SuperAdmin
        users_ids: [user_action.id], // Usuario que cre√≥ la unidad curricular
      });

      console.log("üéâ Unidad curricular registrada exitosamente");

      return FormatterResponseService.success(
        {
          message: "Unidad curricular creada exitosamente",
          unidad_curricular: {
            id:
              respuestaModel.data?.id_unidad_curricular ||
              respuestaModel.data?.id,
            nombre: datos.nombreUnidadCurricular,
            codigo: datos.codigoUnidadCurricular,
            trayecto_id: datos.idTrayecto,
            creditos: datos.creditos,
            horas: datos.horasAcademicas,
          },
        },
        "Unidad curricular registrada exitosamente",
        {
          status: 201,
          title: "Unidad Curricular Creada",
        }
      );
    } catch (error) {
      console.error("üí• Error en servicio registrar unidad curricular:", error);
      throw error;
    }
  }
  /**
   * @static
   * @async
   * @method registrarLineaInvestigacion
   * @description Registrar una nueva L√≠nea de Investigaci√≥n
   * @param {Object} datos - Datos de la l√≠nea de investigaci√≥n
   * @param {Object} user_action - Usuario que realiza la acci√≥n
   * @param {number} [id_trayecto] - ID del trayecto asociado (opcional)
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async registrarLineaInvestigacion(
    datos,
    user_action,
    id_trayecto = null
  ) {
    try {
      console.log(
        "üîç [registrarLineaInvestigacion] Iniciando registro de l√≠nea de investigaci√≥n..."
      );

      if (process.env.MODE === "DEVELOPMENT") {
        console.log("üìù Datos recibidos:", {
          datos: JSON.stringify(datos, null, 2),
          id_trayecto: id_trayecto,
          user_action: user_action,
        });
      }

      // 1. Validar datos de la l√≠nea de investigaci√≥n
      console.log("‚úÖ Validando datos de la l√≠nea de investigaci√≥n...");
      const validation = ValidationService.validateLineaInvestigacion(datos);

      if (!validation.isValid) {
        return FormatterResponseService.validationError(
          validation.errors,
          "Error de validaci√≥n en registro de l√≠nea de investigaci√≥n"
        );
      }

      // 2. Validar ID de usuario
      const idValidation = ValidationService.validateId(
        user_action.id,
        "usuario"
      );

      if (!idValidation.isValid) {
        console.error("‚ùå Validaci√≥n de ID fallida:", idValidation.errors);
        return FormatterResponseService.validationError(
          idValidation.errors,
          "ID de usuario inv√°lido"
        );
      }

      // 3. Validar ID de trayecto si se proporciona
      if (id_trayecto !== null) {
        const idTrayectoValidation = ValidationService.validateId(
          id_trayecto,
          "trayecto"
        );

        if (!idTrayectoValidation.isValid) {
          console.error(
            "‚ùå Validaci√≥n de ID de trayecto fallida:",
            idTrayectoValidation.errors
          );
          return FormatterResponseService.validationError(
            idTrayectoValidation.errors,
            "ID de trayecto inv√°lido"
          );
        }
      }

      // 4. Preparar datos para el modelo
      const datosLineaInvestigacion = {
        nombre_linea_investigacion: datos.nombre_linea_investigacion,
        descripcion: datos.descripcion || null,
        activo: datos.activo !== undefined ? datos.activo : true,
        id_trayecto: id_trayecto,
      };

      // 5. Crear l√≠nea de investigaci√≥n en el modelo
      console.log("üìö Creando l√≠nea de investigaci√≥n en base de datos...");
      const respuestaModel = await CurricularModel.registrarLineasInvestigacion(
        datosLineaInvestigacion,
        user_action.id
      );

      if (FormatterResponseService.isError(respuestaModel)) {
        console.error(
          "‚ùå Error en modelo crear l√≠nea de investigaci√≥n:",
          respuestaModel
        );
        return respuestaModel;
      }

      // 6. Enviar notificaci√≥n espec√≠fica para investigaci√≥n
      console.log("üîî Enviando notificaciones de l√≠nea de investigaci√≥n...");
      const notificationService = new NotificationService();
      await notificationService.crearNotificacionMasiva({
        titulo: "Nueva L√≠nea de Investigaci√≥n Registrada",
        tipo: "linea_investigacion_creada",
        contenido: `Se ha registrado la l√≠nea de investigaci√≥n "${datos.nombre_linea_investigacion}" en el sistema`,
        metadatos: {
          linea_investigacion_nombre: datos.nombre_linea_investigacion,
          descripcion: datos.descripcion,
          activo: datos.activo !== undefined ? datos.activo : true,
          id_trayecto: id_trayecto,
          usuario_creador: user_action.id,
          fecha_registro: new Date().toISOString(),
          url_action: `/investigacion/lineas-investigacion`,
        },
        roles_ids: [7, 9, 10, 20], // Directores, SuperAdmin
        users_ids: [user_action.id], // Usuario que cre√≥ la l√≠nea de investigaci√≥n
      });

      console.log("üéâ L√≠nea de investigaci√≥n registrada exitosamente");

      return FormatterResponseService.success(
        {
          message: "L√≠nea de investigaci√≥n creada exitosamente",
          linea_investigacion: {
            id:
              respuestaModel.data?.id_linea_investigacion ||
              respuestaModel.data?.id,
            nombre: datos.nombre_linea_investigacion,
            descripcion: datos.descripcion,
            activo: datos.activo !== undefined ? datos.activo : true,
            id_trayecto: id_trayecto,
          },
        },
        "L√≠nea de investigaci√≥n registrada exitosamente",
        {
          status: 201,
          title: "L√≠nea de Investigaci√≥n Creada",
        }
      );
    } catch (error) {
      console.error(
        "üí• Error en servicio registrar l√≠nea de investigaci√≥n:",
        error
      );
      throw error;
    }
  }

  /**
   * @static
   * @async
   * @method mostrarLineasInvestigacion
   * @description Obtiene las l√≠neas de investigaci√≥n (opcionalmente filtradas por trayecto)
   * @param {number} [id_trayecto] - ID del trayecto asociado (opcional)
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async mostrarLineasInvestigacion(id_trayecto = null) {
    try {
      console.log(
        "üîç [mostrarLineasInvestigacion] Obteniendo l√≠neas de investigaci√≥n..."
      );

      // Validar ID de trayecto si se proporciona
      if (id_trayecto !== null) {
        const idTrayectoValidation = ValidationService.validateId(
          id_trayecto,
          "trayecto"
        );

        if (!idTrayectoValidation.isValid) {
          console.error(
            "‚ùå Validaci√≥n de ID de trayecto fallida:",
            idTrayectoValidation.errors
          );
          return FormatterResponseService.validationError(
            idTrayectoValidation.errors,
            "ID de trayecto inv√°lido"
          );
        }
      }

      // Obtener l√≠neas de investigaci√≥n del modelo
      const respuestaModel = await CurricularModel.mostrarLineasInvestigacion(
        id_trayecto
      );

      if (FormatterResponseService.isError(respuestaModel)) {
        console.error(
          "‚ùå Error en modelo al obtener l√≠neas de investigaci√≥n:",
          respuestaModel
        );
        return respuestaModel;
      }

      return FormatterResponseService.success(
        respuestaModel.data,
        id_trayecto
          ? "L√≠neas de investigaci√≥n obtenidas exitosamente para el trayecto especificado"
          : "Todas las l√≠neas de investigaci√≥n obtenidas exitosamente",
        {
          status: 200,
          title: "L√≠neas de Investigaci√≥n Obtenidas",
        }
      );
    } catch (error) {
      console.error(
        "üí• Error en servicio al obtener l√≠neas de investigaci√≥n:",
        error
      );
      throw error;
    }
  }

  /**
   * @static
   * @async
   * @method mostrarPNF
   * @description Obtener todos los Programas Nacionales de Formaci√≥n registrados con filtros
   * @param {Object} queryParams - Par√°metros de consulta
   * @param {string} queryParams.id_sede - Filtrar por ID de sede
   * @param {string} queryParams.activo - Filtrar por estado activo (true/false)
   * @param {string} queryParams.tiene_coordinador - Filtrar por coordinador asignado (true/false)
   * @param {string} queryParams.search - B√∫squeda por nombre o c√≥digo
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async mostrarPNF(queryParams = {}) {
    try {
      console.log(
        "üîç [mostrarPNF] Obteniendo listado de PNF con filtros:",
        queryParams
      );

      // Preparar filtros para el modelo
      const filters = {};

      // Filtrar por sede
      if (queryParams.id_sede) {
        filters.id_sede = parseInt(queryParams.id_sede);
        if (isNaN(filters.id_sede)) {
          return FormatterResponseService.error(
            "El ID de sede debe ser un n√∫mero v√°lido",
            "Par√°metro inv√°lido",
            { status: 400, title: "Error de validaci√≥n" }
          );
        }
      }

      // Filtrar por estado activo
      if (queryParams.activo !== undefined) {
        filters.activo = queryParams.activo === "true";
      }

      // Filtrar por coordinador asignado
      if (queryParams.tiene_coordinador !== undefined) {
        filters.tiene_coordinador = queryParams.tiene_coordinador === "true";
      }

      // Filtrar por b√∫squeda de texto
      if (queryParams.search &amp;&amp; queryParams.search.trim() !== "") {
        filters.search = queryParams.search.trim();
      }

      const respuestaModel = await CurricularModel.mostrarPNF(filters);

      if (FormatterResponseService.isError(respuestaModel)) {
        console.error("‚ùå Error en modelo obtener PNF:", respuestaModel);
        return respuestaModel;
      }

      const pnfs = respuestaModel.data || [];
      console.log(
        `‚úÖ Se obtuvieron ${pnfs.length} PNF con los filtros aplicados`
      );

      return FormatterResponseService.success(
        {
          pnfs: pnfs,
          total: pnfs.length,
          filters: filters, // Opcional: devolver los filtros aplicados
        },
        "PNF obtenidos exitosamente",
        {
          status: 200,
          title: "Lista de PNF",
        }
      );
    } catch (error) {
      console.error("üí• Error en servicio mostrar PNF:", error);
      throw error;
    }
  }

  /**
   * @static
   * @async
   * @method mostrarTrayectos
   * @description Obtener todos los trayectos acad√©micos registrados ordenados espec√≠ficamente
   * @param {string} codigoPNF - Filtro por PNF (opcional)
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async mostrarTrayectos(codigoPNF = null) {
    try {
      console.log("üîç [mostrarTrayectos] Obteniendo listado de trayectos...", {
        pnf_filtro: codigoPNF,
      });

      const respuestaModel = await CurricularModel.mostrarTrayectos(codigoPNF);

      if (FormatterResponseService.isError(respuestaModel)) {
        console.error("‚ùå Error en modelo obtener trayectos:", respuestaModel);
        return respuestaModel;
      }

      // üî• ORDENAR LOS TRAYECTOS EN EL ORDEN ESPEC√çFICO
      const ordenEspecifico = ["INICIAL", "1", "2", "3", "4", "5", "6"];

      const trayectosOrdenados =
        respuestaModel.data?.sort((a, b) => {
          const indexA = ordenEspecifico.indexOf(a.valor_trayecto?.toString());
          const indexB = ordenEspecifico.indexOf(b.valor_trayecto?.toString());

          // Si ambos est√°n en la lista de orden, usar el orden definido
          if (indexA !== -1 &amp;&amp; indexB !== -1) {
            return indexA - indexB;
          }

          // Si solo A est√° en la lista, A va primero
          if (indexA !== -1) return -1;

          // Si solo B est√° en la lista, B va primero
          if (indexB !== -1) return 1;

          // Si ninguno est√° en la lista, orden alfab√©tico normal
          return (a.valor_trayecto || "")
            .toString()
            .localeCompare((b.valor_trayecto || "").toString());
        }) || [];

      console.log(
        `‚úÖ Se obtuvieron ${trayectosOrdenados.length} trayectos ordenados`
      );

      return FormatterResponseService.success(
        {
          trayectos: trayectosOrdenados,
          total: trayectosOrdenados.length,
          ...(codigoPNF &amp;&amp; { codigoPNF_filtrado: codigoPNF }),
        },
        "Trayectos obtenidos exitosamente",
        {
          status: 200,
          title: "Lista de Trayectos",
        }
      );
    } catch (error) {
      console.error("üí• Error en servicio mostrar trayectos:", error);
      throw error;
    }
  }

  /**
   * @static
   * @async
   * @method mostrarUnidadesCurriculares
   * @description Obtener todas las unidades curriculares de un trayecto
   * @param {number} trayecto - ID del trayecto (opcional)
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async mostrarUnidadesCurriculares(trayecto = null) {
    try {
      console.log(
        "üîç [mostrarUnidadesCurriculares] Obteniendo unidades curriculares...",
        {
          trayecto_filtro: trayecto,
        }
      );

      // Validar trayecto si se proporciona
      if (trayecto !== null) {
        const trayectoValidation = ValidationService.validateId(
          trayecto,
          "trayecto"
        );
        if (!trayectoValidation.isValid) {
          console.error(
            "‚ùå Validaci√≥n de trayecto fallida:",
            trayectoValidation.errors
          );
          return FormatterResponseService.validationError(
            trayectoValidation.errors,
            "ID de trayecto inv√°lido"
          );
        }
      }

      const respuestaModel = await CurricularModel.mostrarUnidadesCurriculares(
        trayecto
      );

      if (FormatterResponseService.isError(respuestaModel)) {
        console.error(
          "‚ùå Error en modelo obtener unidades curriculares:",
          respuestaModel
        );
        return respuestaModel;
      }

      console.log(
        `‚úÖ Se obtuvieron ${
          respuestaModel.data?.length || 0
        } unidades curriculares`
      );

      return FormatterResponseService.success(
        {
          unidades_curriculares: respuestaModel.data,
          total: respuestaModel.data?.length || 0,
          ...(trayecto &amp;&amp; { trayecto_filtrado: trayecto }),
        },
        "Unidades curriculares obtenidas exitosamente",
        {
          status: 200,
          title: "Lista de Unidades Curriculares",
        }
      );
    } catch (error) {
      console.error(
        "üí• Error en servicio mostrar unidades curriculares:",
        error
      );
      throw error;
    }
  }

  /**
   * @static
   * @async
   * @method mostrarSecciones
   * @description Obtener todas las secciones de un trayecto
   * @param {number} trayecto - ID del trayecto (opcional)
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async mostrarSecciones(trayecto = null) {
    try {
      console.log("üîç [mostrarSecciones] Obteniendo secciones...", {
        trayecto_filtro: trayecto,
      });

      // Validar trayecto si se proporciona
      if (trayecto !== null) {
        const trayectoValidation = ValidationService.validateId(
          trayecto,
          "trayecto"
        );
        if (!trayectoValidation.isValid) {
          console.error(
            "‚ùå Validaci√≥n de trayecto fallida:",
            trayectoValidation.errors
          );
          return FormatterResponseService.validationError(
            trayectoValidation.errors,
            "ID de trayecto inv√°lido"
          );
        }
      }

      const respuestaModel = await CurricularModel.mostrarSecciones(trayecto);

      if (FormatterResponseService.isError(respuestaModel)) {
        console.error("‚ùå Error en modelo obtener secciones:", respuestaModel);
        return respuestaModel;
      }

      console.log(
        `‚úÖ Se obtuvieron ${respuestaModel.data?.length || 0} secciones`
      );

      return FormatterResponseService.success(
        {
          secciones: respuestaModel.data,
          total: respuestaModel.data?.length || 0,
          ...(trayecto &amp;&amp; { trayecto_filtrado: trayecto }),
        },
        "Secciones obtenidas exitosamente",
        {
          status: 200,
          title: "Lista de Secciones",
        }
      );
    } catch (error) {
      console.error("üí• Error en servicio mostrar secciones:", error);
      throw error;
    }
  }

  /**
   * @static
   * @async
   * @method mostrarSeccionesByPnfAndValueTrayecto
   * @description Obtener todas las secciones de un trayecto espec√≠fico de un PNF
   * @param {string} codigoPNF - C√≥digo del PNF
   * @param {string|number} valorTrayecto - Valor del trayecto
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async mostrarSeccionesByPnfAndValueTrayecto(codigoPNF, valorTrayecto) {
    try {
      console.log("üîç [Servicio] Obteniendo secciones...", {
        codigoPNF,
        valorTrayecto,
      });

      // Validar par√°metros
      if (!codigoPNF || !valorTrayecto) {
        return FormatterResponseService.error(
          "Los par√°metros codigoPNF y valorTrayecto son requeridos",
          {
            status: 400,
            title: "Par√°metros inv√°lidos",
          }
        );
      }

      const respuestaModel =
        await CurricularModel.mostrarSeccionesByPnfAndValueTrayecto(
          codigoPNF,
          valorTrayecto
        );

      if (FormatterResponseService.isError(respuestaModel)) {
        console.error("‚ùå Error en modelo obtener secciones:", respuestaModel);
        return respuestaModel;
      }

      console.log(
        `‚úÖ Se obtuvieron ${respuestaModel.data?.length || 0} secciones`
      );

      return FormatterResponseService.success(
        {
          secciones: respuestaModel.data,
          total: respuestaModel.data?.length || 0,
          codigoPNF,
          valorTrayecto,
        },
        "Secciones obtenidas exitosamente",
        {
          status: 200,
          title: "Lista de Secciones",
        }
      );
    } catch (error) {
      console.error("üí• Error en servicio mostrar secciones:", error);
      throw error;
    }
  }

  /**
   * @static
   * @async
   * @method mostrarSeccionesByPnfAndValueUnidadCurricular
   * @description Obtener todas las unidades curriculares de un trayecto espec√≠fico de un PNF
   * @param {string} codigoPNF - C√≥digo del PNF
   * @param {string|number} valorTrayecto - Valor del trayecto
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async mostrarSeccionesByPnfAndValueUnidadCurricular(
    codigoPNF,
    valorTrayecto
  ) {
    try {
      console.log("üîç [Servicio] Obteniendo unidades...", {
        codigoPNF,
        valorTrayecto,
      });

      // Validar par√°metros
      if (!codigoPNF || !valorTrayecto) {
        return FormatterResponseService.error(
          "Los par√°metros codigoPNF y valorTrayecto son requeridos",
          {
            status: 400,
            title: "Par√°metros inv√°lidos",
          }
        );
      }

      const respuestaModel =
        await CurricularModel.mostrarSeccionesByPnfAndValueUnidadCurricular(
          codigoPNF,
          valorTrayecto
        );

      if (FormatterResponseService.isError(respuestaModel)) {
        console.error("‚ùå Error en modelo obtener unidades:", respuestaModel);
        return respuestaModel;
      }

      console.log(
        `‚úÖ Se obtuvieron ${respuestaModel.data?.length || 0} unidades`
      );

      return FormatterResponseService.success(
        {
          unidades: respuestaModel.data,
          total: respuestaModel.data?.length || 0,
          codigoPNF,
          valorTrayecto,
        },
        "Secciones obtenidas exitosamente",
        {
          status: 200,
          title: "Lista de Secciones",
        }
      );
    } catch (error) {
      console.error("üí• Error en servicio mostrar unidades:", error);
      throw error;
    }
  }

  /**
   * @static
   * @async
   * @method crearSecciones
   * @description Crear secciones para un trayecto de forma autom√°tica
   * @param {number} idTrayecto - ID del trayecto
   * @param {Object} datos - Datos para la creaci√≥n de secciones
   * @param {Object} user_action - Usuario que realiza la acci√≥n
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async crearSecciones(idTrayecto, datos, user_action) {
    try {
      console.log(
        "üîç [crearSecciones] Creando secciones para trayecto:",
        idTrayecto
      );

      if (process.env.MODE === "DEVELOPMENT") {
        console.log("üìù Datos recibidos:", {
          idTrayecto,
          datos: JSON.stringify(datos, null, 2),
          user_action: user_action,
        });
      }

      // 1. Validar ID del trayecto
      const trayectoValidation = ValidationService.validateId(
        idTrayecto,
        "trayecto"
      );
      if (!trayectoValidation.isValid) {
        console.error(
          "‚ùå Validaci√≥n de trayecto fallida:",
          trayectoValidation.errors
        );
        return FormatterResponseService.validationError(
          trayectoValidation.errors,
          "ID de trayecto inv√°lido"
        );
      }

      // 2. Validar ID de usuario
      const usuarioValidation = ValidationService.validateId(
        user_action.id,
        "usuario"
      );
      if (!usuarioValidation.isValid) {
        console.error(
          "‚ùå Validaci√≥n de usuario fallida:",
          usuarioValidation.errors
        );
        return FormatterResponseService.validationError(
          usuarioValidation.errors,
          "ID de usuario inv√°lido"
        );
      }

      // 3. Validar datos para creaci√≥n de secciones
      const validation = ValidationService.validateCreacionSecciones(datos);
      if (!validation.isValid) {
        console.error("‚ùå Validaci√≥n de datos fallida:", validation.errors);
        return FormatterResponseService.validationError(
          validation.errors,
          "Error de validaci√≥n en creaci√≥n de secciones"
        );
      }

      // 4. Crear secciones en el modelo
      console.log("üìã Creando secciones en base de datos...");
      const respuestaModel = await CurricularModel.CrearSecciones(
        idTrayecto,
        datos,
        user_action.id
      );

      if (FormatterResponseService.isError(respuestaModel)) {
        console.error("‚ùå Error en modelo crear secciones:", respuestaModel);
        return respuestaModel;
      }

      // 5. Enviar notificaci√≥n espec√≠fica para coordinaci√≥n acad√©mica
      console.log("üîî Enviando notificaciones de creaci√≥n de secciones...");
      const notificationService = new NotificationService();
      await notificationService.crearNotificacionMasiva({
        titulo: "Secciones Creadas para Trayecto",
        tipo: "secciones_creadas",
        contenido: `Se han creado ${datos.cantidadSecciones} secciones para el trayecto acad√©mico. Turno: ${datos.turno}`,
        metadatos: {
          trayecto_id: idTrayecto,
          cantidad_secciones: datos.cantidadSecciones,
          turno: datos.turno,
          usuario_creador: user_action.id,
          fecha_creacion: new Date().toISOString(),
          url_action: `/academico/secciones?trayecto=${idTrayecto}`,
        },
        roles_ids: [2, 7, 8, 20], // Solo Coordinador, Directores y SuperAdmin
        users_ids: [user_action.id], // Usuario que cre√≥ las secciones
      });

      console.log("üéâ Secciones creadas exitosamente");

      return FormatterResponseService.success(
        {
          message: "Secciones creadas exitosamente",
          trayecto_id: idTrayecto,
          secciones_creadas: respuestaModel.data || [],
          total_creadas: respuestaModel.data?.length || 0,
        },
        "Secciones creadas exitosamente",
        {
          status: 201,
          title: "Secciones Creadas",
        }
      );
    } catch (error) {
      console.error("üí• Error en servicio crear secciones:", error);
      throw error;
    }
  }

  /**
   * @static
   * @async
   * @method asignarTurnoSeccion
   * @description Asignar un turno a una secci√≥n espec√≠fica
   * @param {number} idSeccion - Id de la seccion
   * @param {Object} datos - Datos para la asignaci√≥n de turno
   * @param {Object} user_action - Usuario que realiza la acci√≥n
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async asignarTurnoSeccion(idSeccion, datos, user_action) {
    try {
      console.log("üîç [asignarTurnoSeccion] Asignando turno a secci√≥n...");

      // 1. Validar ID de usuario
      const turnoValidation = ValidationService.validateId(
        parseInt(datos.idTurno),
        "Id de Turno"
      );
      if (!turnoValidation.isValid) {
        console.error(
          "‚ùå Validaci√≥n de usuario fallida:",
          turnoValidation.errors
        );
        return FormatterResponseService.validationError(
          turnoValidation.errors,
          "ID de usuario inv√°lido"
        );
      }

      // 2. Validar ID de usuario
      const seccionValidacion = ValidationService.validateId(
        parseInt(idSeccion),
        "Id de Secci√≥n"
      );
      if (!seccionValidacion.isValid) {
        console.error(
          "‚ùå Validaci√≥n de usuario fallida:",
          seccionValidacion.errors
        );
        return FormatterResponseService.validationError(
          seccionValidacion.errors,
          "ID de usuario inv√°lido"
        );
      }

      // 3. Validar ID de usuario
      const usuarioValidation = ValidationService.validateId(
        user_action.id,
        "usuario"
      );
      if (!usuarioValidation.isValid) {
        console.error(
          "‚ùå Validaci√≥n de usuario fallida:",
          usuarioValidation.errors
        );
        return FormatterResponseService.validationError(
          usuarioValidation.errors,
          "ID de usuario inv√°lido"
        );
      }

      // 3. Asignar turno en el modelo
      console.log("‚è∞ Asignando turno en base de datos...");
      const respuestaModel = await CurricularModel.asignacionTurnoSeccion(
        idSeccion,
        datos.idTurno,
        user_action
      );

      if (FormatterResponseService.isError(respuestaModel)) {
        console.error("‚ùå Error en modelo asignar turno:", respuestaModel);
        return respuestaModel;
      }

      // 4. Enviar notificaci√≥n espec√≠fica para coordinaci√≥n acad√©mica
      console.log("üîî Enviando notificaciones de asignaci√≥n de turno...");
      const notificationService = new NotificationService();
      await notificationService.crearNotificacionMasiva({
        titulo: "Turno Asignado a Secci√≥n",
        tipo: "turno_asignado",
        contenido: `Se ha asignado un turno a la secci√≥n acad√©mica`,
        metadatos: {
          seccion_id: idSeccion,
          turno_id: datos.idTurno,
          seccion_nombre: respuestaModel.data?.seccion_nombre,
          turno_nombre: respuestaModel.data?.turno_nombre,
          usuario_asignador: user_action.id,
          fecha_asignacion: new Date().toISOString(),
          url_action: `/academico/secciones/${idSeccion}`,
        },
        roles_ids: [2, 7, 8, 20], // Solo Coordinador, Directores y SuperAdmin
        users_ids: [user_action.id], // Usuario que asign√≥ el turno
      });

      console.log("üéâ Turno asignado exitosamente");

      return FormatterResponseService.success(
        {
          message: "Turno asignado exitosamente",
          asignacion: {
            seccion_id: datos.idSeccion,
            turno_id: datos.idTurno,
            seccion_nombre: respuestaModel.data?.seccion_nombre,
            turno_nombre: respuestaModel.data?.turno_nombre,
          },
        },
        "Turno asignado exitosamente",
        {
          status: 200,
          title: "Turno Asignado",
        }
      );
    } catch (error) {
      console.error("üí• Error en servicio asignar turno:", error);
      throw error;
    }
  }

  /**
   * @static
   * @async
   * @method actualizarPNF
   * @description Actualizar un PNF existente
   * @param {number} idPNF - ID del PNF
   * @param {Object} datos - Datos actualizados
   * @param {Object} user_action - Usuario que realiza la acci√≥n
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async actualizarPNF(idPNF, datos, user_action) {
    try {
      console.log("üîç [actualizarPNF] Actualizando PNF ID:", idPNF);

      // Validaciones
      const pnfValidation = ValidationService.validateId(idPNF, "PNF");
      if (!pnfValidation.isValid) {
        return FormatterResponseService.validationError(
          pnfValidation.errors,
          "ID de PNF inv√°lido"
        );
      }

      const usuarioValidation = ValidationService.validateId(
        user_action.id,
        "usuario"
      );
      if (!usuarioValidation.isValid) {
        return FormatterResponseService.validationError(
          usuarioValidation.errors,
          "ID de usuario inv√°lido"
        );
      }

      const validation = ValidationService.validatePartialPnf(datos);
      if (!validation.isValid) {
        return FormatterResponseService.validationError(
          validation.errors,
          "Error de validaci√≥n en actualizaci√≥n de PNF"
        );
      }

      // Actualizar en modelo
      const respuestaModel = await CurricularModel.actualizarPNF(
        idPNF,
        datos,
        user_action.id
      );

      if (FormatterResponseService.isError(respuestaModel)) {
        return respuestaModel;
      }

      // Notificaci√≥n GLOBAL (PNF es informaci√≥n institucional)
      console.log("üîî Enviando notificaci√≥n GLOBAL de actualizaci√≥n de PNF...");
      const notificationService = new NotificationService();
      await notificationService.crearNotificacionMasiva({
        titulo: "PNF Actualizado",
        tipo: "pnf_actualizado",
        contenido: `Se han actualizado los datos del Programa Nacional de Formaci√≥n. Cambios realizados: ${Object.keys(
          datos
        ).join(", ")}`,
        metadatos: {
          pnf_id: idPNF,
          pnf_nombre: datos.nombrePNF,
          campos_actualizados: Object.keys(datos),
          usuario_actualizador: user_action.id,
          fecha_actualizacion: new Date().toISOString(),
          url_action: `/academico/pnf`,
        },
        // NO se pasan roles_ids ni users_ids ‚Üí Notificaci√≥n global para todos
      });

      return FormatterResponseService.success(
        {
          message: "PNF actualizado exitosamente",
          pnf_id: idPNF,
          cambios: datos,
        },
        "PNF actualizado exitosamente",
        {
          status: 200,
          title: "PNF Actualizado",
        }
      );
    } catch (error) {
      console.error("üí• Error en servicio actualizar PNF:", error);
      throw error;
    }
  }

  /**
   * @static
   * @async
   * @method actualizarDescripcionTrayecto
   * @description Actualizar la descripci√≥n de un trayecto espec√≠fico
   * @param {number} idTrayecto - ID del trayecto
   * @param {Object} datos - Datos de actualizaci√≥n
   * @param {string} datos.descripcionTrayecto - Nueva descripci√≥n
   * @param {Object} user_action - Usuario que realiza la acci√≥n
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async actualizarDescripcionTrayecto(idTrayecto, datos, user_action) {
    try {
      console.log(
        "üîç [actualizarDescripcionTrayecto] Actualizando descripci√≥n del trayecto ID:",
        idTrayecto
      );

      if (process.env.MODE === "DEVELOPMENT") {
        console.log("üìù Datos de actualizaci√≥n:", {
          idTrayecto,
          datos: JSON.stringify(datos, null, 2),
          user_action: user_action,
        });
      }

      // 1. Validar ID del trayecto
      const trayectoValidation = ValidationService.validateId(
        idTrayecto,
        "trayecto"
      );
      if (!trayectoValidation.isValid) {
        return FormatterResponseService.validationError(
          trayectoValidation.errors,
          "ID de trayecto inv√°lido"
        );
      }

      // 2. Validar ID de usuario
      const usuarioValidation = ValidationService.validateId(
        user_action.id,
        "usuario"
      );
      if (!usuarioValidation.isValid) {
        return FormatterResponseService.validationError(
          usuarioValidation.errors,
          "ID de usuario inv√°lido"
        );
      }
      console.log(datos);
      // 3. Validar descripci√≥n
      if (
        !datos.descripcion_trayecto ||
        datos.descripcion_trayecto.trim() === ""
      ) {
        return FormatterResponseService.error(
          "Descripci√≥n requerida",
          "La descripci√≥n del trayecto no puede estar vac√≠a",
          400,
          "DESCRIPCION_REQUERIDA"
        );
      }

      const descripcionLimpia = datos.descripcion_trayecto.trim();

      if (descripcionLimpia.length &lt; 10) {
        return FormatterResponseService.error(
          "Descripci√≥n muy corta",
          "La descripci√≥n debe tener al menos 10 caracteres",
          400,
          "DESCRIPCION_MUY_CORTA"
        );
      }

      if (descripcionLimpia.length > 500) {
        return FormatterResponseService.error(
          "Descripci√≥n muy larga",
          "La descripci√≥n no puede exceder los 500 caracteres",
          400,
          "DESCRIPCION_MUY_LARGA"
        );
      }

      // 4. Llamar al modelo para actualizar
      const respuestaModel =
        await CurricularModel.actualizarDescripcionTrayecto(
          idTrayecto,
          descripcionLimpia,
          user_action.id
        );

      if (FormatterResponseService.isError(respuestaModel)) {
        return respuestaModel;
      }

      // 5. Enviar notificaci√≥n espec√≠fica
      console.log(
        "üîî Enviando notificaci√≥n de actualizaci√≥n de descripci√≥n de trayecto..."
      );
      const notificationService = new NotificationService();
      await notificationService.crearNotificacionMasiva({
        titulo: "Descripci√≥n de Trayecto Actualizada",
        tipo: "trayecto_descripcion_actualizada",
        contenido: `Se ha actualizado la descripci√≥n del trayecto "${
          respuestaModel.data?.valor_trayecto || "N/A"
        }"`,
        metadatos: {
          trayecto_id: idTrayecto,
          trayecto_nombre: respuestaModel.data?.valor_trayecto,
          pnf_id: respuestaModel.data?.id_pnf,
          descripcion_anterior: respuestaModel.data?.descripcion_anterior,
          descripcion_nueva: descripcionLimpia,
          usuario_actualizador: user_action.id,
          fecha_actualizacion: new Date().toISOString(),
          url_action: `/academico/trayectos/${idTrayecto}`,
        },
        roles_ids: [2, 7, 8, 10, 20], // Coordinador, Directores, Vicerrector, SuperAdmin
        users_ids: [user_action.id],
      });

      console.log("üéâ Descripci√≥n del trayecto actualizada exitosamente");

      return FormatterResponseService.success(
        {
          message: "Descripci√≥n del trayecto actualizada exitosamente",
          trayecto: {
            id: idTrayecto,
            valor_trayecto: respuestaModel.data?.valor_trayecto,
            descripcion_anterior: respuestaModel.data?.descripcion_anterior,
            descripcion_nueva: descripcionLimpia,
            id_pnf: respuestaModel.data?.id_pnf,
          },
        },
        "Descripci√≥n del trayecto actualizada exitosamente",
        {
          status: 200,
          title: "Descripci√≥n Actualizada",
        }
      );
    } catch (error) {
      console.error(
        "üí• Error en servicio actualizar descripci√≥n de trayecto:",
        error
      );
      throw error;
    }
  }
  /**
   * @static
   * @async
   * @method actualizarUnidadCurricular
   * @description Actualizar una Unidad Curricular existente (parcial o completamente)
   * @param {number} idUnidadCurricular - ID de la unidad curricular
   * @param {Object} datos - Datos de actualizaci√≥n
   * @param {string} [datos.codigo_unidad] - Nuevo c√≥digo de la unidad
   * @param {string} [datos.nombre_unidad_curricular] - Nuevo nombre de la unidad
   * @param {string} [datos.descripcion_unidad_curricular] - Nueva descripci√≥n
   * @param {number} [datos.horas_clase] - Nuevas horas de clase
   * @param {number} [datos.id_trayecto] - Nuevo ID del trayecto
   * @param {Object} user_action - Usuario que realiza la acci√≥n
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async actualizarUnidadCurricular(
    idUnidadCurricular,
    datos,
    user_action
  ) {
    try {
      console.log(
        "üîç [actualizarUnidadCurricular] Actualizando unidad curricular ID:",
        idUnidadCurricular
      );

      if (process.env.MODE === "DEVELOPMENT") {
        console.log("üìù Datos de actualizaci√≥n:", {
          idUnidadCurricular,
          datos: JSON.stringify(datos, null, 2),
          user_action: user_action,
        });
      }

      // 1. Validar ID de la unidad curricular
      const unidadValidation =
        ValidationService.validatePartialUnidadCurricular(
          datos,
          "unidad_curricular"
        );

      if (!unidadValidation.isValid) {
        return FormatterResponseService.validationError(
          unidadValidation.errors,
          "Unidad curricular inv√°lida"
        );
      }

      // 2. Validar ID de usuario
      const usuarioValidation = ValidationService.validateId(
        user_action.id,
        "usuario"
      );
      if (!usuarioValidation.isValid) {
        return FormatterResponseService.validationError(
          usuarioValidation.errors,
          "ID de usuario inv√°lido"
        );
      }

      // 5. Llamar al modelo para actualizar
      const respuestaModel = await CurricularModel.actualizarUnidadCurricular(
        idUnidadCurricular,
        datos,
        user_action.id
      );

      if (FormatterResponseService.isError(respuestaModel)) {
        return respuestaModel;
      }

      // 6. Enviar notificaci√≥n espec√≠fica
      console.log(
        "üîî Enviando notificaci√≥n de actualizaci√≥n de unidad curricular..."
      );
      const notificationService = new NotificationService();

      await notificationService.crearNotificacionMasiva({
        titulo: "Unidad Curricular Actualizada",
        tipo: "unidad_curricular_actualizada",
        contenido: `Se ha actualizado la unidad curricular "${
          respuestaModel.data?.unidad_curricular?.nombre_unidad_curricular ||
          datos.nombre_unidad_curricular ||
          "N/A"
        }"`,
        metadatos: {
          unidad_curricular_id: idUnidadCurricular,
          unidad_curricular_nombre:
            respuestaModel.data?.unidad_curricular?.nombre_unidad_curricular ||
            datos.nombre_unidad_curricular,
          campos_actualizados:
            respuestaModel.data?.unidad_curricular?.campos_actualizados,
          horas_anteriores:
            respuestaModel.data?.unidad_curricular?.horas_anteriores,
          horas_nuevas: respuestaModel.data?.unidad_curricular?.horas_nuevas,
          usuario_actualizador: user_action.id,
          fecha_actualizacion: new Date().toISOString(),
          url_action: `/academico/unidades-curriculares/${idUnidadCurricular}`,
        },
        roles_ids: [2, 7, 8, 10, 20], // Coordinador, Directores, Vicerrector, SuperAdmin
        users_ids: [user_action.id],
      });

      console.log("üéâ Unidad curricular actualizada exitosamente");

      return FormatterResponseService.success(
        {
          message: respuestaModel.message,
          unidad_curricular: respuestaModel.data?.unidad_curricular,
          campos_actualizados:
            respuestaModel.data?.unidad_curricular?.campos_actualizados,
        },
        "Unidad curricular actualizada exitosamente",
        {
          status: 200,
          title: "Unidad Curricular Actualizada",
        }
      );
    } catch (error) {
      console.error(
        "üí• Error en servicio actualizar unidad curricular:",
        error
      );
      throw error;
    }
  }

  /**
   * @static
   * @async
   * @method eliminarUnidadCurricular
   * @description Eliminar una Unidad Curricular f√≠sicamente del sistema
   * @param {number} idUnidadCurricular - ID de la unidad curricular a eliminar
   * @param {Object} user_action - Usuario que realiza la acci√≥n
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async eliminarUnidadCurricular(idUnidadCurricular, user_action) {
    try {
      console.log(
        "üîç [eliminarUnidadCurricular] Iniciando eliminaci√≥n de unidad curricular..."
      );

      if (process.env.MODE === "DEVELOPMENT") {
        console.log("üìù Datos recibidos:", {
          idUnidadCurricular: idUnidadCurricular,
          user_action: user_action,
        });
      }

      // 1. Validar ID de usuario
      const idUsuarioValidation = ValidationService.validateId(
        user_action.id,
        "usuario"
      );

      if (!idUsuarioValidation.isValid) {
        console.error(
          "‚ùå Validaci√≥n de ID de usuario fallida:",
          idUsuarioValidation.errors
        );
        return FormatterResponseService.validationError(
          idUsuarioValidation.errors,
          "ID de usuario inv√°lido"
        );
      }

      // 2. Validar ID de unidad curricular
      const idUnidadValidation = ValidationService.validateId(
        idUnidadCurricular,
        "unidad curricular"
      );

      if (!idUnidadValidation.isValid) {
        console.error(
          "‚ùå Validaci√≥n de ID de unidad curricular fallida:",
          idUnidadValidation.errors
        );
        return FormatterResponseService.validationError(
          idUnidadValidation.errors,
          "ID de unidad curricular inv√°lido"
        );
      }

      // 3. Obtener informaci√≥n de la unidad curricular antes de eliminar (para notificaciones)
      console.log("üìö Obteniendo informaci√≥n de la unidad curricular...");
      const infoUnidadCurricular =
        await CurricularModel.obtenerUnidadCurricularPorId(idUnidadCurricular);

      if (FormatterResponseService.isError(infoUnidadCurricular)) {
        console.error(
          "‚ùå Error al obtener informaci√≥n de unidad curricular:",
          infoUnidadCurricular
        );
        return infoUnidadCurricular;
      }

      // 4. Eliminar unidad curricular en el modelo
      console.log("üóëÔ∏è Eliminando unidad curricular en base de datos...");
      const respuestaModel = await CurricularModel.eliminarUnidadCurricular(
        user_action.id,
        idUnidadCurricular
      );

      if (FormatterResponseService.isError(respuestaModel)) {
        console.error(
          "‚ùå Error en modelo eliminar unidad curricular:",
          respuestaModel
        );
        return respuestaModel;
      }

      // 5. Enviar notificaci√≥n espec√≠fica para coordinaci√≥n acad√©mica
      console.log("üîî Enviando notificaciones de eliminaci√≥n...");
      const notificationService = new NotificationService();
      await notificationService.crearNotificacionMasiva({
        titulo: "Unidad Curricular Eliminada",
        tipo: "unidad_curricular_eliminada",
        contenido: `Se ha eliminado la unidad curricular "${
          infoUnidadCurricular.data?.nombre_unidad_curricular ||
          "Unidad Desconocida"
        }" (C√≥digo: ${
          infoUnidadCurricular.data?.codigo_unidad || "N/A"
        }) del sistema`,
        metadatos: {
          unidad_curricular_nombre:
            infoUnidadCurricular.data?.nombre_unidad_curricular,
          unidad_curricular_codigo: infoUnidadCurricular.data?.codigo_unidad,
          unidad_curricular_id: idUnidadCurricular,
          trayecto_id: infoUnidadCurricular.data?.id_trayecto,
          horas_clase: infoUnidadCurricular.data?.horas_clase,
          usuario_eliminador: user_action.id,
          fecha_eliminacion: new Date().toISOString(),
          url_action: `/academico/unidades-curriculares`,
        },
        roles_ids: [2, 7, 8, 20], // Solo Coordinador, Directores y SuperAdmin
        users_ids: [user_action.id], // Usuario que elimin√≥ la unidad curricular
      });

      console.log("‚úÖ Unidad curricular eliminada exitosamente");

      return FormatterResponseService.success(
        {
          message: "Unidad curricular eliminada exitosamente",
          unidad_curricular_eliminada: {
            id: idUnidadCurricular,
            nombre: infoUnidadCurricular.data?.nombre_unidad_curricular,
            codigo: infoUnidadCurricular.data?.codigo_unidad,
            trayecto_id: infoUnidadCurricular.data?.id_trayecto,
            horas_clase: infoUnidadCurricular.data?.horas_clase,
          },
          registros_afectados: respuestaModel.data?.registros_eliminados || {
            horarios: 0,
            areas_conocimiento: 0,
          },
        },
        "Unidad curricular eliminada permanentemente del sistema",
        {
          status: 200,
          title: "Unidad Curricular Eliminada",
        }
      );
    } catch (error) {
      console.error("üí• Error en servicio eliminar unidad curricular:", error);

      // Manejo espec√≠fico de errores de integridad referencial
      if (
        error.message?.includes("foreign_key_violation") ||
        error.message?.includes("integrity constraint")
      ) {
        return FormatterResponseService.error(
          "No se puede eliminar la unidad curricular porque tiene registros asociados en uso",
          "Error de integridad referencial",
          {
            status: 400,
            details: {
              suggestion:
                "Revise los horarios, secciones u otros registros asociados antes de eliminar",
            },
          }
        );
      }

      throw error;
    }
  }

  /**
   * @static
   * @async
   * @method eliminarPnf
   * @description Eliminar un PNF f√≠sicamente del sistema
   * @param {number} id_pnf - ID del PNF a eliminar
   * @param {Object} user_action - Usuario que realiza la acci√≥n
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async eliminarPnf(id_pnf, user_action) {
    try {
      console.log("üîç [eliminarPnf] Iniciando eliminaci√≥n de PNF...");

      if (process.env.MODE === "DEVELOPMENT") {
        console.log("üìù Datos recibidos:", {
          id_pnf: id_pnf,
          user_action: user_action,
        });
      }

      // 1. Validar ID de usuario
      const idUsuarioValidation = ValidationService.validateId(
        user_action.id,
        "usuario"
      );

      if (!idUsuarioValidation.isValid) {
        console.error(
          "‚ùå Validaci√≥n de ID de usuario fallida:",
          idUsuarioValidation.errors
        );
        return FormatterResponseService.validationError(
          idUsuarioValidation.errors,
          "ID de usuario inv√°lido"
        );
      }

      // 2. Validar ID del PNF
      const idPnfValidation = ValidationService.validateId(id_pnf, "pnf");

      if (!idPnfValidation.isValid) {
        console.error(
          "‚ùå Validaci√≥n de ID de PNF fallida:",
          idPnfValidation.errors
        );
        return FormatterResponseService.validationError(
          idPnfValidation.errors,
          "ID de PNF inv√°lido"
        );
      }

      // 3. Obtener informaci√≥n del PNF antes de eliminar (para notificaciones)
      console.log("üìö Obteniendo informaci√≥n del PNF...");
      const infoPNF = await CurricularModel.mostrarPNF({ searchID: id_pnf });

      if (FormatterResponseService.isError(infoPNF)) {
        console.error("‚ùå Error al obtener informaci√≥n del PNF:", infoPNF);
        return infoPNF;
      }

      if (!infoPNF.data || infoPNF.data.length === 0) {
        console.error("‚ùå PNF no encontrado");
        return FormatterResponseService.error(
          "PNF no encontrado",
          "Error de validaci√≥n",
          { status: 404 }
        );
      }

      const pnfData = infoPNF.data[0];

      // 4. Eliminar PNF en el modelo
      console.log("üóëÔ∏è Eliminando PNF en base de datos...");
      const respuestaModel = await CurricularModel.eliminarPnf(
        user_action.id,
        id_pnf
      );

      if (FormatterResponseService.isError(respuestaModel)) {
        console.error("‚ùå Error en modelo eliminar PNF:", respuestaModel);
        return respuestaModel;
      }

      // 5. Enviar notificaci√≥n espec√≠fica para coordinaci√≥n acad√©mica
      console.log("üîî Enviando notificaciones de eliminaci√≥n...");
      const notificationService = new NotificationService();
      await notificationService.crearNotificacionMasiva({
        titulo: "PNF Eliminado",
        tipo: "pnf_eliminado",
        contenido: `Se ha eliminado el PNF "${
          pnfData.nombre_pnf || "PNF Desconocido"
        }" (C√≥digo: ${
          pnfData.codigo_pnf || "N/A"
        }) del sistema junto con todos sus trayectos y secciones`,
        metadatos: {
          pnf_nombre: pnfData.nombre_pnf,
          pnf_codigo: pnfData.codigo_pnf,
          id_pnf: id_pnf,
          sede_id: pnfData.id_sede,
          trayectos_desactivados:
            respuestaModel.data?.trayectos_desactivados || 0,
          secciones_eliminadas: respuestaModel.data?.secciones_eliminadas || 0,
          usuario_eliminador: user_action.id,
          fecha_eliminacion: new Date().toISOString(),
          url_action: `/academico/pnfs`,
        },
        roles_ids: [2, 7, 8, 20], // Solo Coordinador, Directores y SuperAdmin
        users_ids: [user_action.id], // Usuario que elimin√≥ el PNF
      });

      console.log("‚úÖ PNF eliminado exitosamente");

      return FormatterResponseService.success(
        {
          message: "PNF eliminado exitosamente",
          pnf_eliminado: {
            id: id_pnf,
            nombre: pnfData.nombre_pnf,
            codigo: pnfData.codigo_pnf,
            sede_id: pnfData.id_sede,
            trayectos_desactivados:
              respuestaModel.data?.trayectos_desactivados || 0,
            secciones_eliminadas:
              respuestaModel.data?.secciones_eliminadas || 0,
          },
          registros_afectados: {
            trayectos: respuestaModel.data?.trayectos_desactivados || 0,
            secciones: respuestaModel.data?.secciones_eliminadas || 0,
          },
        },
        "PNF eliminado permanentemente del sistema junto con sus dependencias",
        {
          status: 200,
          title: "PNF Eliminado",
        }
      );
    } catch (error) {
      console.error("üí• Error en servicio eliminar PNF:", error);

      // Manejo espec√≠fico de errores de integridad referencial
      if (
        error.message?.includes("foreign_key_violation") ||
        error.message?.includes("integrity constraint") ||
        error.message?.includes("clave for√°nea")
      ) {
        return FormatterResponseService.error(
          "No se puede eliminar el PNF porque tiene registros asociados en uso",
          "Error de integridad referencial",
          {
            status: 409,
            details: {
              suggestion:
                "Revise los coordinadores, estudiantes u otros registros asociados antes de eliminar",
            },
          }
        );
      }

      // Manejo espec√≠fico de errores de PNF no encontrado
      if (
        error.message?.includes("no existe") ||
        error.message?.includes("not found")
      ) {
        return FormatterResponseService.error(
          "El PNF no existe o ya fue eliminado",
          "Recurso no encontrado",
          { status: 404 }
        );
      }

      // Manejo espec√≠fico de errores de permisos
      if (
        error.message?.includes("permisos") ||
        error.message?.includes("no autorizado")
      ) {
        return FormatterResponseService.error(
          "No tiene permisos para eliminar PNFs",
          "Error de autorizaci√≥n",
          { status: 403 }
        );
      }

      return FormatterResponseService.error(
        "Error interno del servidor al eliminar el PNF",
        "Error del sistema",
        {
          status: 500,
          details: {
            error_message: error.message,
            timestamp: new Date().toISOString(),
          },
        }
      );
    }
  }

  /**
   * @static
   * @async
   * @method reactivarPnf
   * @description Reactivar un PNF en el sistema
   * @param {number} id_pnf - ID del PNF a reactivar
   * @param {Object} user_action - Usuario que realiza la acci√≥n
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async reactivarPnf(id_pnf, user_action) {
    try {
      console.log("üîç [reactivarPnf] Iniciando reactivaci√≥n de PNF...");

      if (process.env.MODE === "DEVELOPMENT") {
        console.log("üìù Datos recibidos:", {
          id_pnf: id_pnf,
          user_action: user_action,
        });
      }

      // 1. Validar ID de usuario
      const idUsuarioValidation = ValidationService.validateId(
        user_action.id,
        "usuario"
      );

      if (!idUsuarioValidation.isValid) {
        console.error(
          "‚ùå Validaci√≥n de ID de usuario fallida:",
          idUsuarioValidation.errors
        );
        return FormatterResponseService.validationError(
          idUsuarioValidation.errors,
          "ID de usuario inv√°lido"
        );
      }

      // 2. Validar ID del PNF
      const idPnfValidation = ValidationService.validateId(id_pnf, "pnf");

      if (!idPnfValidation.isValid) {
        console.error(
          "‚ùå Validaci√≥n de ID de PNF fallida:",
          idPnfValidation.errors
        );
        return FormatterResponseService.validationError(
          idPnfValidation.errors,
          "ID de PNF inv√°lido"
        );
      }

      // 3. Obtener informaci√≥n del PNF antes de reactivar
      console.log("üìö Obteniendo informaci√≥n del PNF...");
      const infoPNF = await CurricularModel.mostrarPNF({ searchID: id_pnf });

      if (FormatterResponseService.isError(infoPNF)) {
        console.error("‚ùå Error al obtener informaci√≥n del PNF:", infoPNF);
        return infoPNF;
      }

      if (!infoPNF.data || infoPNF.data.length === 0) {
        console.error("‚ùå PNF no encontrado");
        return FormatterResponseService.error(
          "PNF no encontrado",
          "Error de validaci√≥n",
          { status: 404 }
        );
      }

      const pnfData = infoPNF.data[0];

      // 4. Reactivar PNF en el modelo
      console.log("üîÑ Reactivando PNF en base de datos...");
      const respuestaModel = await CurricularModel.reactivarPnf(
        user_action.id,
        id_pnf
      );

      if (FormatterResponseService.isError(respuestaModel)) {
        console.error("‚ùå Error en modelo reactivar PNF:", respuestaModel);
        return respuestaModel;
      }

      // 5. Enviar notificaci√≥n
      console.log("üîî Enviando notificaciones de reactivaci√≥n...");
      const notificationService = new NotificationService();
      await notificationService.crearNotificacionMasiva({
        titulo: "PNF Reactivado",
        tipo: "pnf_reactivado",
        contenido: `Se ha reactivado el PNF "${
          pnfData.nombre_pnf || "PNF Desconocido"
        }" (C√≥digo: ${
          pnfData.codigo_pnf || "N/A"
        }) del sistema junto con todos sus trayectos`,
        metadatos: {
          pnf_nombre: pnfData.nombre_pnf,
          pnf_codigo: pnfData.codigo_pnf,
          id_pnf: id_pnf,
          sede_id: pnfData.id_sede,
          trayectos_reactivados:
            respuestaModel.data?.trayectos_reactivados || 0,
          usuario_reactivador: user_action.id,
          fecha_reactivacion: new Date().toISOString(),
          url_action: `/academico/pnfs`,
        },
        roles_ids: [2, 7, 8, 20], // Coordinador, Directores y SuperAdmin
        users_ids: [user_action.id], // Usuario que reactiv√≥ el PNF
      });

      console.log("‚úÖ PNF reactivado exitosamente");

      return FormatterResponseService.success(
        {
          message: "PNF reactivado exitosamente",
          pnf_reactivado: {
            id: id_pnf,
            nombre: pnfData.nombre_pnf,
            codigo: pnfData.codigo_pnf,
            sede_id: pnfData.id_sede,
            trayectos_reactivados:
              respuestaModel.data?.trayectos_reactivados || 0,
          },
        },
        "PNF reactivado exitosamente en el sistema",
        {
          status: 200,
          title: "PNF Reactivado",
        }
      );
    } catch (error) {
      console.error("üí• Error en servicio reactivar PNF:", error);

      // Manejo espec√≠fico de errores
      if (error.message?.includes("ya est√° activo")) {
        return FormatterResponseService.error(
          "El PNF ya se encuentra activo",
          "Error de validaci√≥n",
          { status: 400 }
        );
      }

      if (error.message?.includes("no existe")) {
        return FormatterResponseService.error(
          "El PNF no existe",
          "Recurso no encontrado",
          { status: 404 }
        );
      }

      if (error.message?.includes("permisos")) {
        return FormatterResponseService.error(
          "No tiene permisos para reactivar PNFs",
          "Error de autorizaci√≥n",
          { status: 403 }
        );
      }

      return FormatterResponseService.error(
        "Error interno del servidor al reactivar el PNF",
        "Error del sistema",
        {
          status: 500,
          details: {
            error_message: error.message,
            timestamp: new Date().toISOString(),
          },
        }
      );
    }
  }
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.4</a> on Thu Dec 04 2025 12:35:39 GMT-0400 (hora de Venezuela) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
