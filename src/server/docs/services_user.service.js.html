<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>services/user.service.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AdminController.html">AdminController</a></li><li><a href="AdminModel.html">AdminModel</a></li><li><a href="AdminService.html">AdminService</a></li><li><a href="AulaController.html">AulaController</a></li><li><a href="AulaModel.html">AulaModel</a></li><li><a href="AulaService.html">AulaService</a></li><li><a href="CoordinadorController.html">CoordinadorController</a></li><li><a href="CoordinadorService.html">CoordinadorService</a></li><li><a href="CurricularController.html">CurricularController</a></li><li><a href="CurricularModel.html">CurricularModel</a></li><li><a href="CurricularService.html">CurricularService</a></li><li><a href="DocumentServices.html">DocumentServices</a><ul class='methods'><li data-type='method'><a href="DocumentServices.html#.crearCeldaEstilizada">crearCeldaEstilizada</a></li><li data-type='method'><a href="DocumentServices.html#.crearDocumentoHorario">crearDocumentoHorario</a></li><li data-type='method'><a href="DocumentServices.html#.crearFilaInformacion">crearFilaInformacion</a></li><li data-type='method'><a href="DocumentServices.html#.crearFilasTabla">crearFilasTabla</a></li><li data-type='method'><a href="DocumentServices.html#.crearParrafoEstilizado">crearParrafoEstilizado</a></li><li data-type='method'><a href="DocumentServices.html#.crearTextoEstilizado">crearTextoEstilizado</a></li><li data-type='method'><a href="DocumentServices.html#.generarDocumentoHorario">generarDocumentoHorario</a></li><li data-type='method'><a href="DocumentServices.html#.generarHorasDisponibles">generarHorasDisponibles</a></li><li data-type='method'><a href="DocumentServices.html#.procesarHorario">procesarHorario</a></li><li data-type='method'><a href="DocumentServices.html#.traerLogoMarcaAgua">traerLogoMarcaAgua</a></li></ul></li><li><a href="EmailService.html">EmailService</a></li><li><a href="FormatterResponseController.html">FormatterResponseController</a></li><li><a href="FormatterResponseModel.html">FormatterResponseModel</a></li><li><a href="FormatterResponseService.html">FormatterResponseService</a></li><li><a href="HorarioController.html">HorarioController</a></li><li><a href="HorarioService.html">HorarioService</a></li><li><a href="NotificationController.html">NotificationController</a></li><li><a href="ProfesorController.html">ProfesorController</a></li><li><a href="ProfesorModel.html">ProfesorModel</a></li><li><a href="ProfesorService.html">ProfesorService</a></li><li><a href="SedeController.html">SedeController</a></li><li><a href="SedeModel.html">SedeModel</a></li><li><a href="SedeService.html">SedeService</a></li><li><a href="SystemController.html">SystemController</a></li><li><a href="SystemModel.html">SystemModel</a></li><li><a href="UserController.html">UserController</a></li><li><a href="UserModel.html">UserModel</a></li><li><a href="UserService.html">UserService</a></li><li><a href="ValidationService.html">ValidationService</a></li><li><a href="module.exports_module.exports.html">exports</a></li></ul><h3>Modules</h3><ul><li><a href="module-CoordinadorModel.html">CoordinadorModel</a><ul class='methods'><li data-type='method'><a href="module-CoordinadorModel.html#.actualizarCoordinador">actualizarCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.asignarCoordinador">asignarCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.destituirCoordinador">destituirCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerCoordinador">obtenerCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerCoordinadorPorId">obtenerCoordinadorPorId</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerCoordinadorPorPnf">obtenerCoordinadorPorPnf</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerCoordinadoresActivos">obtenerCoordinadoresActivos</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerDatosCoordinadorCompletos">obtenerDatosCoordinadorCompletos</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerHistorialCoordinador">obtenerHistorialCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerHistorialDestituciones">obtenerHistorialDestituciones</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerTodos">obtenerTodos</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.reasignarCoordinador">reasignarCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.restituirCoordinador">restituirCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.validarCoordinadorActivo">validarCoordinadorActivo</a></li></ul></li><li><a href="module-CurricularRouter.html">CurricularRouter</a></li><li><a href="module-passwordUtils.html">passwordUtils</a><ul class='methods'><li data-type='method'><a href="module-passwordUtils.html#~comparePassword">comparePassword</a></li><li data-type='method'><a href="module-passwordUtils.html#~generarPassword">generarPassword</a></li><li data-type='method'><a href="module-passwordUtils.html#~hashPassword">hashPassword</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html">CrearSecciones</a></li><li><a href="global.html#DELETE/admins/:id">DELETE /admins/:id</a></li><li><a href="global.html#DELETE/aulas/:id">DELETE /aulas/:id</a></li><li><a href="global.html#DELETE/coordinadores/:id/destituir">DELETE /coordinadores/:id/destituir</a></li><li><a href="global.html#DELETE/horarios/:id">DELETE /horarios/:id</a></li><li><a href="global.html#DELETE/profesores/:id">DELETE /profesores/:id</a></li><li><a href="global.html#DELETE/profesores/:id_profesor/disponibilidad/:id_disponibilidad">DELETE /profesores/:id_profesor/disponibilidad/:id_disponibilidad</a></li><li><a href="global.html#DELETE/sedes/:id">DELETE /sedes/:id</a></li><li><a href="global.html#DELETE/system/backups/:backupFileName">DELETE /system/backups/:backupFileName</a></li><li><a href="global.html#DELETE/system/backups/cleanup">DELETE /system/backups/cleanup</a></li><li><a href="global.html#DELETE/user/:id_usuario/desactivar">DELETE /user/:id_usuario/desactivar</a></li><li><a href="global.html#EMAIL_CONFIG">EMAIL_CONFIG</a></li><li><a href="global.html#EnviarTokenEmail">EnviarTokenEmail</a></li><li><a href="global.html#GET/admin/logs">GET /admin/logs</a></li><li><a href="global.html#GET/admin/profile">GET /admin/profile</a></li><li><a href="global.html#GET/admin/reports">GET /admin/reports</a></li><li><a href="global.html#GET/admin/stats">GET /admin/stats</a></li><li><a href="global.html#GET/admins">GET /admins</a></li><li><a href="global.html#GET/admins/search">GET /admins/search</a></li><li><a href="global.html#GET/api/aulas">GET /api/aulas</a></li><li><a href="global.html#GET/api/profesores">GET /api/profesores</a></li><li><a href="global.html#GET/api/system/backups">GET /api/system/backups</a></li><li><a href="global.html#GET/api/system/estadisticas">GET /api/system/estadisticas</a></li><li><a href="global.html#GET/api/system/metricas">GET /api/system/metricas</a></li><li><a href="global.html#GET/api/system/status">GET /api/system/status</a></li><li><a href="global.html#GET/auditory/system">GET /auditory/system</a></li><li><a href="global.html#GET/aulas">GET /aulas</a></li><li><a href="global.html#GET/aulas/:id">GET /aulas/:id</a></li><li><a href="global.html#GET/aulas/pnf/:codigoPNF">GET /aulas/pnf/:codigoPNF</a></li><li><a href="global.html#GET/aulas/sede/:sede">GET /aulas/sede/:sede</a></li><li><a href="global.html#GET/aulas/tipo/:tipo">GET /aulas/tipo/:tipo</a></li><li><a href="global.html#GET/auth/verify">GET /auth/verify</a></li><li><a href="global.html#GET/catalogos/areas-conocimiento">GET /catalogos/areas-conocimiento</a></li><li><a href="global.html#GET/catalogos/posgrados">GET /catalogos/posgrados</a></li><li><a href="global.html#GET/catalogos/pregrados">GET /catalogos/pregrados</a></li><li><a href="global.html#GET/coordinadores">GET /coordinadores</a></li><li><a href="global.html#GET/coordinadores/:id">GET /coordinadores/:id</a></li><li><a href="global.html#GET/coordinadores/:id/historial-destituciones">GET /coordinadores/:id/historial-destituciones</a></li><li><a href="global.html#GET/coordinadores/destituidos">GET /coordinadores/destituidos</a></li><li><a href="global.html#GET/exportar/seccion/:id_seccion">GET /exportar/seccion/:id_seccion</a></li><li><a href="global.html#GET/horarios/aula/:id_aula">GET /horarios/aula/:id_aula</a></li><li><a href="global.html#GET/horarios/profesor/:id_profesor">GET /horarios/profesor/:id_profesor</a></li><li><a href="global.html#GET/horarios/seccion/:id_seccion">GET /horarios/seccion/:id_seccion</a></li><li><a href="global.html#GET/notifications">GET /notifications</a></li><li><a href="global.html#GET/profesores">GET /profesores</a></li><li><a href="global.html#GET/profesores/:id">GET /profesores/:id</a></li><li><a href="global.html#GET/profesores/:id/imagen">GET /profesores/:id/imagen</a></li><li><a href="global.html#GET/profesores/search">GET /profesores/search</a></li><li><a href="global.html#GET/profile">GET /profile</a></li><li><a href="global.html#GET/sedes">GET /sedes</a></li><li><a href="global.html#GET/sedes/:id">GET /sedes/:id</a></li><li><a href="global.html#GET/system/backups">GET /system/backups</a></li><li><a href="global.html#GET/system/backups/download/:backupFileName">GET /system/backups/download/:backupFileName</a></li><li><a href="global.html#GET/system/estado">GET /system/estado</a></li><li><a href="global.html#GET/system/info">GET /system/info</a></li><li><a href="global.html#GET/system/logs">GET /system/logs</a></li><li><a href="global.html#GET/system/mapa-calor/horarios">GET /system/mapa-calor/horarios</a></li><li><a href="global.html#GET/system/metricas/academicas">GET /system/metricas/academicas</a></li><li><a href="global.html#GET/system/metricas/sistema">GET /system/metricas/sistema</a></li><li><a href="global.html#GET/system/reportes/estadisticas">GET /system/reportes/estadisticas</a></li><li><a href="global.html">GuardarTokenEmail</a></li><li><a href="global.html#PATCH/admins/:id/rol">PATCH /admins/:id/rol</a></li><li><a href="global.html#POST/admins">POST /admins</a></li><li><a href="global.html#POST/aulas">POST /aulas</a></li><li><a href="global.html#POST/aulas/to/horarios">POST /aulas/to/horarios</a></li><li><a href="global.html#POST/auth/login">POST /auth/login</a></li><li><a href="global.html#POST/catalogos/areas-conocimiento">POST /catalogos/areas-conocimiento</a></li><li><a href="global.html#POST/catalogos/posgrados">POST /catalogos/posgrados</a></li><li><a href="global.html#POST/catalogos/pregrados">POST /catalogos/pregrados</a></li><li><a href="global.html#POST/coordinadores">POST /coordinadores</a></li><li><a href="global.html#POST/coordinadores/:id/restitur">POST /coordinadores/:id/restitur</a></li><li><a href="global.html#POST/horarios">POST /horarios</a></li><li><a href="global.html#POST/profesores">POST /profesores</a></li><li><a href="global.html#POST/profesores/:id/disponibilidad">POST /profesores/:id/disponibilidad</a></li><li><a href="global.html#POST/profesores/:id/reingresar">POST /profesores/:id/reingresar</a></li><li><a href="global.html#POST/profesores/to/seccion/:id_seccion">POST /profesores/to/seccion/:id_seccion</a></li><li><a href="global.html#POST/sedes">POST /sedes</a></li><li><a href="global.html#POST/system/backup">POST /system/backup</a></li><li><a href="global.html#POST/system/backup/manual">POST /system/backup/manual</a></li><li><a href="global.html#POST/system/restore">POST /system/restore</a></li><li><a href="global.html#PUT/admin/profile">PUT /admin/profile</a></li><li><a href="global.html#PUT/admins/:id">PUT /admins/:id</a></li><li><a href="global.html#PUT/aulas/:id">PUT /aulas/:id</a></li><li><a href="global.html#PUT/auth/password">PUT /auth/password</a></li><li><a href="global.html#PUT/coordinadores/:cedula/reasignar-pnf">PUT /coordinadores/:cedula/reasignar-pnf</a></li><li><a href="global.html#PUT/coordinadores/:id">PUT /coordinadores/:id</a></li><li><a href="global.html#PUT/horarios/:id">PUT /horarios/:id</a></li><li><a href="global.html#PUT/profesores/:id">PUT /profesores/:id</a></li><li><a href="global.html#PUT/profesores/:id_profesor/disponibilidad">PUT /profesores/:id_profesor/disponibilidad</a></li><li><a href="global.html#PUT/sedes/:id">PUT /sedes/:id</a></li><li><a href="global.html#PUT/user/:id_usuario/activar">PUT /user/:id_usuario/activar</a></li><li><a href="global.html">VerificarToken</a></li><li><a href="global.html">activar</a></li><li><a href="global.html">activarUsuario</a></li><li><a href="global.html">actualizar</a></li><li><a href="global.html">actualizarAdmin</a></li><li><a href="global.html">actualizarAula</a></li><li><a href="global.html">actualizarContrase√±aYLimpiarToken</a></li><li><a href="global.html">actualizarCoordinador</a></li><li><a href="global.html">actualizarDescripcionTrayecto</a></li><li><a href="global.html">actualizarDisponibilidad</a></li><li><a href="global.html#actualizarHorario">actualizarHorario</a></li><li><a href="global.html">actualizarPNF</a></li><li><a href="global.html">actualizarPerfil</a></li><li><a href="global.html#actualizarProfesor">actualizarProfesor</a></li><li><a href="global.html">actualizarSede</a></li><li><a href="global.html">actualizarUltimoAcceso</a></li><li><a href="global.html">actualizarUnidadCurricular</a></li><li><a href="global.html#agregarRolDestinatario">agregarRolDestinatario</a></li><li><a href="global.html#agregarUsuarioDestinatario">agregarUsuarioDestinatario</a></li><li><a href="global.html#asegurarStringEnMinusculas">asegurarStringEnMinusculas</a></li><li><a href="global.html">asignacionTurnoSeccion</a></li><li><a href="global.html">asignarCoordinador</a></li><li><a href="global.html">asignarTurnoSeccion</a></li><li><a href="global.html">buscar</a></li><li><a href="global.html">buscarAdmin</a></li><li><a href="global.html">buscarPorEmail</a></li><li><a href="global.html">buscarPorId</a></li><li><a href="global.html#buscarProfesor">buscarProfesor</a></li><li><a href="global.html">cambiarContrase√±a</a></li><li><a href="global.html">cambiarRol</a></li><li><a href="global.html">cambiarRolAdmin</a></li><li><a href="global.html">cerrarSesion</a></li><li><a href="global.html#closeSession">closeSession</a></li><li><a href="global.html">conflict</a></li><li><a href="global.html#connectDB">connectDB</a></li><li><a href="global.html">contarPorRolYEstado</a></li><li><a href="global.html#corsOptions">corsOptions</a></li><li><a href="global.html">crear</a></li><li><a href="global.html">crearAreaConocimiento</a></li><li><a href="global.html">crearDisponibilidad</a></li><li><a href="global.html#crearNotificacionCompleta">crearNotificacionCompleta</a></li><li><a href="global.html#crearNotificacionIndividual">crearNotificacionIndividual</a></li><li><a href="global.html#crearNotificacionMasiva">crearNotificacionMasiva</a></li><li><a href="global.html">crearPosgrado</a></li><li><a href="global.html">crearPregrado</a></li><li><a href="global.html">crearRespaldo</a></li><li><a href="global.html">crearSecciones</a></li><li><a href="global.html#crearSede">crearSede</a></li><li><a href="global.html#createValidationResponse">createValidationResponse</a></li><li><a href="global.html">created</a></li><li><a href="global.html">desactivar</a></li><li><a href="global.html">desactivarAdmin</a></li><li><a href="global.html">desactivarUsuario</a></li><li><a href="global.html#descargarRespaldo">descargarRespaldo</a></li><li><a href="global.html#destituirProfesor">destituirProfesor</a></li><li><a href="global.html#disconnectDB">disconnectDB</a></li><li><a href="global.html">eliminar</a></li><li><a href="global.html">eliminarAula</a></li><li><a href="global.html">eliminarCoordinador</a></li><li><a href="global.html">eliminarDisponibilidad</a></li><li><a href="global.html#eliminarHorario">eliminarHorario</a></li><li><a href="global.html">eliminarPnf</a></li><li><a href="global.html">eliminarRespaldo</a></li><li><a href="global.html">eliminarSede</a></li><li><a href="global.html">eliminarUnidadCurricular</a></li><li><a href="global.html#enviarEmail">enviarEmail</a></li><li><a href="global.html#enviarEmailMultiple">enviarEmailMultiple</a></li><li><a href="global.html">error</a></li><li><a href="global.html#exportarHorarioWord">exportarHorarioWord</a></li><li><a href="global.html">extractData</a></li><li><a href="global.html">extractError</a></li><li><a href="global.html">filtrarPorEstado</a></li><li><a href="global.html">filtrarPorRol</a></li><li><a href="global.html">filtrarPorSede</a></li><li><a href="global.html">filtrarPorTipo</a></li><li><a href="global.html">forbidden</a></li><li><a href="global.html">formatValidationErrors</a></li><li><a href="global.html">fromDatabaseResponse</a></li><li><a href="global.html#generarDocumentoHorario">generarDocumentoHorario</a></li><li><a href="global.html#generateEmailTemplate">generateEmailTemplate</a></li><li><a href="global.html#get/auth/logout">get /auth/logout</a></li><li><a href="global.html#getCookie">getCookie</a></li><li><a href="global.html">getDefaultTitle</a></li><li><a href="global.html">getErrorCode</a></li><li><a href="global.html#getFilterCondition">getFilterCondition</a></li><li><a href="global.html#getImageProfesorDirect">getImageProfesorDirect</a></li><li><a href="global.html">getMinimalFallback</a></li><li><a href="global.html">getProfile</a></li><li><a href="global.html">getTranslation</a></li><li><a href="global.html">isError</a></li><li><a href="global.html">isSuccess</a></li><li><a href="global.html#joinRoleRooms">joinRoleRooms</a></li><li><a href="global.html#jsonSyntaxErrorHandler">jsonSyntaxErrorHandler</a></li><li><a href="global.html">limpiarRespaldosAntiguos</a></li><li><a href="global.html">listarCoordinadores</a></li><li><a href="global.html">listarCoordinadoresDestituidos</a></li><li><a href="global.html">listarRespaldos</a></li><li><a href="global.html#listenNotifications">listenNotifications</a></li><li><a href="global.html#loadEnv">loadEnv</a></li><li><a href="global.html">login</a></li><li><a href="global.html">loginUser</a></li><li><a href="global.html">manejarServicio</a></li><li><a href="global.html">marcarComoLeida</a></li><li><a href="global.html#markAsRead">markAsRead</a></li><li><a href="global.html#middlewareAuth">middlewareAuth</a></li><li><a href="global.html">mostrarAdmin</a></li><li><a href="global.html#mostrarAreasConocimiento">mostrarAreasConocimiento</a></li><li><a href="global.html#mostrarAulaCambiarHorario">mostrarAulaCambiarHorario</a></li><li><a href="global.html">mostrarAulas</a></li><li><a href="global.html#mostrarAulasParaHorario">mostrarAulasParaHorario</a></li><li><a href="global.html">mostrarDisponibilidad</a></li><li><a href="global.html#mostrarHorariosPorAula">mostrarHorariosPorAula</a></li><li><a href="global.html#mostrarHorariosPorSeccion">mostrarHorariosPorSeccion</a></li><li><a href="global.html#mostrarHorariosProfesores">mostrarHorariosProfesores</a></li><li><a href="global.html">mostrarLineasInvestigacion</a></li><li><a href="global.html">mostrarNotificacion</a></li><li><a href="global.html">mostrarPNF</a></li><li><a href="global.html#mostrarPosGrados">mostrarPosGrados</a></li><li><a href="global.html#mostrarPreGrados">mostrarPreGrados</a></li><li><a href="global.html#mostrarProfesor">mostrarProfesor</a></li><li><a href="global.html#mostrarProfesorAPI">mostrarProfesorAPI</a></li><li><a href="global.html#mostrarProfesorCambiarHorario">mostrarProfesorCambiarHorario</a></li><li><a href="global.html">mostrarProfesoresEliminados</a></li><li><a href="global.html#mostrarProfesoresParaHorario">mostrarProfesoresParaHorario</a></li><li><a href="global.html">mostrarSecciones</a></li><li><a href="global.html">mostrarSeccionesByPnfAndValueTrayecto</a></li><li><a href="global.html">mostrarSeccionesByPnfAndValueUnidadCurricular</a></li><li><a href="global.html">mostrarSedes</a></li><li><a href="global.html">mostrarTrayectos</a></li><li><a href="global.html">mostrarTurnos</a></li><li><a href="global.html">mostrarUnidadesCurriculares</a></li><li><a href="global.html">notFound</a></li><li><a href="global.html">obtenerAdminPorId</a></li><li><a href="global.html">obtenerAdminsPorEstado</a></li><li><a href="global.html">obtenerAdminsPorRol</a></li><li><a href="global.html">obtenerAreasConocimiento</a></li><li><a href="global.html#obtenerAuditoria">obtenerAuditoria</a></li><li><a href="global.html">obtenerAuditoriaCompleta</a></li><li><a href="global.html">obtenerAulaPorId</a></li><li><a href="global.html">obtenerAulasDisponibles</a></li><li><a href="global.html">obtenerAulasPorPnf</a></li><li><a href="global.html">obtenerAulasPorSede</a></li><li><a href="global.html">obtenerAulasPorTipo</a></li><li><a href="global.html">obtenerConFiltros</a></li><li><a href="global.html">obtenerCoordinador</a></li><li><a href="global.html">obtenerEstadoSistema</a></li><li><a href="global.html">obtenerHistorialDestituciones</a></li><li><a href="global.html#obtenerHorariosPorAula">obtenerHorariosPorAula</a></li><li><a href="global.html#obtenerHorariosPorProfesor">obtenerHorariosPorProfesor</a></li><li><a href="global.html#obtenerHorariosPorSeccion">obtenerHorariosPorSeccion</a></li><li><a href="global.html#obtenerIdUSerProfesor">obtenerIdUSerProfesor</a></li><li><a href="global.html">obtenerImagen</a></li><li><a href="global.html#obtenerInformacionSistema">obtenerInformacionSistema</a></li><li><a href="global.html#obtenerLogsSistema">obtenerLogsSistema</a></li><li><a href="global.html">obtenerMapaCalorHorarios</a></li><li><a href="global.html#obtenerMapaCalorOcupacion">obtenerMapaCalorOcupacion</a></li><li><a href="global.html">obtenerMetricasAcademicas</a></li><li><a href="global.html">obtenerMetricasSistema</a></li><li><a href="global.html">obtenerPerfil</a></li><li><a href="global.html#obtenerPorAula">obtenerPorAula</a></li><li><a href="global.html#obtenerPorId">obtenerPorId</a></li><li><a href="global.html#obtenerPorProfesor">obtenerPorProfesor</a></li><li><a href="global.html#obtenerPorSeccion">obtenerPorSeccion</a></li><li><a href="global.html">obtenerPosgrados</a></li><li><a href="global.html">obtenerPregrados</a></li><li><a href="global.html#obtenerProfesoresDisponibles">obtenerProfesoresDisponibles</a></li><li><a href="global.html">obtenerReportesEstadisticas</a></li><li><a href="global.html">obtenerRolesDisponibles</a></li><li><a href="global.html">obtenerSedePorId</a></li><li><a href="global.html">obtenerTodas</a></li><li><a href="global.html">obtenerTodos</a></li><li><a href="global.html">obtenerUnidadCurricularPorId</a></li><li><a href="global.html">obtenerUsuarioPorEmail</a></li><li><a href="global.html">obtenerUsuarioPorEmailConToken</a></li><li><a href="global.html">obtenerUsuarioPorId</a></li><li><a href="global.html">paginated</a></li><li><a href="global.html#parseJSONField">parseJSONField</a></li><li><a href="global.html#post/auth/logout">post /auth/logout</a></li><li><a href="global.html">quitarRol</a></li><li><a href="global.html">reactivarPnf</a></li><li><a href="global.html">reasignarCoordinador</a></li><li><a href="global.html#registerAreaConocimiento">registerAreaConocimiento</a></li><li><a href="global.html#registerAula">registerAula</a></li><li><a href="global.html#registerPosGrado">registerPosGrado</a></li><li><a href="global.html#registerPreGrado">registerPreGrado</a></li><li><a href="global.html#registerSede">registerSede</a></li><li><a href="global.html">registrarAdmin</a></li><li><a href="global.html">registrarAula</a></li><li><a href="global.html#registrarHorario">registrarHorario</a></li><li><a href="global.html">registrarLineaInvestigacion</a></li><li><a href="global.html">registrarLineasInvestigacion</a></li><li><a href="global.html">registrarPNF</a></li><li><a href="global.html#registrarProfesor">registrarProfesor</a></li><li><a href="global.html">registrarSede</a></li><li><a href="global.html">registrarUnidadCurricular</a></li><li><a href="global.html#regitrarPNF">regitrarPNF</a></li><li><a href="global.html#regitrarUnidadCurricular">regitrarUnidadCurricular</a></li><li><a href="global.html">reingresar</a></li><li><a href="global.html">reingresoProfesor</a></li><li><a href="global.html#reportesEstadisticas">reportesEstadisticas</a></li><li><a href="global.html">respuestaDatos</a></li><li><a href="global.html">respuestaError</a></li><li><a href="global.html">respuestaExito</a></li><li><a href="global.html">respuestaPaginada</a></li><li><a href="global.html">respuestaPostgres</a></li><li><a href="global.html">respuestaServicio</a></li><li><a href="global.html">respuestaSuccess</a></li><li><a href="global.html">respuestaValidacionError</a></li><li><a href="global.html">restaurarRespaldo</a></li><li><a href="global.html">restituirCoordinador</a></li><li><a href="global.html#searchNotificationDestinatario">searchNotificationDestinatario</a></li><li><a href="global.html#searchNotificationGlobales">searchNotificationGlobales</a></li><li><a href="global.html#searchNotificationRoles">searchNotificationRoles</a></li><li><a href="global.html#searchNotificationUser">searchNotificationUser</a></li><li><a href="global.html#searchNotifications">searchNotifications</a></li><li><a href="global.html#securityMiddleware">securityMiddleware</a></li><li><a href="global.html#sendToGlobals">sendToGlobals</a></li><li><a href="global.html#sendToRoles">sendToRoles</a></li><li><a href="global.html#sendToUser">sendToUser</a></li><li><a href="global.html#socketAuth">socketAuth</a></li><li><a href="global.html#storage">storage</a></li><li><a href="global.html">success</a></li><li><a href="global.html">unauthorized</a></li><li><a href="global.html">updateProfile</a></li><li><a href="global.html">validacionesComunes</a></li><li><a href="global.html#validarFormatoEmail">validarFormatoEmail</a></li><li><a href="global.html#validateAdmins">validateAdmins</a></li><li><a href="global.html#validateAreaConocimiento">validateAreaConocimiento</a></li><li><a href="global.html#validateAsignacionCoordinador">validateAsignacionCoordinador</a></li><li><a href="global.html#validateAula">validateAula</a></li><li><a href="global.html#validateContrasenia">validateContrasenia</a></li><li><a href="global.html#validateCoordinador">validateCoordinador</a></li><li><a href="global.html">validateCreacionSecciones</a></li><li><a href="global.html#validateDestitucion">validateDestitucion</a></li><li><a href="global.html#validateDisponibilidadDocente">validateDisponibilidadDocente</a></li><li><a href="global.html#validateHorario">validateHorario</a></li><li><a href="global.html#validateId">validateId</a></li><li><a href="global.html#validateLineaInvestigacion">validateLineaInvestigacion</a></li><li><a href="global.html#validateLogin">validateLogin</a></li><li><a href="global.html">validateNuevaAreaConocimiento</a></li><li><a href="global.html">validateNuevoPosgrado</a></li><li><a href="global.html">validateNuevoPregrado</a></li><li><a href="global.html#validatePartialAdmins">validatePartialAdmins</a></li><li><a href="global.html#validatePartialAreaConocimiento">validatePartialAreaConocimiento</a></li><li><a href="global.html#validatePartialAula">validatePartialAula</a></li><li><a href="global.html#validatePartialCoordinador">validatePartialCoordinador</a></li><li><a href="global.html#validatePartialDestitucion">validatePartialDestitucion</a></li><li><a href="global.html#validatePartialDisponibilidadDocente">validatePartialDisponibilidadDocente</a></li><li><a href="global.html#validatePartialHorario">validatePartialHorario</a></li><li><a href="global.html#validatePartialLogin">validatePartialLogin</a></li><li><a href="global.html#validatePartialPnf">validatePartialPnf</a></li><li><a href="global.html#validatePartialPosgrado">validatePartialPosgrado</a></li><li><a href="global.html#validatePartialPregrado">validatePartialPregrado</a></li><li><a href="global.html#validatePartialProfesor">validatePartialProfesor</a></li><li><a href="global.html#validatePartialSeccion">validatePartialSeccion</a></li><li><a href="global.html#validatePartialSede">validatePartialSede</a></li><li><a href="global.html#validatePartialUnidadCurricular">validatePartialUnidadCurricular</a></li><li><a href="global.html#validatePartialUser">validatePartialUser</a></li><li><a href="global.html#validatePnf">validatePnf</a></li><li><a href="global.html#validatePosgrado">validatePosgrado</a></li><li><a href="global.html#validatePregrado">validatePregrado</a></li><li><a href="global.html#validateProfesor">validateProfesor</a></li><li><a href="global.html#validateQueryParams">validateQueryParams</a></li><li><a href="global.html#validateRecoveryPassword">validateRecoveryPassword</a></li><li><a href="global.html#validateReingreso">validateReingreso</a></li><li><a href="global.html#validateRequiredFields">validateRequiredFields</a></li><li><a href="global.html#validateSeccion">validateSeccion</a></li><li><a href="global.html#validateSede">validateSede</a></li><li><a href="global.html#validateUnidadCurricular">validateUnidadCurricular</a></li><li><a href="global.html#validateUser">validateUser</a></li><li><a href="global.html">validationError</a></li><li><a href="global.html#verificarConexion">verificarConexion</a></li><li><a href="global.html#verificarConexionInternet">verificarConexionInternet</a></li><li><a href="global.html#verificarDependencias">verificarDependencias</a></li><li><a href="global.html#verificarEmailConAPI">verificarEmailConAPI</a></li><li><a href="global.html">verificarSesion</a></li><li><a href="global.html#verificarUsers">verificarUsers</a></li><li><a href="global.html#verificarYValidarEmails">verificarYValidarEmails</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">services/user.service.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import ValidationService from "./validation.service.js";
import EmailService from "./email.service.js";
import UserModel from "../models/user.model.js";
import SocketServices from "./socket.service.js";
import {
  comparePassword,
  generarPassword,
  hashPassword,
} from "../utils/encrypted.js";
import { createSession } from "../utils/auth.js";
import { asegurarStringEnMinusculas } from "../utils/utilis.js";
import FormatterResponseService from "../utils/FormatterResponseService.js";

/**
 * @class UserService
 * @description Servicio para operaciones de negocio relacionadas con usuarios
 */
export default class UserService {
  /**
   * @static
   * @async
   * @method login
   * @description Iniciar sesi√≥n de usuario
   * @param {Object} datos - Datos de login
   * @param {Object} usuario - Usuario para no crear de nuevo la session
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async login(datos, usuario) {
    try {
      console.log("üîç [login] Iniciando proceso de login...");

      if (usuario) {
        throw FormatterResponseService.error(
          "Ya hay una sesion iniciada",
          "No se puede crear una sesion si ya existe una",
          404
        );
      }

      // 1. Validar datos de entrada
      const validacion = ValidationService.validateLogin(datos);
      if (!validacion.isValid) {
        console.error("‚ùå Validaci√≥n de login fallida:", validacion.errors);
        return FormatterResponseService.validationError(
          validacion.errors,
          "Error de validaci√≥n en login"
        );
      }

      // 2. Buscar usuario en la base de datos
      const email = asegurarStringEnMinusculas(datos.email);
      console.log("üìß Buscando usuario:", email);

      const respuestaModel = await UserModel.loginUser(email);

      // Si el modelo ya retorna un formato de error, lo propagamos
      if (FormatterResponseService.isError(respuestaModel)) {
        console.error("‚ùå Error en modelo login:", respuestaModel);
        return respuestaModel;
      }

      const user = respuestaModel.data;
      console.log("‚úÖ Usuario encontrado:", user.nombres, user.apellidos);

      // 3. Validar contrase√±a
      console.log("üîê Validando contrase√±a...");
      console.log("üìù Contrase√±a ingresada:", datos.password);
      console.log("üìù Contrase√±a almacenada", user.password);
      const validatePassword = await comparePassword(
        datos.password,
        user.password
      );

      if (!validatePassword) {
        console.error("‚ùå Contrase√±a inv√°lida para usuario:", email);
        throw FormatterResponseService.unauthorized(
          "Correo o contrase√±a inv√°lida"
        );
      }

      // 4. Crear token de sesi√≥n
      console.log("üé´ Creando token de sesi√≥n...");
      const token = createSession({
        object: {
          id: user.id,
          apellidos: user.apellidos,
          nombres: user.nombres,
          roles: user.roles,
          ...(user.id_pnf &amp;&amp; { id_pnf: user.id_pnf }), // ‚úÖ Solo agrega si existe
        },
      });

      console.log(
        "‚úÖ Login exitoso para usuario:",
        user.nombres,
        user.apellidos
      );

      // 5. Preparar respuesta exitosa
      return FormatterResponseService.success(
        {
          token: token,
          user: {
            id: user.id,
            apellidos: user.apellidos,
            nombres: user.nombres,
            primera_vez: user.primera_vez,
            roles: user.roles,
            ...(user.id_pnf &amp;&amp; { id_pnf: user.id_pnf }), // ‚úÖ Solo agrega si existe
          },
        },
        "Inicio de sesi√≥n exitoso",
        {
          status: 200,
          title: "Login Exitoso",
        }
      );
    } catch (error) {
      console.error("üí• Error en servicio login:", error);

      // Re-lanza el error para que el controlador lo maneje
      throw error;
    }
  }

  /**
   * Enviar el token para la recuperacion de contrase√±a
   * @static
   * @async
   * @param {object} datos - contiene datos como email
   * @returns {object} - Resultado del enviado del email
   */
  static async EnviarTokenEmail(datos) {
    try {
      console.log("üîç [EnviarTokenEmail] Iniciando env√≠o de token...");

      // 1. Validar datos de entrada
      const validacion = ValidationService.validatePartialLogin(datos);
      if (!validacion.isValid) {
        console.error("‚ùå Validaci√≥n de email fallida:", validacion.errors);
        return FormatterResponseService.validationError(
          validacion.errors,
          "Error de validaci√≥n del correo"
        );
      }

      // 2. Verificar que el usuario existe
      const respuestaModel = await UserModel.obtenerUsuarioPorEmail(
        datos.email
      );
      console.log(respuestaModel);

      if (respuestaModel.state != "success") {
        console.log("‚ùå Usuario no encontrado:", datos.email);
        // Por seguridad, no revelar que el email no existe
        return FormatterResponseService.success(
          null,
          "Si el email existe, se ha enviado el token de recuperaci√≥n",
          { status: 200, title: "Token Enviado" }
        );
      }

      const usuario = respuestaModel.data[0];

      // 3. Generar token seguro (sin hash para el usuario)
      const tokenPlano = await generarPassword(16); // M√°s largo para seguridad
      const token_hash = await hashPassword(tokenPlano);

      // 4. Guardar token con expiraci√≥n (ej: 1 hora)
      await UserModel.GuardarTokenEmail(datos.email, token_hash);

      // 5. Construir URL con par√°metros correctos
      const resetUrl = `${
        process.env.ORIGIN_FRONTEND
      }/recuperar-contrasena?email=${encodeURIComponent(
        datos.email
      )}&amp;token=${encodeURIComponent(tokenPlano)}`;

      // 6. Preparar email con token PLANO (no el hash) y link directo
      const correo = {
        asunto: "Recuperaci√≥n de Contrase√±a - Sistema Acad√©mico",
        html: `
      &lt;div style="font-family: Arial, sans-serif; line-height: 1.6;">
        &lt;h2 style="color: #2c3e50;">Recuperaci√≥n de Contrase√±a&lt;/h2>
        &lt;p>Hola ${usuario.nombres || "usuario"},&lt;/p>
        &lt;p>Has solicitado recuperar tu contrase√±a. Utiliza el siguiente token:&lt;/p>
        &lt;div style="background-color: #f8f9fa; padding: 15px; border-left: 4px solid #3498db; margin: 15px 0; text-align: center;">
          &lt;p style="font-size: 24px; font-weight: bold; letter-spacing: 2px; margin: 0;">${tokenPlano}&lt;/p>
        &lt;/div>
        &lt;p>&lt;strong>Instrucciones:&lt;/strong>&lt;/p>
        &lt;ul>
          &lt;li>Este token expira en 1 hora&lt;/li>
          &lt;li>Copia y pega el token en la plataforma O haz clic en el bot√≥n&lt;/li>
          &lt;li>Si no solicitaste este token, ignora este mensaje&lt;/li>
        &lt;/ul>
        &lt;div style="text-align: center; margin: 20px 0;">
          &lt;a href="${resetUrl}" 
             style="display: inline-block; background-color: #1C75BA; color: white; 
                    padding: 12px 30px; text-decoration: none; border-radius: 5px; 
                    font-weight: bold;">
            Restablecer Contrase√±a
          &lt;/a>
        &lt;/div>
        &lt;p style="color: #7f8c8d; font-size: 12px; text-align: center;">
          Si el bot√≥n no funciona, copia y pega esta URL en tu navegador:&lt;br>
          ${resetUrl}
        &lt;/p>
      &lt;/div>
      `,
      };

      // 7. Enviar email
      const emailService = new EmailService();
      const resultadoEmail = await emailService.enviarEmail({
        Destinatario: datos.email,
        Correo: correo,
        verificarEmail: false,
      });

      if (!resultadoEmail.success) {
        console.error("‚ùå Error al enviar email:", resultadoEmail.error);
        return FormatterResponseService.error(
          "Error al enviar el correo electr√≥nico",
          { status: 500, title: "Error de env√≠o" }
        );
      }

      console.log("‚úÖ Token enviado exitosamente a:", datos.email);
      return FormatterResponseService.success(
        null,
        "Si el email existe, se ha enviado el token de recuperaci√≥n",
        { status: 200, title: "Token Enviado" }
      );
    } catch (error) {
      console.error("üí• Error en servicio EnviarTokenEmail:", error);
      throw error;
    }
  }

  /**
   * @static
   * @async
   * @method VerificarToken
   * @description Verifica si un token de recuperaci√≥n es v√°lido
   * @param {string} email - Email del usuario
   * @param {string} token - Token proporcionado por el usuario (sin hash)
   * @returns {Object} Resultado de la verificaci√≥n
   */
  static async VerificarToken(email, token) {
    try {
      console.log("üîç [VerificarToken] Verificando token...");

      // 1. Buscar usuario con token v√°lido (no expirado)
      const respuestaModel = await UserModel.obtenerUsuarioPorEmailConToken(
        email
      );

      if (respuestaModel.state != "success") {
        console.log("‚ùå Usuario no encontrado o sin token v√°lido:", email);
        return FormatterResponseService.error("Token inv√°lido o expirado", {
          status: 400,
          title: "Token Inv√°lido",
        });
      }

      const usuario = respuestaModel.data[0];
      // 2. Verificar que el token no haya expirado
      const ahora = new Date();
      const expiracion = new Date(usuario.reset_password_expires);

      if (ahora > expiracion) {
        console.log("‚ùå Token expirado para:", email);
        return FormatterResponseService.error("Token expirado", {
          status: 400,
          title: "Token Expirado",
        });
      }

      // 3. Comparar el token plano con el hash almacenado
      const tokenValido = await comparePassword(
        token,
        usuario.reset_password_token
      );

      if (!tokenValido) {
        console.log("‚ùå Token no coincide para:", email);
        return FormatterResponseService.error("Token inv√°lido", {
          status: 400,
          title: "Token Inv√°lido",
        });
      }

      console.log("‚úÖ Token verificado exitosamente para:", email);
      return FormatterResponseService.success(
        {
          email: usuario.email,
          nombres: usuario.nombres,
          tokenValido: true,
        },
        "Token verificado correctamente",
        { status: 200, title: "Token V√°lido" }
      );
    } catch (error) {
      console.error("üí• Error en servicio VerificarToken:", error);
      throw error;
    }
  }

  /**
   * @static
   * @async
   * @method cambiarContrase√±a
   * @description Cambiar contrase√±a del usuario (autenticado o con token de recuperaci√≥n)
   * @param {Object} datos - Datos para cambiar contrase√±a
   * @param {Object} [usuarioActual] - Usuario actual autenticado (opcional)
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async cambiarContrase√±a(datos, usuarioActual = null) {
    try {
      console.log("üîç [cambiarContrase√±a] Iniciando cambio de contrase√±a...");
      console.log(
        "üìù Modo:",
        usuarioActual ? "USUARIO_AUTENTICADO" : "RECUPERACION_CON_TOKEN"
      );

      if (process.env.MODE === "DEVELOPMENT") {
        console.log("üìù Datos recibidos:", {
          datos: datos,
          usuarioActual: usuarioActual
            ? {
                id: usuarioActual.id,
                nombres: usuarioActual.nombres,
                apellidos: usuarioActual.apellidos,
              }
            : "RECUPERACION_CON_TOKEN",
        });
      }

      // 1. Validar datos de entrada seg√∫n el modo
      let validacion;
      if (usuarioActual) {
        // Modo usuario autenticado - valida contrase√±a actual
        validacion = ValidationService.validateContrasenia(datos);
      } else {
        // Modo recuperaci√≥n - valida solo email, token y nueva contrase√±a
        validacion = ValidationService.validateRecoveryPassword(datos);
      }

      if (!validacion.isValid) {
        console.error(
          "‚ùå Validaci√≥n de contrase√±a fallida:",
          validacion.errors
        );
        return FormatterResponseService.validationError(
          validacion.errors,
          "Error de validaci√≥n en cambio de contrase√±a"
        );
      }
      console.log("‚úÖ Validaci√≥n de datos exitosa.");

      let usuarioParaCambio;

      // 2. L√≥gica seg√∫n el modo de operaci√≥n
      if (usuarioActual) {
        // üîê MODO USUARIO AUTENTICADO
        console.log("üîê Modo: Usuario autenticado");

        console.log("üîç Obteniendo datos del usuario para validaci√≥n...");
        const respuestaUsuario = await UserModel.obtenerUsuarioPorId(
          usuarioActual.id
        );

        if (!respuestaUsuario.data || respuestaUsuario.data.length === 0) {
          console.error("‚ùå Usuario no encontrado:", usuarioActual.id);
          return FormatterResponseService.notFound("Usuario no encontrado");
        }

        console.log("‚úÖ Datos del usuario obtenidos para validaci√≥n");
        const { password } = respuestaUsuario.data[0];
        usuarioParaCambio = respuestaUsuario.data[0];

        // Validar contrase√±a actual
        console.log("üîê Validando contrase√±a actual...");
        const validatePassword = await comparePassword(
          datos.antigua_password,
          password
        );

        if (!validatePassword) {
          console.error(
            "‚ùå Contrase√±a actual incorrecta para usuario:",
            usuarioActual.id
          );
          return FormatterResponseService.unauthorized(
            "La contrase√±a actual es incorrecta"
          );
        }
      } else {
        // üîë MODO RECUPERACI√ìN CON TOKEN
        console.log("üîë Modo: Recuperaci√≥n con token");

        const { email, token } = datos;

        // Verificar que el token sea v√°lido y no haya expirado
        console.log("üîç Verificando token de recuperaci√≥n...");

        this.VerificarToken(email, token);
      }

      // 3. Hashear nueva contrase√±a (com√∫n para ambos modos)
      console.log("üîí Hasheando nueva contrase√±a...");
      const passwordHash = await hashPassword(datos.password);

      // 4. Cambiar contrase√±a en la base de datos
      console.log("üíæ Actualizando contrase√±a en base de datos...");

      let respuestaModel;
      if (usuarioActual) {
        // Modo autenticado - cambiar contrase√±a normalmente
        respuestaModel = await UserModel.cambiarContrase√±a(
          usuarioActual.id,
          passwordHash
        );
      } else {
        // Modo recuperaci√≥n - cambiar contrase√±a y limpiar token
        respuestaModel = await UserModel.actualizarContrase√±aYLimpiarToken(
          datos.email,
          passwordHash
        );
      }

      if (FormatterResponseService.isError(respuestaModel)) {
        console.error("‚ùå Error en modelo cambiar contrase√±a:", respuestaModel);
        return respuestaModel;
      }

      console.log("‚úÖ Contrase√±a cambiada exitosamente");

      const mensajeExito = usuarioActual
        ? "Contrase√±a cambiada exitosamente"
        : "Contrase√±a restablecida exitosamente. Ahora puedes iniciar sesi√≥n con tu nueva contrase√±a";

      return FormatterResponseService.success(null, mensajeExito, {
        status: 200,
        title: usuarioActual
          ? "Contrase√±a Actualizada"
          : "Contrase√±a Restablecida",
      });
    } catch (error) {
      console.error("üí• Error en servicio cambiar contrase√±a:", error);

      if (error.name === "ValidationError") {
        return FormatterResponseService.validationError(
          error.details || [],
          error.message
        );
      }

      // Re-lanza el error para que el controlador lo maneje
      throw error;
    }
  }

  /**
   * @static
   * @async
   * @method verificarSesion
   * @description Verificar la sesi√≥n del usuario
   * @param {Object} user - Usuario autenticado
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async verificarSesion(user) {
    try {
      if (!user) {
        FormatterResponseService.unauthorized("Usuario no autenticado");
      }
      return FormatterResponseService.success(
        user,
        "Sesi√≥n verificada exitosamente",
        {
          status: 200,
          title: "Sesi√≥n Activa",
          verifiedAt: new Date().toISOString(),
          userStatus: "active",
        }
      );
    } catch (error) {
      console.error("üí• Error en servicio verificar sesi√≥n:", error);

      if (["ECONNREFUSED", "ETIMEDOUT"].includes(error.code)) {
        return FormatterResponseService.error(
          "Error de conexi√≥n con la base de datos",
          503,
          "DATABASE_UNAVAILABLE"
        );
      }

      // Re-lanza el error para que el controlador lo maneje
      throw error;
    }
  }

  /**
   * @static
   * @async
   * @method obtenerPerfil
   * @description Obtener perfil del usuario
   * @param {number} userId - ID del usuario
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async obtenerPerfil(userId) {
    try {
      console.log("üîç [obtenerPerfil] Obteniendo perfil para usuario:", userId);

      // Validar ID de usuario
      const idValidation = ValidationService.validateId(userId, "usuario");
      if (!idValidation.isValid) {
        console.error("‚ùå Validaci√≥n de ID fallida:", idValidation.errors);
        return FormatterResponseService.validationError(
          idValidation.errors,
          "ID de usuario inv√°lido"
        );
      }

      const respuestaModel = await UserModel.obtenerUsuarioPorId(userId);

      if (FormatterResponseService.isError(respuestaModel)) {
        console.error("‚ùå Error en modelo obtener perfil:", respuestaModel);
        return respuestaModel;
      }

      if (!respuestaModel.data) {
        console.error("‚ùå Usuario no encontrado:", userId);
        return FormatterResponseService.notFound("Usuario", userId);
      }

      const user = respuestaModel.data;

      // Remover informaci√≥n sensible antes de enviar
      const { password, ...userSafe } = user;

      console.log(
        "‚úÖ Perfil obtenido exitosamente para:",
        user.nombres,
        user.apellidos
      );

      return FormatterResponseService.success(
        userSafe,
        "Perfil obtenido exitosamente",
        {
          status: 200,
          title: "Perfil de Usuario",
        }
      );
    } catch (error) {
      console.error("üí• Error en servicio obtener perfil:", error);
      // Re-lanza el error para que el controlador lo maneje
      throw error;
    }
  }

  /**
   * @static
   * @async
   * @method actualizarPerfil
   * @description Actualizar perfil del usuario
   * @param {number} userId - ID del usuario
   * @param {Object} datosActualizacion - Datos a actualizar
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async actualizarPerfil(userId, datosActualizacion) {
    try {
      console.log(
        "üîç [actualizarPerfil] Actualizando perfil para usuario:",
        userId
      );

      if (process.env.MODE === "DEVELOPMENT") {
        console.log(
          "üìù Datos de actualizaci√≥n:",
          JSON.stringify(datosActualizacion, null, 2)
        );
      }

      // Validar ID de usuario
      const idValidation = ValidationService.validateId(userId, "usuario");
      if (!idValidation.isValid) {
        console.error("‚ùå Validaci√≥n de ID fallida:", idValidation.errors);
        return FormatterResponseService.validationError(
          idValidation.errors,
          "ID de usuario inv√°lido"
        );
      }

      // Validar datos de actualizaci√≥n
      const validacion =
        ValidationService.validateActualizacionPerfil(datosActualizacion);
      if (!validacion.isValid) {
        console.error(
          "‚ùå Validaci√≥n de actualizaci√≥n fallida:",
          validacion.errors
        );
        return FormatterResponseService.validationError(
          validacion.errors,
          "Error de validaci√≥n en actualizaci√≥n de perfil"
        );
      }

      const respuestaModel = await UserModel.actualizarUsuario(
        userId,
        datosActualizacion
      );

      if (FormatterResponseService.isError(respuestaModel)) {
        console.error("‚ùå Error en modelo actualizar perfil:", respuestaModel);
        return respuestaModel;
      }

      console.log("‚úÖ Perfil actualizado exitosamente para usuario:", userId);

      return FormatterResponseService.success(
        respuestaModel.data,
        "Perfil actualizado exitosamente",
        {
          status: 200,
          title: "Perfil Actualizado",
        }
      );
    } catch (error) {
      console.error("üí• Error en servicio actualizar perfil:", error);

      if (error.name === "ValidationError") {
        return FormatterResponseService.validationError(
          error.details,
          error.message
        );
      }

      // Re-lanza el error para que el controlador lo maneje
      throw error;
    }
  }

  /**
   * @static
   * @async
   * @method cerrarSesion
   * @description Cerrar sesi√≥n del usuario
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async cerrarSesion() {
    try {
      console.log("üîç [cerrarSesion] Cerrando sesi√≥n...");

      // En un sistema m√°s complejo, aqu√≠ podr√≠as invalidar tokens, etc.
      // Por ahora simplemente retornamos √©xito ya que el controlador se encarga de limpiar la cookie

      return FormatterResponseService.success(
        null,
        "Sesi√≥n cerrada exitosamente",
        {
          status: 200,
          title: "Sesi√≥n Cerrada",
        }
      );
    } catch (error) {
      console.error("üí• Error en servicio cerrar sesi√≥n:", error);
      // Re-lanza el error para que el controlador lo maneje
      throw error;
    }
  }

  /**
   * @static
   * @async
   * @method desactivarUsuario
   * @description Desactivar un usuario del sistema
   * @param {number} usuario_accion - ID del usuario que realiza la acci√≥n
   * @param {number} id_usuario - ID del usuario a desactivar
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async desactivarUsuario(usuario_accion, id_usuario) {
    try {
      console.log("üîç [desactivarUsuario] Desactivando usuario...");

      // Validar ID del usuario que realiza la acci√≥n
      const validateIdUser = ValidationService.validateId(
        usuario_accion,
        "id usuario accion"
      );

      if (!validateIdUser.isValid) {
        console.error("‚ùå Validaci√≥n de ID fallida:", validateIdUser.errors);
        return FormatterResponseService.validationError(
          validateIdUser.errors,
          "ID de usuario accion inv√°lido"
        );
      }

      // Validar ID del usuario a desactivar
      const validateId = ValidationService.validateId(
        id_usuario,
        "id usuario a desactivar"
      );

      if (!validateId.isValid) {
        console.error("‚ùå Validaci√≥n de ID fallida:", validateId.errors);
        return FormatterResponseService.validationError(
          validateId.errors,
          "ID de usuario a desactivar inv√°lido"
        );
      }

      // Verificar que no sea auto-desactivaci√≥n
      if (usuario_accion === id_usuario) {
        console.error("‚ùå Intento de auto-desactivaci√≥n");
        return FormatterResponseService.error(
          "No puedes desactivar tu propio usuario",
          400,
          "Auto-desactivaci√≥n no permitida"
        );
      }

      // Llamar al modelo para desactivar el usuario
      const resultado = await UserModel.desactivarUsuario(
        usuario_accion,
        id_usuario
      );

      // ‚úÖ CORREGIDO: Emitir evento de cierre de sesi√≥n
      console.log(`üì° Emitiendo close_sesion para usuario: ${id_usuario}`);

      const socket = new SocketServices("websocket");
      const io = socket.initializeService();

      io.to(`user_${id_usuario}`).emit("close_sesion", {
        userId: id_usuario,
        actionBy: usuario_accion,
        timestamp: new Date().toISOString(),
        reason: "usuario_desactivado",
        message: "Tu cuenta ha sido desactivada por un administrador",
      });

      console.log(`‚úÖ Usuario ${id_usuario} desactivado y notificado`);

      return FormatterResponseService.success(
        resultado,
        "Usuario desactivado exitosamente",
        {
          status: 200,
          title: "Usuario Desactivado",
        }
      );
    } catch (error) {
      console.error("üí• Error en servicio desactivar usuario:", error);
      throw error;
    }
  }

  /**
   * @static
   * @async
   * @method activarUsuario
   * @description Activar un usuario previamente desactivado
   * @param {number} usuario_accion - ID del usuario que realiza la acci√≥n
   * @param {number} id_usuario - ID del usuario a activar
   * @returns {Object} Resultado de la operaci√≥n
   */
  static async activarUsuario(usuario_accion, id_usuario) {
    try {
      console.log("üîç [activarUsuario] Activando usuario...");

      // Validar ID del usuario que realiza la acci√≥n
      const validateIdUser = ValidationService.validateId(
        usuario_accion,
        "id usuario accion"
      );

      if (!validateIdUser.isValid) {
        console.error("‚ùå Validaci√≥n de ID fallida:", validateIdUser.errors);
        return FormatterResponseService.validationError(
          validateIdUser.errors,
          "ID de usuario accion inv√°lido"
        );
      }

      // Validar ID del usuario a activar
      const validateId = ValidationService.validateId(
        id_usuario,
        "id usuario a activar"
      );

      if (!validateId.isValid) {
        console.error("‚ùå Validaci√≥n de ID fallida:", validateId.errors);
        return FormatterResponseService.validationError(
          validateId.errors,
          "ID de usuario a activar inv√°lido"
        );
      }

      // Llamar al modelo para activar el usuario
      const resultado = await UserModel.activarUsuario(
        usuario_accion,
        id_usuario
      );

      return FormatterResponseService.success(
        resultado,
        "Usuario activado exitosamente",
        {
          status: 200,
          title: "Usuario Activado",
        }
      );
    } catch (error) {
      console.error("üí• Error en servicio activar usuario:", error);
      throw error;
    }
  }
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.4</a> on Thu Dec 04 2025 12:35:39 GMT-0400 (hora de Venezuela) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
