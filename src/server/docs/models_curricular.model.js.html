<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>models/curricular.model.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AdminController.html">AdminController</a></li><li><a href="AdminModel.html">AdminModel</a></li><li><a href="AdminService.html">AdminService</a></li><li><a href="AulaController.html">AulaController</a></li><li><a href="AulaModel.html">AulaModel</a></li><li><a href="AulaService.html">AulaService</a></li><li><a href="CoordinadorController.html">CoordinadorController</a></li><li><a href="CoordinadorService.html">CoordinadorService</a></li><li><a href="CurricularController.html">CurricularController</a></li><li><a href="CurricularModel.html">CurricularModel</a></li><li><a href="CurricularService.html">CurricularService</a></li><li><a href="DocumentServices.html">DocumentServices</a><ul class='methods'><li data-type='method'><a href="DocumentServices.html#.crearCeldaEstilizada">crearCeldaEstilizada</a></li><li data-type='method'><a href="DocumentServices.html#.crearDocumentoHorario">crearDocumentoHorario</a></li><li data-type='method'><a href="DocumentServices.html#.crearFilaInformacion">crearFilaInformacion</a></li><li data-type='method'><a href="DocumentServices.html#.crearFilasTabla">crearFilasTabla</a></li><li data-type='method'><a href="DocumentServices.html#.crearParrafoEstilizado">crearParrafoEstilizado</a></li><li data-type='method'><a href="DocumentServices.html#.crearTextoEstilizado">crearTextoEstilizado</a></li><li data-type='method'><a href="DocumentServices.html#.generarDocumentoHorario">generarDocumentoHorario</a></li><li data-type='method'><a href="DocumentServices.html#.generarHorasDisponibles">generarHorasDisponibles</a></li><li data-type='method'><a href="DocumentServices.html#.procesarHorario">procesarHorario</a></li><li data-type='method'><a href="DocumentServices.html#.traerLogoMarcaAgua">traerLogoMarcaAgua</a></li></ul></li><li><a href="EmailService.html">EmailService</a></li><li><a href="FormatterResponseController.html">FormatterResponseController</a></li><li><a href="FormatterResponseModel.html">FormatterResponseModel</a></li><li><a href="FormatterResponseService.html">FormatterResponseService</a></li><li><a href="HorarioController.html">HorarioController</a></li><li><a href="HorarioService.html">HorarioService</a></li><li><a href="NotificationController.html">NotificationController</a></li><li><a href="ProfesorController.html">ProfesorController</a></li><li><a href="ProfesorModel.html">ProfesorModel</a></li><li><a href="ProfesorService.html">ProfesorService</a></li><li><a href="SedeController.html">SedeController</a></li><li><a href="SedeModel.html">SedeModel</a></li><li><a href="SedeService.html">SedeService</a></li><li><a href="SystemController.html">SystemController</a></li><li><a href="SystemModel.html">SystemModel</a></li><li><a href="UserController.html">UserController</a></li><li><a href="UserModel.html">UserModel</a></li><li><a href="UserService.html">UserService</a></li><li><a href="ValidationService.html">ValidationService</a></li><li><a href="module.exports_module.exports.html">exports</a></li></ul><h3>Modules</h3><ul><li><a href="module-CoordinadorModel.html">CoordinadorModel</a><ul class='methods'><li data-type='method'><a href="module-CoordinadorModel.html#.actualizarCoordinador">actualizarCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.asignarCoordinador">asignarCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.destituirCoordinador">destituirCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerCoordinador">obtenerCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerCoordinadorPorId">obtenerCoordinadorPorId</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerCoordinadorPorPnf">obtenerCoordinadorPorPnf</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerCoordinadoresActivos">obtenerCoordinadoresActivos</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerDatosCoordinadorCompletos">obtenerDatosCoordinadorCompletos</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerHistorialCoordinador">obtenerHistorialCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerHistorialDestituciones">obtenerHistorialDestituciones</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerTodos">obtenerTodos</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.reasignarCoordinador">reasignarCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.restituirCoordinador">restituirCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.validarCoordinadorActivo">validarCoordinadorActivo</a></li></ul></li><li><a href="module-CurricularRouter.html">CurricularRouter</a></li><li><a href="module-passwordUtils.html">passwordUtils</a><ul class='methods'><li data-type='method'><a href="module-passwordUtils.html#~comparePassword">comparePassword</a></li><li data-type='method'><a href="module-passwordUtils.html#~generarPassword">generarPassword</a></li><li data-type='method'><a href="module-passwordUtils.html#~hashPassword">hashPassword</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html">CrearSecciones</a></li><li><a href="global.html#DELETE/admins/:id">DELETE /admins/:id</a></li><li><a href="global.html#DELETE/aulas/:id">DELETE /aulas/:id</a></li><li><a href="global.html#DELETE/coordinadores/:id/destituir">DELETE /coordinadores/:id/destituir</a></li><li><a href="global.html#DELETE/horarios/:id">DELETE /horarios/:id</a></li><li><a href="global.html#DELETE/profesores/:id">DELETE /profesores/:id</a></li><li><a href="global.html#DELETE/profesores/:id_profesor/disponibilidad/:id_disponibilidad">DELETE /profesores/:id_profesor/disponibilidad/:id_disponibilidad</a></li><li><a href="global.html#DELETE/sedes/:id">DELETE /sedes/:id</a></li><li><a href="global.html#DELETE/system/backups/:backupFileName">DELETE /system/backups/:backupFileName</a></li><li><a href="global.html#DELETE/system/backups/cleanup">DELETE /system/backups/cleanup</a></li><li><a href="global.html#DELETE/user/:id_usuario/desactivar">DELETE /user/:id_usuario/desactivar</a></li><li><a href="global.html#EMAIL_CONFIG">EMAIL_CONFIG</a></li><li><a href="global.html#EnviarTokenEmail">EnviarTokenEmail</a></li><li><a href="global.html#GET/admin/logs">GET /admin/logs</a></li><li><a href="global.html#GET/admin/profile">GET /admin/profile</a></li><li><a href="global.html#GET/admin/reports">GET /admin/reports</a></li><li><a href="global.html#GET/admin/stats">GET /admin/stats</a></li><li><a href="global.html#GET/admins">GET /admins</a></li><li><a href="global.html#GET/admins/search">GET /admins/search</a></li><li><a href="global.html#GET/api/aulas">GET /api/aulas</a></li><li><a href="global.html#GET/api/profesores">GET /api/profesores</a></li><li><a href="global.html#GET/api/system/backups">GET /api/system/backups</a></li><li><a href="global.html#GET/api/system/estadisticas">GET /api/system/estadisticas</a></li><li><a href="global.html#GET/api/system/metricas">GET /api/system/metricas</a></li><li><a href="global.html#GET/api/system/status">GET /api/system/status</a></li><li><a href="global.html#GET/auditory/system">GET /auditory/system</a></li><li><a href="global.html#GET/aulas">GET /aulas</a></li><li><a href="global.html#GET/aulas/:id">GET /aulas/:id</a></li><li><a href="global.html#GET/aulas/pnf/:codigoPNF">GET /aulas/pnf/:codigoPNF</a></li><li><a href="global.html#GET/aulas/sede/:sede">GET /aulas/sede/:sede</a></li><li><a href="global.html#GET/aulas/tipo/:tipo">GET /aulas/tipo/:tipo</a></li><li><a href="global.html#GET/auth/verify">GET /auth/verify</a></li><li><a href="global.html#GET/catalogos/areas-conocimiento">GET /catalogos/areas-conocimiento</a></li><li><a href="global.html#GET/catalogos/posgrados">GET /catalogos/posgrados</a></li><li><a href="global.html#GET/catalogos/pregrados">GET /catalogos/pregrados</a></li><li><a href="global.html#GET/coordinadores">GET /coordinadores</a></li><li><a href="global.html#GET/coordinadores/:id">GET /coordinadores/:id</a></li><li><a href="global.html#GET/coordinadores/:id/historial-destituciones">GET /coordinadores/:id/historial-destituciones</a></li><li><a href="global.html#GET/coordinadores/destituidos">GET /coordinadores/destituidos</a></li><li><a href="global.html#GET/exportar/seccion/:id_seccion">GET /exportar/seccion/:id_seccion</a></li><li><a href="global.html#GET/horarios/aula/:id_aula">GET /horarios/aula/:id_aula</a></li><li><a href="global.html#GET/horarios/profesor/:id_profesor">GET /horarios/profesor/:id_profesor</a></li><li><a href="global.html#GET/horarios/seccion/:id_seccion">GET /horarios/seccion/:id_seccion</a></li><li><a href="global.html#GET/notifications">GET /notifications</a></li><li><a href="global.html#GET/profesores">GET /profesores</a></li><li><a href="global.html#GET/profesores/:id">GET /profesores/:id</a></li><li><a href="global.html#GET/profesores/:id/imagen">GET /profesores/:id/imagen</a></li><li><a href="global.html#GET/profesores/search">GET /profesores/search</a></li><li><a href="global.html#GET/profile">GET /profile</a></li><li><a href="global.html#GET/sedes">GET /sedes</a></li><li><a href="global.html#GET/sedes/:id">GET /sedes/:id</a></li><li><a href="global.html#GET/system/backups">GET /system/backups</a></li><li><a href="global.html#GET/system/backups/download/:backupFileName">GET /system/backups/download/:backupFileName</a></li><li><a href="global.html#GET/system/estado">GET /system/estado</a></li><li><a href="global.html#GET/system/info">GET /system/info</a></li><li><a href="global.html#GET/system/logs">GET /system/logs</a></li><li><a href="global.html#GET/system/mapa-calor/horarios">GET /system/mapa-calor/horarios</a></li><li><a href="global.html#GET/system/metricas/academicas">GET /system/metricas/academicas</a></li><li><a href="global.html#GET/system/metricas/sistema">GET /system/metricas/sistema</a></li><li><a href="global.html#GET/system/reportes/estadisticas">GET /system/reportes/estadisticas</a></li><li><a href="global.html">GuardarTokenEmail</a></li><li><a href="global.html#PATCH/admins/:id/rol">PATCH /admins/:id/rol</a></li><li><a href="global.html#POST/admins">POST /admins</a></li><li><a href="global.html#POST/aulas">POST /aulas</a></li><li><a href="global.html#POST/aulas/to/horarios">POST /aulas/to/horarios</a></li><li><a href="global.html#POST/auth/login">POST /auth/login</a></li><li><a href="global.html#POST/catalogos/areas-conocimiento">POST /catalogos/areas-conocimiento</a></li><li><a href="global.html#POST/catalogos/posgrados">POST /catalogos/posgrados</a></li><li><a href="global.html#POST/catalogos/pregrados">POST /catalogos/pregrados</a></li><li><a href="global.html#POST/coordinadores">POST /coordinadores</a></li><li><a href="global.html#POST/coordinadores/:id/restitur">POST /coordinadores/:id/restitur</a></li><li><a href="global.html#POST/horarios">POST /horarios</a></li><li><a href="global.html#POST/profesores">POST /profesores</a></li><li><a href="global.html#POST/profesores/:id/disponibilidad">POST /profesores/:id/disponibilidad</a></li><li><a href="global.html#POST/profesores/:id/reingresar">POST /profesores/:id/reingresar</a></li><li><a href="global.html#POST/profesores/to/seccion/:id_seccion">POST /profesores/to/seccion/:id_seccion</a></li><li><a href="global.html#POST/sedes">POST /sedes</a></li><li><a href="global.html#POST/system/backup">POST /system/backup</a></li><li><a href="global.html#POST/system/backup/manual">POST /system/backup/manual</a></li><li><a href="global.html#POST/system/restore">POST /system/restore</a></li><li><a href="global.html#PUT/admin/profile">PUT /admin/profile</a></li><li><a href="global.html#PUT/admins/:id">PUT /admins/:id</a></li><li><a href="global.html#PUT/aulas/:id">PUT /aulas/:id</a></li><li><a href="global.html#PUT/auth/password">PUT /auth/password</a></li><li><a href="global.html#PUT/coordinadores/:cedula/reasignar-pnf">PUT /coordinadores/:cedula/reasignar-pnf</a></li><li><a href="global.html#PUT/coordinadores/:id">PUT /coordinadores/:id</a></li><li><a href="global.html#PUT/horarios/:id">PUT /horarios/:id</a></li><li><a href="global.html#PUT/profesores/:id">PUT /profesores/:id</a></li><li><a href="global.html#PUT/profesores/:id_profesor/disponibilidad">PUT /profesores/:id_profesor/disponibilidad</a></li><li><a href="global.html#PUT/sedes/:id">PUT /sedes/:id</a></li><li><a href="global.html#PUT/user/:id_usuario/activar">PUT /user/:id_usuario/activar</a></li><li><a href="global.html">VerificarToken</a></li><li><a href="global.html">activar</a></li><li><a href="global.html">activarUsuario</a></li><li><a href="global.html">actualizar</a></li><li><a href="global.html">actualizarAdmin</a></li><li><a href="global.html">actualizarAula</a></li><li><a href="global.html">actualizarContrase帽aYLimpiarToken</a></li><li><a href="global.html">actualizarCoordinador</a></li><li><a href="global.html">actualizarDescripcionTrayecto</a></li><li><a href="global.html">actualizarDisponibilidad</a></li><li><a href="global.html#actualizarHorario">actualizarHorario</a></li><li><a href="global.html">actualizarPNF</a></li><li><a href="global.html">actualizarPerfil</a></li><li><a href="global.html#actualizarProfesor">actualizarProfesor</a></li><li><a href="global.html">actualizarSede</a></li><li><a href="global.html">actualizarUltimoAcceso</a></li><li><a href="global.html">actualizarUnidadCurricular</a></li><li><a href="global.html#agregarRolDestinatario">agregarRolDestinatario</a></li><li><a href="global.html#agregarUsuarioDestinatario">agregarUsuarioDestinatario</a></li><li><a href="global.html#asegurarStringEnMinusculas">asegurarStringEnMinusculas</a></li><li><a href="global.html">asignacionTurnoSeccion</a></li><li><a href="global.html">asignarCoordinador</a></li><li><a href="global.html">asignarTurnoSeccion</a></li><li><a href="global.html">buscar</a></li><li><a href="global.html">buscarAdmin</a></li><li><a href="global.html">buscarPorEmail</a></li><li><a href="global.html">buscarPorId</a></li><li><a href="global.html#buscarProfesor">buscarProfesor</a></li><li><a href="global.html">cambiarContrase帽a</a></li><li><a href="global.html">cambiarRol</a></li><li><a href="global.html">cambiarRolAdmin</a></li><li><a href="global.html">cerrarSesion</a></li><li><a href="global.html#closeSession">closeSession</a></li><li><a href="global.html">conflict</a></li><li><a href="global.html#connectDB">connectDB</a></li><li><a href="global.html">contarPorRolYEstado</a></li><li><a href="global.html#corsOptions">corsOptions</a></li><li><a href="global.html">crear</a></li><li><a href="global.html">crearAreaConocimiento</a></li><li><a href="global.html">crearDisponibilidad</a></li><li><a href="global.html#crearNotificacionCompleta">crearNotificacionCompleta</a></li><li><a href="global.html#crearNotificacionIndividual">crearNotificacionIndividual</a></li><li><a href="global.html#crearNotificacionMasiva">crearNotificacionMasiva</a></li><li><a href="global.html">crearPosgrado</a></li><li><a href="global.html">crearPregrado</a></li><li><a href="global.html">crearRespaldo</a></li><li><a href="global.html">crearSecciones</a></li><li><a href="global.html#crearSede">crearSede</a></li><li><a href="global.html#createValidationResponse">createValidationResponse</a></li><li><a href="global.html">created</a></li><li><a href="global.html">desactivar</a></li><li><a href="global.html">desactivarAdmin</a></li><li><a href="global.html">desactivarUsuario</a></li><li><a href="global.html#descargarRespaldo">descargarRespaldo</a></li><li><a href="global.html#destituirProfesor">destituirProfesor</a></li><li><a href="global.html#disconnectDB">disconnectDB</a></li><li><a href="global.html">eliminar</a></li><li><a href="global.html">eliminarAula</a></li><li><a href="global.html">eliminarCoordinador</a></li><li><a href="global.html">eliminarDisponibilidad</a></li><li><a href="global.html#eliminarHorario">eliminarHorario</a></li><li><a href="global.html">eliminarPnf</a></li><li><a href="global.html">eliminarRespaldo</a></li><li><a href="global.html">eliminarSede</a></li><li><a href="global.html">eliminarUnidadCurricular</a></li><li><a href="global.html#enviarEmail">enviarEmail</a></li><li><a href="global.html#enviarEmailMultiple">enviarEmailMultiple</a></li><li><a href="global.html">error</a></li><li><a href="global.html#exportarHorarioWord">exportarHorarioWord</a></li><li><a href="global.html">extractData</a></li><li><a href="global.html">extractError</a></li><li><a href="global.html">filtrarPorEstado</a></li><li><a href="global.html">filtrarPorRol</a></li><li><a href="global.html">filtrarPorSede</a></li><li><a href="global.html">filtrarPorTipo</a></li><li><a href="global.html">forbidden</a></li><li><a href="global.html">formatValidationErrors</a></li><li><a href="global.html">fromDatabaseResponse</a></li><li><a href="global.html#generarDocumentoHorario">generarDocumentoHorario</a></li><li><a href="global.html#generateEmailTemplate">generateEmailTemplate</a></li><li><a href="global.html#get/auth/logout">get /auth/logout</a></li><li><a href="global.html#getCookie">getCookie</a></li><li><a href="global.html">getDefaultTitle</a></li><li><a href="global.html">getErrorCode</a></li><li><a href="global.html#getFilterCondition">getFilterCondition</a></li><li><a href="global.html#getImageProfesorDirect">getImageProfesorDirect</a></li><li><a href="global.html">getMinimalFallback</a></li><li><a href="global.html">getProfile</a></li><li><a href="global.html">getTranslation</a></li><li><a href="global.html">isError</a></li><li><a href="global.html">isSuccess</a></li><li><a href="global.html#joinRoleRooms">joinRoleRooms</a></li><li><a href="global.html#jsonSyntaxErrorHandler">jsonSyntaxErrorHandler</a></li><li><a href="global.html">limpiarRespaldosAntiguos</a></li><li><a href="global.html">listarCoordinadores</a></li><li><a href="global.html">listarCoordinadoresDestituidos</a></li><li><a href="global.html">listarRespaldos</a></li><li><a href="global.html#listenNotifications">listenNotifications</a></li><li><a href="global.html#loadEnv">loadEnv</a></li><li><a href="global.html">login</a></li><li><a href="global.html">loginUser</a></li><li><a href="global.html">manejarServicio</a></li><li><a href="global.html">marcarComoLeida</a></li><li><a href="global.html#markAsRead">markAsRead</a></li><li><a href="global.html#middlewareAuth">middlewareAuth</a></li><li><a href="global.html">mostrarAdmin</a></li><li><a href="global.html#mostrarAreasConocimiento">mostrarAreasConocimiento</a></li><li><a href="global.html#mostrarAulaCambiarHorario">mostrarAulaCambiarHorario</a></li><li><a href="global.html">mostrarAulas</a></li><li><a href="global.html#mostrarAulasParaHorario">mostrarAulasParaHorario</a></li><li><a href="global.html">mostrarDisponibilidad</a></li><li><a href="global.html#mostrarHorariosPorAula">mostrarHorariosPorAula</a></li><li><a href="global.html#mostrarHorariosPorSeccion">mostrarHorariosPorSeccion</a></li><li><a href="global.html#mostrarHorariosProfesores">mostrarHorariosProfesores</a></li><li><a href="global.html">mostrarLineasInvestigacion</a></li><li><a href="global.html">mostrarNotificacion</a></li><li><a href="global.html">mostrarPNF</a></li><li><a href="global.html#mostrarPosGrados">mostrarPosGrados</a></li><li><a href="global.html#mostrarPreGrados">mostrarPreGrados</a></li><li><a href="global.html#mostrarProfesor">mostrarProfesor</a></li><li><a href="global.html#mostrarProfesorAPI">mostrarProfesorAPI</a></li><li><a href="global.html#mostrarProfesorCambiarHorario">mostrarProfesorCambiarHorario</a></li><li><a href="global.html">mostrarProfesoresEliminados</a></li><li><a href="global.html#mostrarProfesoresParaHorario">mostrarProfesoresParaHorario</a></li><li><a href="global.html">mostrarSecciones</a></li><li><a href="global.html">mostrarSeccionesByPnfAndValueTrayecto</a></li><li><a href="global.html">mostrarSeccionesByPnfAndValueUnidadCurricular</a></li><li><a href="global.html">mostrarSedes</a></li><li><a href="global.html">mostrarTrayectos</a></li><li><a href="global.html">mostrarTurnos</a></li><li><a href="global.html">mostrarUnidadesCurriculares</a></li><li><a href="global.html">notFound</a></li><li><a href="global.html">obtenerAdminPorId</a></li><li><a href="global.html">obtenerAdminsPorEstado</a></li><li><a href="global.html">obtenerAdminsPorRol</a></li><li><a href="global.html">obtenerAreasConocimiento</a></li><li><a href="global.html#obtenerAuditoria">obtenerAuditoria</a></li><li><a href="global.html">obtenerAuditoriaCompleta</a></li><li><a href="global.html">obtenerAulaPorId</a></li><li><a href="global.html">obtenerAulasDisponibles</a></li><li><a href="global.html">obtenerAulasPorPnf</a></li><li><a href="global.html">obtenerAulasPorSede</a></li><li><a href="global.html">obtenerAulasPorTipo</a></li><li><a href="global.html">obtenerConFiltros</a></li><li><a href="global.html">obtenerCoordinador</a></li><li><a href="global.html">obtenerEstadoSistema</a></li><li><a href="global.html">obtenerHistorialDestituciones</a></li><li><a href="global.html#obtenerHorariosPorAula">obtenerHorariosPorAula</a></li><li><a href="global.html#obtenerHorariosPorProfesor">obtenerHorariosPorProfesor</a></li><li><a href="global.html#obtenerHorariosPorSeccion">obtenerHorariosPorSeccion</a></li><li><a href="global.html#obtenerIdUSerProfesor">obtenerIdUSerProfesor</a></li><li><a href="global.html">obtenerImagen</a></li><li><a href="global.html#obtenerInformacionSistema">obtenerInformacionSistema</a></li><li><a href="global.html#obtenerLogsSistema">obtenerLogsSistema</a></li><li><a href="global.html">obtenerMapaCalorHorarios</a></li><li><a href="global.html#obtenerMapaCalorOcupacion">obtenerMapaCalorOcupacion</a></li><li><a href="global.html">obtenerMetricasAcademicas</a></li><li><a href="global.html">obtenerMetricasSistema</a></li><li><a href="global.html">obtenerPerfil</a></li><li><a href="global.html#obtenerPorAula">obtenerPorAula</a></li><li><a href="global.html#obtenerPorId">obtenerPorId</a></li><li><a href="global.html#obtenerPorProfesor">obtenerPorProfesor</a></li><li><a href="global.html#obtenerPorSeccion">obtenerPorSeccion</a></li><li><a href="global.html">obtenerPosgrados</a></li><li><a href="global.html">obtenerPregrados</a></li><li><a href="global.html#obtenerProfesoresDisponibles">obtenerProfesoresDisponibles</a></li><li><a href="global.html">obtenerReportesEstadisticas</a></li><li><a href="global.html">obtenerRolesDisponibles</a></li><li><a href="global.html">obtenerSedePorId</a></li><li><a href="global.html">obtenerTodas</a></li><li><a href="global.html">obtenerTodos</a></li><li><a href="global.html">obtenerUnidadCurricularPorId</a></li><li><a href="global.html">obtenerUsuarioPorEmail</a></li><li><a href="global.html">obtenerUsuarioPorEmailConToken</a></li><li><a href="global.html">obtenerUsuarioPorId</a></li><li><a href="global.html">paginated</a></li><li><a href="global.html#parseJSONField">parseJSONField</a></li><li><a href="global.html#post/auth/logout">post /auth/logout</a></li><li><a href="global.html">quitarRol</a></li><li><a href="global.html">reactivarPnf</a></li><li><a href="global.html">reasignarCoordinador</a></li><li><a href="global.html#registerAreaConocimiento">registerAreaConocimiento</a></li><li><a href="global.html#registerAula">registerAula</a></li><li><a href="global.html#registerPosGrado">registerPosGrado</a></li><li><a href="global.html#registerPreGrado">registerPreGrado</a></li><li><a href="global.html#registerSede">registerSede</a></li><li><a href="global.html">registrarAdmin</a></li><li><a href="global.html">registrarAula</a></li><li><a href="global.html#registrarHorario">registrarHorario</a></li><li><a href="global.html">registrarLineaInvestigacion</a></li><li><a href="global.html">registrarLineasInvestigacion</a></li><li><a href="global.html">registrarPNF</a></li><li><a href="global.html#registrarProfesor">registrarProfesor</a></li><li><a href="global.html">registrarSede</a></li><li><a href="global.html">registrarUnidadCurricular</a></li><li><a href="global.html#regitrarPNF">regitrarPNF</a></li><li><a href="global.html#regitrarUnidadCurricular">regitrarUnidadCurricular</a></li><li><a href="global.html">reingresar</a></li><li><a href="global.html">reingresoProfesor</a></li><li><a href="global.html#reportesEstadisticas">reportesEstadisticas</a></li><li><a href="global.html">respuestaDatos</a></li><li><a href="global.html">respuestaError</a></li><li><a href="global.html">respuestaExito</a></li><li><a href="global.html">respuestaPaginada</a></li><li><a href="global.html">respuestaPostgres</a></li><li><a href="global.html">respuestaServicio</a></li><li><a href="global.html">respuestaSuccess</a></li><li><a href="global.html">respuestaValidacionError</a></li><li><a href="global.html">restaurarRespaldo</a></li><li><a href="global.html">restituirCoordinador</a></li><li><a href="global.html#searchNotificationDestinatario">searchNotificationDestinatario</a></li><li><a href="global.html#searchNotificationGlobales">searchNotificationGlobales</a></li><li><a href="global.html#searchNotificationRoles">searchNotificationRoles</a></li><li><a href="global.html#searchNotificationUser">searchNotificationUser</a></li><li><a href="global.html#searchNotifications">searchNotifications</a></li><li><a href="global.html#securityMiddleware">securityMiddleware</a></li><li><a href="global.html#sendToGlobals">sendToGlobals</a></li><li><a href="global.html#sendToRoles">sendToRoles</a></li><li><a href="global.html#sendToUser">sendToUser</a></li><li><a href="global.html#socketAuth">socketAuth</a></li><li><a href="global.html#storage">storage</a></li><li><a href="global.html">success</a></li><li><a href="global.html">unauthorized</a></li><li><a href="global.html">updateProfile</a></li><li><a href="global.html">validacionesComunes</a></li><li><a href="global.html#validarFormatoEmail">validarFormatoEmail</a></li><li><a href="global.html#validateAdmins">validateAdmins</a></li><li><a href="global.html#validateAreaConocimiento">validateAreaConocimiento</a></li><li><a href="global.html#validateAsignacionCoordinador">validateAsignacionCoordinador</a></li><li><a href="global.html#validateAula">validateAula</a></li><li><a href="global.html#validateContrasenia">validateContrasenia</a></li><li><a href="global.html#validateCoordinador">validateCoordinador</a></li><li><a href="global.html">validateCreacionSecciones</a></li><li><a href="global.html#validateDestitucion">validateDestitucion</a></li><li><a href="global.html#validateDisponibilidadDocente">validateDisponibilidadDocente</a></li><li><a href="global.html#validateHorario">validateHorario</a></li><li><a href="global.html#validateId">validateId</a></li><li><a href="global.html#validateLineaInvestigacion">validateLineaInvestigacion</a></li><li><a href="global.html#validateLogin">validateLogin</a></li><li><a href="global.html">validateNuevaAreaConocimiento</a></li><li><a href="global.html">validateNuevoPosgrado</a></li><li><a href="global.html">validateNuevoPregrado</a></li><li><a href="global.html#validatePartialAdmins">validatePartialAdmins</a></li><li><a href="global.html#validatePartialAreaConocimiento">validatePartialAreaConocimiento</a></li><li><a href="global.html#validatePartialAula">validatePartialAula</a></li><li><a href="global.html#validatePartialCoordinador">validatePartialCoordinador</a></li><li><a href="global.html#validatePartialDestitucion">validatePartialDestitucion</a></li><li><a href="global.html#validatePartialDisponibilidadDocente">validatePartialDisponibilidadDocente</a></li><li><a href="global.html#validatePartialHorario">validatePartialHorario</a></li><li><a href="global.html#validatePartialLogin">validatePartialLogin</a></li><li><a href="global.html#validatePartialPnf">validatePartialPnf</a></li><li><a href="global.html#validatePartialPosgrado">validatePartialPosgrado</a></li><li><a href="global.html#validatePartialPregrado">validatePartialPregrado</a></li><li><a href="global.html#validatePartialProfesor">validatePartialProfesor</a></li><li><a href="global.html#validatePartialSeccion">validatePartialSeccion</a></li><li><a href="global.html#validatePartialSede">validatePartialSede</a></li><li><a href="global.html#validatePartialUnidadCurricular">validatePartialUnidadCurricular</a></li><li><a href="global.html#validatePartialUser">validatePartialUser</a></li><li><a href="global.html#validatePnf">validatePnf</a></li><li><a href="global.html#validatePosgrado">validatePosgrado</a></li><li><a href="global.html#validatePregrado">validatePregrado</a></li><li><a href="global.html#validateProfesor">validateProfesor</a></li><li><a href="global.html#validateQueryParams">validateQueryParams</a></li><li><a href="global.html#validateRecoveryPassword">validateRecoveryPassword</a></li><li><a href="global.html#validateReingreso">validateReingreso</a></li><li><a href="global.html#validateRequiredFields">validateRequiredFields</a></li><li><a href="global.html#validateSeccion">validateSeccion</a></li><li><a href="global.html#validateSede">validateSede</a></li><li><a href="global.html#validateUnidadCurricular">validateUnidadCurricular</a></li><li><a href="global.html#validateUser">validateUser</a></li><li><a href="global.html">validationError</a></li><li><a href="global.html#verificarConexion">verificarConexion</a></li><li><a href="global.html#verificarConexionInternet">verificarConexionInternet</a></li><li><a href="global.html#verificarDependencias">verificarDependencias</a></li><li><a href="global.html#verificarEmailConAPI">verificarEmailConAPI</a></li><li><a href="global.html">verificarSesion</a></li><li><a href="global.html#verificarUsers">verificarUsers</a></li><li><a href="global.html#verificarYValidarEmails">verificarYValidarEmails</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">models/curricular.model.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// ===========================================================
// Importaci贸n de dependencias y conexi贸n a la base de datos
// ===========================================================
import pg from "../database/pg.js";
import FormatterResponseModel from "../utils/FormatterResponseModel.js";

/**
 * @class CurricularModel
 * @description Modelo para gestionar las operaciones relacionadas con
 * Programas Nacionales de Formaci贸n (PNF), Unidades Curriculares,
 * Trayectos y Secciones en la base de datos.
 * Utiliza procedimientos almacenados y vistas para sus operaciones.
 */
export default class CurricularModel {
  // ===========================================================
  // MTODOS DE REGISTRO
  // ===========================================================

  /**
   * @static
   * @async
   * @method registrarPNF
   * @description Registra un nuevo Programa Nacional de Formaci贸n (PNF)
   * @param {Object} params - Par谩metros del registro
   * @param {Object} params.datos - Datos del PNF a registrar
   * @param {string} params.datos.nombre_pnf - Nombre del PNF
   * @param {string} params.datos.descripcion_pnf - Descripci贸n del PNF
   * @param {string} params.datos.codigo_pnf - C贸digo 煤nico del PNF
   * @param {string} params.datos.sede_pnf - Sede donde se imparte el PNF
   * @param {number} usuario_accion - Usuario que ejecuta la acci贸n
   * @returns {Promise&lt;Object>} Resultado del registro
   */
  static async registrarPNF(datos, usuario_accion) {
    try {
      console.log("Datos para registrar PNF:", datos);
      const {
        nombre_pnf,
        descripcion_pnf,
        codigo_pnf,
        duracion_trayectos_pnf,
        sede_pnf,
      } = datos;

      const query = `CALL public.registrar_pnf_completo($1, $2, $3, $4, $5, $6, NULL)`;
      const params = [
        usuario_accion,
        nombre_pnf,
        descripcion_pnf,
        codigo_pnf,
        sede_pnf,
        duracion_trayectos_pnf,
      ];

      const { rows } = await pg.query(query, params);

      return FormatterResponseModel.respuestaPostgres(
        rows,
        "PNF registrado exitosamente."
      );
    } catch (error) {
      error.details = { path: "CurricularModel.registrarPNF" };
      throw FormatterResponseModel.respuestaError(
        error,
        "Error al registrar el PNF"
      );
    }
  }
  /**
   * @static
   * @async
   * @method actualizarPNF
   * @description Actualizar un PNF existente usando el procedimiento almacenado
   * @param {number} idPNF - ID del PNF
   * @param {Object} datos - Datos actualizados
   * @param {number} usuarioId - ID del usuario que realiza la acci贸n
   * @returns {Object} Resultado de la operaci贸n
   */
  static async actualizarPNF(idPNF, datos, usuarioId) {
    try {
      const query = `
      CALL actualizar_pnf_completo_o_parcial(
        $1, $2, $3, $4, $5, $6, $7, $8, $9, $10
      )
    `;
      console.log(datos);

      const valores = [
        null, // p_resultado (OUT parameter)
        usuarioId,
        idPNF,
        datos.codigo_pnf || null,
        datos.nombre_pnf || null,
        datos.descripcion_pnf || null,
        datos.duracion_trayectos || null,
        datos.poblacion_estudiantil_pnf || null,
        datos.id_sede || null,
        datos.activo || null,
      ];

      const { rows } = await pg.query(query, valores);

      return FormatterResponseModel.respuestaPostgres(
        rows,
        "PNF actualizado exitosamente."
      );
    } catch (error) {
      error.details = { path: "CurricularModel.actualizarPNF" };
      throw FormatterResponseModel.respuestaError(
        error,
        "Error al actualizar el PNF"
      );
    }
  }

  /**
   * @static
   * @async
   * @method actualizarDescripcionTrayecto
   * @description Actualizar la descripci贸n de un trayecto usando el procedimiento almacenado
   * @param {number} idTrayecto - ID del trayecto
   * @param {string} descripcion - Nueva descripci贸n
   * @param {number} usuarioId - ID del usuario que realiza la acci贸n
   * @returns {Object} Resultado de la operaci贸n
   */
  static async actualizarDescripcionTrayecto(
    idTrayecto,
    descripcion,
    usuarioId
  ) {
    try {
      console.log(" [Model] Actualizando descripci贸n del trayecto:", {
        idTrayecto,
        usuarioId,
      });

      const query = `
        CALL actualizar_descripcion_trayecto($1, $2, $3, $4)
      `;

      const valores = [
        null, // p_resultado (OUT parameter)
        usuarioId,
        idTrayecto,
        descripcion,
      ];

      const { rows } = await pg.query(query, valores);

      return FormatterResponseModel.respuestaPostgres(
        rows,
        "Unidad Curricular registrada exitosamente."
      );
    } catch (error) {
      error.details = { path: "CurricularModel.registrarUnidadCurricular" };
      throw FormatterResponseModel.respuestaError(
        error,
        "Error al registrar la Unidad Curricular"
      );
    }
  }

  /**
   * @static
   * @async
   * @method registrarUnidadCurricular
   * @description Registra una nueva Unidad Curricular
   * @param {Object} params - Par谩metros del registro
   * @param {Object} params.datos - Datos de la Unidad Curricular
   * @param {number} idTrayecto - ID del trayecto al que pertenece
   * @param {string} params.datos.nombre_unidad_curricular - Nombre de la unidad curricular
   * @param {string} params.datos.descripcion_unidad_curricular - Descripci贸n de la unidad
   * @param {number} params.datos.carga_horas_academicas - Carga horaria total
   * @param {string} params.datos.codigo_unidad_curricular - C贸digo 煤nico de la unidad
   * @param {Array&lt;number>} params.datos.areas_conocimiento - Array de IDs de 谩reas de conocimiento
   * @param {number} usuario_accion - Usuario que realiza la acci贸n
   * @returns {Promise&lt;Object>} Resultado del registro
   */
  static async registrarUnidadCurricular(idTrayecto, datos, usuario_accion) {
    try {
      console.log("Datos para registrar Unidad Curricular:", datos);
      const {
        nombre_unidad_curricular,
        codigo_unidad_curricular,
        tipo_unidad,
        descripcion_unidad_curricular,
        carga_horas_academicas,
        creditos,
        semanas,
        areas_conocimiento = [],
        lineas_investigacion = [],
        sinoptico = null,
        id_linea_investigacion = null,
        hte = 0,
        hse = 0,
        hta = 0,
        hsa = 0,
        hti = 0,
        hsi = 0,
      } = datos;

      // Validar que areas_conocimiento sea un array
      if (!Array.isArray(areas_conocimiento)) {
        throw new Error("El par谩metro areas_conocimiento debe ser un array");
      }

      // Validar que lineas_investigacion sea un array
      if (!Array.isArray(lineas_investigacion)) {
        throw new Error("El par谩metro lineas_investigacion debe ser un array");
      }

      // Convertir areas_conocimiento a array de n煤meros
      const areasConocimientoArray = areas_conocimiento.map((area) =>
        Number(area.id_area_conocimiento || area)
      );

      // Convertir lineas_investigacion a array de n煤meros
      // Maneja tanto objetos como IDs directos
      const lineasInvestigacionArray = lineas_investigacion.map((linea) =>
        Number(linea.id_linea_investigacion || linea)
      );

      // Si el array est谩 vac铆o, lo convertimos a NULL para PostgreSQL
      const lineasInvestigacionParam =
        lineasInvestigacionArray.length > 0 ? lineasInvestigacionArray : null;

      // --- Consulta a la Funci贸n Almacenada ---
      const query = `CALL registrar_unidad_curricular_completo(
      $1,  -- p_usuario_accion
      $2,  -- p_id_trayecto
      $3,  -- p_nombre_unidad_curricular
      $4,  -- p_descripcion_unidad_curricular
      $5,  -- p_carga_horas
      $6,  -- p_codigo_unidad
      $7,  -- p_areas_conocimiento (integer[])
      $8,  -- p_lineas_investigacion (integer[]) - AHORA EN POSICIN CORRECTA
      $9,  -- p_sinoptico (text)
      $10, -- p_id_linea_investigacion (bigint)
      $11, -- p_creditos (smallint)
      $12, -- p_semanas (smallint)
      $13, -- p_tipo_unidad (character varying)
      $14, -- p_hte (numeric)
      $15, -- p_hse (numeric)
      $16, -- p_hta (numeric)
      $17, -- p_hsa (numeric)
      $18, -- p_hti (numeric)
      $19, -- p_hsi (numeric)
      $20  -- p_resultado (OUT parameter)
    )`;

      // --- Array de Par谩metros ---
      const params = [
        usuario_accion, // $1
        idTrayecto, // $2
        nombre_unidad_curricular, // $3
        descripcion_unidad_curricular, // $4
        carga_horas_academicas, // $5
        codigo_unidad_curricular, // $6
        areasConocimientoArray, // $7
        lineasInvestigacionParam, // $8 - AHORA EN POSICIN CORRECTA
        sinoptico, // $9
        id_linea_investigacion, // $10
        creditos, // $11
        semanas, // $12
        tipo_unidad, // $13
        hte, // $14
        hse, // $15
        hta, // $16
        hsa, // $17
        hti, // $18
        hsi, // $19
        null, // $20 - Para el par谩metro OUT
      ];

      console.log("Par谩metros para el procedimiento:", params);

      // Ejecutar el procedimiento
      const { rows } = await pg.query(query, params);

      return FormatterResponseModel.respuestaPostgres(
        rows,
        "Unidad Curricular registrada exitosamente."
      );
    } catch (error) {
      error.details = { path: "CurricularModel.registrarUnidadCurricular" };
      throw FormatterResponseModel.respuestaError(
        error,
        "Error al registrar la Unidad Curricular"
      );
    }
  }

  /**
   * @static
   * @async
   * @method registrarLineasInvestigacion
   * @description Registra una nueva L铆nea de Investigaci贸n
   * @param {Object} datos - Datos de la L铆nea de Investigaci贸n
   * @param {string} datos.nombre_linea_investigacion - Nombre de la l铆nea de investigaci贸n
   * @param {string} [datos.descripcion] - Descripci贸n de la l铆nea (opcional)
   * @param {boolean} [datos.activo=true] - Estado activo de la l铆nea (opcional, por defecto true)
   * @param {number} [id_trayecto] - ID del trayecto asociado (opcional)
   * @param {number} usuario_accion - Usuario que realiza la acci贸n
   * @returns {Promise&lt;Object>} Resultado del registro
   */
  static async registrarLineasInvestigacion(datos, usuario_accion) {
    try {
      const {
        nombre_linea_investigacion,
        descripcion = null,
        id_trayecto = null,
      } = datos;

      const query = `CALL public.registrar_linea_investigacion($1, $2, $3, $4, NULL)`;
      const params = [
        usuario_accion,
        nombre_linea_investigacion,
        descripcion,
        id_trayecto,
      ];

      console.log(
        "Par谩metros para el procedimiento de l铆nea de investigaci贸n:",
        params
      );

      const { rows } = await pg.query(query, params);

      return FormatterResponseModel.respuestaPostgres(
        rows,
        "L铆nea de investigaci贸n registrada exitosamente."
      );
    } catch (error) {
      error.details = { path: "CurricularModel.registrarLineasInvestigacion" };
      throw FormatterResponseModel.respuestaError(
        error,
        "Error al registrar la L铆nea de Investigaci贸n"
      );
    }
  }

  /**
   * @static
   * @async
   * @method mostrarLineasInvestigacion
   * @description Obtiene las l铆neas de investigaci贸n (con opci贸n de filtrar por trayecto)
   * @param {number} [id_trayecto] - ID del trayecto asociado (opcional)
   * @returns {Promise&lt;Object>} Resultado de la consulta
   */
  static async mostrarLineasInvestigacion(id_trayecto = null) {
    try {
      let query;
      let params = [];

      if (id_trayecto) {
        // Si se proporciona un trayecto, obtener l铆neas asociadas a ese trayecto a trav茅s del PNF
        query = `
        SELECT 
          li.id_linea_investigacion,
          li.nombre_linea_investigacion,
          li.descripcion,
          li.activo,
          li.id_pnf,
          li.created_at,
          li.updated_at,
          t.id_trayecto,
          p.nombre_pnf
        FROM lineas_investigacion li
        LEFT JOIN trayectos t ON li.id_pnf = t.id_pnf
        LEFT JOIN pnfs p ON li.id_pnf = p.id_pnf
        WHERE t.id_trayecto = $1
        ORDER BY li.nombre_linea_investigacion
      `;
        params = [id_trayecto];
      } else {
        // Si no se proporciona trayecto, obtener todas las l铆neas
        query = `
        SELECT 
          li.id_linea_investigacion,
          li.nombre_linea_investigacion,
          li.descripcion,
          li.activo,
          li.id_pnf,
          li.created_at,
          li.updated_at,
          p.nombre_pnf
        FROM lineas_investigacion li
        LEFT JOIN pnfs p ON li.id_pnf = p.id_pnf
        ORDER BY li.nombre_linea_investigacion
      `;
      }

      console.log(" Ejecutando consulta de l铆neas de investigaci贸n:", {
        query,
        params,
      });

      const { rows } = await pg.query(query, params);

      return FormatterResponseModel.respuestaPostgres(
        rows,
        id_trayecto
          ? "L铆neas de investigaci贸n obtenidas exitosamente para el trayecto especificado"
          : "Todas las l铆neas de investigaci贸n obtenidas exitosamente"
      );
    } catch (error) {
      error.details = { path: "CurricularModel.mostrarLineasInvestigacion" };
      throw FormatterResponseModel.respuestaError(
        error,
        "Error al obtener las l铆neas de investigaci贸n"
      );
    }
  }
  /**
   * @static
   * @async
   * @method actualizarUnidadCurricular
   * @description Actualizar una Unidad Curricular usando el procedimiento almacenado completo
   * @param {number} id_unidad_curricular - ID de la unidad curricular
   * @param {Object} datos - Datos de actualizaci贸n
   * @param {string} [datos.codigo_unidad_curricular] - Nuevo c贸digo de la unidad
   * @param {string} [datos.nombre_unidad_curricular] - Nuevo nombre de la unidad
   * @param {string} [datos.descripcion_unidad_curricular] - Nueva descripci贸n
   * @param {number} [datos.carga_horas_academicas] - Nuevas horas de clase
   * @param {number} [datos.id_trayecto] - Nuevo ID del trayecto
   * @param {boolean} [datos.activo] - Nuevo estado activo/inactivo
   * @param {Array&lt;number>} [datos.areas_conocimiento] - Array de IDs de 谩reas de conocimiento
   * @param {Array&lt;number>} [datos.lineas_investigacion] - Array de IDs de l铆neas de investigaci贸n
   * @param {string} [datos.tipo_unidad] - Tipo de unidad (Taller, Proyecto, Asignatura, Seminario, Curso)
   * @param {number} [datos.creditos] - N煤mero de cr茅ditos
   * @param {number} [datos.semanas] - Duraci贸n en semanas
   * @param {number} [datos.hte] - Horas Te贸ricas Presenciales
   * @param {number} [datos.hse] - Horas Semipresenciales
   * @param {number} [datos.hta] - Horas Trabajo Aut贸nomo
   * @param {number} [datos.hsa] - Horas Servicio/Seminario
   * @param {number} [datos.hti] - Horas Tutor铆a/Taller
   * @param {number} [datos.hsi] - Horas Seminario Investigaci贸n
   * @param {number} usuarioId - ID del usuario que realiza la acci贸n
   * @returns {Object} Resultado de la operaci贸n
   */
  static async actualizarUnidadCurricular(
    id_unidad_curricular,
    datos,
    usuarioId
  ) {
    try {
      console.log(" [Model] Actualizando unidad curricular:", {
        id_unidad_curricular,
        datos,
        usuarioId,
      });

      // Extraer todos los campos posibles con valores por defecto
      const {
        id_trayecto,
        codigo_unidad_curricular,
        nombre_unidad_curricular,
        descripcion_unidad_curricular,
        carga_horas_academicas,
        activo,
        areas_conocimiento,
        lineas_investigacion,
        tipo_unidad,
        creditos,
        semanas,
        sinoptico,
        hte,
        hse,
        hta,
        hsa,
        hti,
        hsi,
      } = datos;

      // Validar que areas_conocimiento sea un array
      if (areas_conocimiento &amp;&amp; !Array.isArray(areas_conocimiento)) {
        console.log(areas_conocimiento);
        throw new Error("El par谩metro areas_conocimiento debe ser un array");
      }

      // Validar que lineas_investigacion sea un array
      if (lineas_investigacion &amp;&amp; !Array.isArray(lineas_investigacion)) {
        console.log(lineas_investigacion);
        throw new Error("El par谩metro lineas_investigacion debe ser un array");
      }

      // Convertir areas_conocimiento a array de n煤meros
      const areasConocimientoArray =
        areas_conocimiento?.map((area) =>
          Number(area.id_area_conocimiento || area)
        ) || null;

      // Convertir lineas_investigacion a array de n煤meros
      const lineasInvestigacionArray =
        lineas_investigacion?.map((linea) =>
          Number(linea.id_linea_investigacion || linea)
        ) || null;

      // Query actualizada con todos los par谩metros
      const query = `
        CALL actualizar_unidad_curricular_completo(
          $1,   -- p_resultado (OUT)
          $2,   -- p_usuario_accion
          $3,   -- p_id_unidad_curricular
          $4,   -- p_id_trayecto
          $5,   -- p_codigo_unidad
          $6,   -- p_nombre_unidad_curricular
          $7,   -- p_descripcion_unidad_curricular
          $8,   -- p_horas_clase
          $9,   -- p_activo
          $10,  -- p_areas_conocimiento
          $11,  -- p_lineas_investigacion
          $12,  -- p_tipo_unidad
          $13,  -- p_creditos
          $14,  -- p_semanas
          $15,  -- p_sinoptico
          $16,  -- p_hte
          $17,  -- p_hse
          $18,  -- p_hta
          $19,  -- p_hsa
          $20,  -- p_hti
          $21   -- p_hsi
        )
      `;

      // Par谩metros completos en el orden correcto
      const valores = [
        null, // $1 - p_resultado (OUT parameter)
        usuarioId, // $2 - p_usuario_accion
        id_unidad_curricular, // $3 - p_id_unidad_curricular
        id_trayecto || null, // $4 - p_id_trayecto
        codigo_unidad_curricular || null, // $5 - p_codigo_unidad
        nombre_unidad_curricular || null, // $6 - p_nombre_unidad_curricular
        descripcion_unidad_curricular || null, // $7 - p_descripcion_unidad_curricular
        carga_horas_academicas !== undefined
          ? Number(carga_horas_academicas)
          : null, // $8 - p_horas_clase
        activo !== undefined ? Boolean(activo) : null, // $9 - p_activo
        areasConocimientoArray, // $10 - p_areas_conocimiento
        lineasInvestigacionArray, // $11 - p_lineas_investigacion
        tipo_unidad || null, // $12 - p_tipo_unidad
        creditos !== undefined ? Number(creditos) : null, // $13 - p_creditos
        semanas !== undefined ? Number(semanas) : null, // $14 - p_semanas
        sinoptico || null, // $15 - p_sinoptico
        hte !== undefined ? Number(hte) : null, // $16 - p_hte
        hse !== undefined ? Number(hse) : null, // $17 - p_hse
        hta !== undefined ? Number(hta) : null, // $18 - p_hta
        hsa !== undefined ? Number(hsa) : null, // $19 - p_hsa
        hti !== undefined ? Number(hti) : null, // $20 - p_hti
        hsi !== undefined ? Number(hsi) : null, // $21 - p_hsi
      ];

      console.log(" [Model] Par谩metros enviados al procedimiento:", {
        id_unidad_curricular,
        usuario_accion: usuarioId,
        id_trayecto: id_trayecto,
        codigo_unidad: codigo_unidad_curricular,
        nombre_unidad_curricular: nombre_unidad_curricular,
        horas_clase: carga_horas_academicas,
        tipo_unidad: tipo_unidad,
        creditos: creditos,
        semanas: semanas,
        total_areas: areasConocimientoArray?.length,
        total_lineas: lineasInvestigacionArray?.length,
        distribucion_horas: {
          hte: hte,
          hse: hse,
          hta: hta,
          hsa: hsa,
          hti: hti,
          hsi: hsi,
        },
      });

      const { rows } = await pg.query(query, valores);

      return FormatterResponseModel.respuestaPostgres(
        rows,
        "Unidad Curricular actualizada exitosamente."
      );
    } catch (error) {
      console.error(" Error en modelo actualizar unidad curricular:", error);
      error.details = {
        path: "CurricularModel.actualizarUnidadCurricular",
        id_unidad_curricular,
        usuarioId,
      };
      throw FormatterResponseModel.respuestaError(
        error,
        "Error al actualizar la Unidad Curricular"
      );
    }
  }

  // ===========================================================
  // MTODOS DE CONSULTA
  // ===========================================================

  /**
   * @static
   * @async
   * @method mostrarPNF
   * @description Obtiene todos los PNFs registrados con filtros opcionales
   * @param {Object} filters - Filtros opcionales
   * @param {number} filters.id_sede - Filtrar por sede
   * @param {boolean} filters.activo - Filtrar por estado activo/inactivo
   * @param {boolean} filters.tiene_coordinador - Filtrar por PNFs con coordinador
   * @param {string} filters.search - B煤squeda por nombre o c贸digo
   * @param {string} filters.searchID - B煤squeda por id_pnf
   * @returns {Promise&lt;Object>} Resultado de la consulta
   */
  static async mostrarPNF(filters = {}) {
    try {
      let whereConditions = [];
      let queryParams = [];
      let paramCount = 0;

      // Construir condiciones WHERE din谩micamente con par谩metros preparados
      if (filters.id_sede) {
        paramCount++;
        whereConditions.push(`id_sede = $${paramCount}`);
        queryParams.push(filters.id_sede);
      }

      if (filters.activo !== undefined) {
        paramCount++;
        whereConditions.push(`activo = $${paramCount}`);
        queryParams.push(filters.activo);
      }

      if (filters.tiene_coordinador !== undefined) {
        // Correcci贸n: usar alias para evitar conflicto de nombres
        if (filters.tiene_coordinador) {
          whereConditions.push(
            `EXISTS (SELECT 1 FROM coordinadores c WHERE c.id_pnf = vista_pnfs.id_pnf)`
          );
        } else {
          whereConditions.push(
            `NOT EXISTS (SELECT 1 FROM coordinadores c WHERE c.id_pnf = vista_pnfs.id_pnf)`
          );
        }
      }

      if (filters.search) {
        paramCount++;
        whereConditions.push(
          `(nombre_pnf ILIKE $${paramCount} OR codigo_pnf ILIKE $${paramCount})`
        );
        queryParams.push(`%${filters.search}%`);
      }

      if (filters.searchID) {
        paramCount++;
        whereConditions.push(`id_pnf = $${paramCount}`);
        queryParams.push(filters.searchID); // Sin % porque es b煤squeda exacta de ID
      }

      // Construir la consulta final
      const whereClause =
        whereConditions.length > 0
          ? `WHERE ${whereConditions.join(" AND ")}`
          : "";

      const query = `
      SELECT * FROM public.vista_pnfs
      ${whereClause}
      ORDER BY nombre_pnf ASC
    `;

      console.log(" Query ejecutada:", query);
      console.log(" Par谩metros:", queryParams);

      const { rows } = await pg.query(query, queryParams);

      return FormatterResponseModel.respuestaPostgres(
        rows,
        "Listado de PNFs obtenidos exitosamente."
      );
    } catch (error) {
      error.details = {
        path: "CurricularModel.mostrarPNF",
        filters: filters,
      };
      throw FormatterResponseModel.respuestaError(
        error,
        "Error al obtener los PNFs"
      );
    }
  }

  /**
   * @static
   * @async
   * @method mostrarTrayectos
   * @description Obtiene trayectos y su relaci贸n con el PNF
   * @param {string} [codigo_pnf] - C贸digo del PNF para filtrar (opcional)
   * @returns {Promise&lt;Object>} Resultado de la consulta
   */
  static async mostrarTrayectos(codigo_pnf) {
    try {
      let rows;
      if (codigo_pnf) {
        ({ rows } = await pg.query(
          `
          SELECT 
            t.id_trayecto, 
            t.poblacion_estudiantil, 
            t.valor_trayecto,
            t.descripcion_trayecto, 
            p.nombre_pnf,
            p.id_pnf,
            p.codigo_pnf
          FROM trayectos t
          JOIN pnfs p ON t.id_pnf = p.id_pnf
          WHERE p.codigo_pnf = $1 AND t.activo = true AND p.activo = true
          ORDER BY t.valor_trayecto ASC`,
          [codigo_pnf]
        ));
      } else {
        ({ rows } = await pg.query(`
          SELECT 
            t.id_trayecto, 
            t.poblacion_estudiantil, 
            t.valor_trayecto,
            t.descripcion_trayecto, 
            p.nombre_pnf,
            p.id_pnf,
            p.codigo_pnf
          FROM trayectos t
          JOIN pnfs p ON t.id_pnf = p.id_pnf
          WHERE t.activo = true AND p.activo = true
          ORDER BY p.nombre_pnf, t.valor_trayecto ASC
        `));
      }
      console.log(" [Model] Trayectos obtenidos:", rows);

      return FormatterResponseModel.respuestaPostgres(
        rows,
        "Trayectos obtenidos correctamente."
      );
    } catch (error) {
      error.details = { path: "CurricularModel.mostrarTrayectos" };
      throw FormatterResponseModel.respuestaError(
        error,
        "Error al obtener los trayectos"
      );
    }
  }

  /**
   * @static
   * @async
   * @method mostrarSeccionesByPnfAndValueTrayecto
   * @description Obtiene secciones por PNF y valor de trayecto
   * @param {string} codigo_pnf - C贸digo del PNF para filtrar
   * @param {string|number} valorTrayecto - Valor del trayecto para filtrar
   * @returns {Promise&lt;Object>} Resultado de la consulta
   */
  static async mostrarSeccionesByPnfAndValueTrayecto(
    codigo_pnf,
    valorTrayecto
  ) {
    try {
      console.log(" [Model] Obteniendo secciones...", {
        codigo_pnf,
        valorTrayecto,
      });

      const { rows } = await pg.query(
        `
      SELECT 
        s.id_seccion,
        s.valor_seccion,
        s.cupos_disponibles,
        t.nombre_turno,
        s.id_trayecto,
        tr.valor_trayecto as trayecto_valor,
        p.codigo_pnf,
        p.nombre_pnf
      FROM secciones s
      LEFT JOIN turnos t ON s.id_turno = t.id_turno
      INNER JOIN trayectos tr ON s.id_trayecto = tr.id_trayecto
      INNER JOIN pnfs p ON tr.id_pnf = p.id_pnf
      WHERE p.codigo_pnf = $1 AND tr.valor_trayecto = $2
      ORDER BY s.valor_seccion ASC;
      `,
        [codigo_pnf, valorTrayecto]
      );

      console.log(` [Model] ${rows.length} secciones obtenidas`);

      return FormatterResponseModel.respuestaPostgres(
        rows,
        "Secciones obtenidas correctamente."
      );
    } catch (error) {
      console.error(" Error en modelo mostrar secciones:", error);
      error.details = {
        path: "CurricularModel.mostrarSeccionesByPnfAndValueTrayecto",
        codigo_pnf,
        valorTrayecto,
      };
      throw FormatterResponseModel.respuestaError(
        error,
        "Error al obtener las secciones"
      );
    }
  }

  /**
   * @static
   * @async
   * @method mostrarSeccionesByPnfAndValueUnidadCurricular
   * @description Obtiene unidades curriculares por PNF y valor de trayecto
   * @param {string} codigo_pnf - C贸digo del PNF para filtrar
   * @param {string|number} valorTrayecto - Valor del trayecto para filtrar
   * @returns {Promise&lt;Object>} Resultado de la consulta
   */
  static async mostrarSeccionesByPnfAndValueUnidadCurricular(
    codigo_pnf,
    valorTrayecto
  ) {
    try {
      console.log(" [Model] Obteniendo unidades curriculares...", {
        codigo_pnf,
        valorTrayecto,
      });

      const { rows } = await pg.query(
        `
      SELECT 
        uc.nombre_unidad_curricular,
        uc.codigo_unidad,
        uc.horas_clase,
        uc.descripcion_unidad_curricular,
        tr.valor_trayecto as trayecto_valor,
        p.codigo_pnf,
        p.nombre_pnf
      FROM unidades_curriculares uc
      INNER JOIN trayectos tr ON uc.id_trayecto = tr.id_trayecto
      INNER JOIN pnfs p ON tr.id_pnf = p.id_pnf
      WHERE p.codigo_pnf = $1 AND tr.valor_trayecto = $2
      ORDER BY uc.id_unidad_curricular ASC;
      `,
        [codigo_pnf, valorTrayecto]
      );
      console.log(
        "Se filtro por el siguiente codigo PNF: " +
          codigo_pnf +
          " y su trayecto:" +
          valorTrayecto
      );
      console.log(rows);

      console.log(` [Model] ${rows.length} unidades curriculares obtenidas`);

      return FormatterResponseModel.respuestaPostgres(
        rows,
        "Secciones obtenidas correctamente."
      );
    } catch (error) {
      console.error(" Error en modelo mostrar unidades curriculares:", error);
      error.details = {
        path: "CurricularModel.mostrarSeccionesByPnfAndValueUnidadCurricular",
        codigo_pnf,
        valorTrayecto,
      };
      throw FormatterResponseModel.respuestaError(
        error,
        "Error al obtener las unidades curriculares"
      );
    }
  }

  /**
   * @static
   * @async
   * @method mostrarSecciones
   * @description Obtiene las secciones pertenecientes a un trayecto
   * @param {number} trayecto - ID del trayecto
   * @returns {Promise&lt;Object>} Resultado de la consulta
   */
  static async mostrarSecciones(trayecto) {
    try {
      const { rows } = await pg.query(
        `
        SELECT 
          s.id_seccion,
          s.valor_seccion,
          s.cupos_disponibles,
          t.nombre_turno,
          s.id_trayecto
        FROM secciones s
        LEFT JOIN turnos t ON s.id_turno = t.id_turno
        WHERE s.id_trayecto = $1
        ORDER BY s.valor_seccion ASC;
        `,
        [trayecto]
      );

      return FormatterResponseModel.respuestaPostgres(
        rows,
        "Secciones obtenidas correctamente."
      );
    } catch (error) {
      error.details = { path: "CurricularModel.mostrarSecciones" };
      throw FormatterResponseModel.respuestaError(
        error,
        "Error al obtener las secciones"
      );
    }
  }

  /**
   * @static
   * @async
   * @method mostrarUnidadesCurriculares
   * @description Obtiene las unidades curriculares asociadas a un trayecto
   * @param {number} trayecto - ID del trayecto
   * @returns {Promise&lt;Object>} Resultado de la consulta
   */
  static async mostrarUnidadesCurriculares(trayecto) {
    try {
      const { rows } = await pg.query(
        `
        SELECT * FROM public.vista_unidades_con_areas
        WHERE id_trayecto = $1
        ORDER BY nombre_unidad_curricular ASC;
        `,
        [trayecto]
      );

      return FormatterResponseModel.respuestaPostgres(
        rows,
        "Unidades curriculares obtenidas correctamente."
      );
    } catch (error) {
      error.details = { path: "CurricularModel.mostrarUnidadesCurriculares" };
      throw FormatterResponseModel.respuestaError(
        error,
        "Error al obtener las unidades curriculares"
      );
    }
  }

  /**
   * @static
   * @async
   * @method obtenerUnidadCurricularPorId
   * @description
   * @param {number} id
   * @returns {Promise&lt;Object>} Resultado de la consulta
   */
  static async obtenerUnidadCurricularPorId(id) {
    try {
      const { rows } = await pg.query(
        `
        SELECT * FROM public.vista_unidades_con_areas
        WHERE id_unidad_curricular = $1
        `,
        [id]
      );

      return FormatterResponseModel.respuestaPostgres(
        rows,
        "Unidades curriculares obtenidas correctamente."
      );
    } catch (error) {
      error.details = { path: "CurricularModel.mostrarUnidadesCurriculares" };
      throw FormatterResponseModel.respuestaError(
        error,
        "Error al obtener las unidades curriculares"
      );
    }
  }
  /**
   * @static
   * @async
   * @method eliminarUnidadCurricular
   * @description Elimina f铆sicamente una unidad curricular y todos sus registros relacionados
   * @param {number} id_usuario - ID del usuario que ejecuta la acci贸n
   * @param {number} id_unidad_curricular - ID de la unidad curricular a eliminar
   * @returns {Promise&lt;Object>} Resultado de la operaci贸n
   */
  static async eliminarUnidadCurricular(id_usuario, id_unidad_curricular) {
    try {
      const query = `
      CALL eliminar_unidad_curricular_fisicamente($1, $2, NULL);
    `;

      const { rows } = await pg.query(query, [
        id_usuario,
        id_unidad_curricular,
      ]);

      return FormatterResponseModel.respuestaPostgres(
        rows,
        "Unidad curricular eliminada correctamente."
      );
    } catch (error) {
      error.details = {
        path: "CurricularModel.eliminarUnidadCurricular",
        id_usuario: id_usuario,
        id_unidad_curricular: id_unidad_curricular,
      };
      throw FormatterResponseModel.respuestaError(
        error,
        "Error al eliminar la unidad curricular"
      );
    }
  }

  /**
   * @static
   * @async
   * @method eliminarPnf
   * @description Elimina f铆sicamente un PNF y todos sus registros relacionados
   * @param {number} id_usuario - ID del usuario que ejecuta la acci贸n
   * @param {number} id_pnf - ID del PNF a eliminar
   * @returns {Promise&lt;Object>} Resultado de la operaci贸n
   */
  static async eliminarPnf(id_usuario, id_pnf) {
    try {
      const query = `
      CALL eliminar_pnf($1, $2, NULL);
    `;

      const { rows } = await pg.query(query, [id_usuario, id_pnf]);

      return FormatterResponseModel.respuestaPostgres(
        rows,
        "PNF eliminado correctamente."
      );
    } catch (error) {
      error.details = {
        path: "CurricularModel.eliminarPnf",
        id_usuario: id_usuario,
        id_pnf: id_pnf,
      };
      throw FormatterResponseModel.respuestaError(
        error,
        "Error al eliminar el PNF"
      );
    }
  }

  /**
   * @static
   * @async
   * @method reactivarPnf
   * @description Reactiva un PNF y sus trayectos relacionados
   * @param {number} id_usuario - ID del usuario que ejecuta la acci贸n
   * @param {number} id_pnf - ID del PNF a reactivar
   * @returns {Promise&lt;Object>} Resultado de la operaci贸n
   */
  static async reactivarPnf(id_usuario, id_pnf) {
    try {
      const query = `
      CALL reactivar_pnf($1, $2, NULL);
    `;

      const { rows } = await pg.query(query, [id_usuario, id_pnf]);

      return FormatterResponseModel.respuestaPostgres(
        rows,
        "PNF reactivado correctamente."
      );
    } catch (error) {
      error.details = {
        path: "CurricularModel.reactivarPnf",
        id_usuario: id_usuario,
        id_pnf: id_pnf,
      };
      throw FormatterResponseModel.respuestaError(
        error,
        "Error al reactivar el PNF"
      );
    }
  }

  // ===========================================================
  // MTODOS DE ASIGNACIN Y GESTIN
  // ===========================================================

  /**
   * @static
   * @async
   * @method CrearSecciones
   * @description Crea autom谩ticamente las secciones de un trayecto seg煤n la poblaci贸n estudiantil
   * @param {number} idTrayecto - ID del trayecto
   * @param {Object} datos - Datos para la creaci贸n
   * @param {number} datos.poblacionEstudiantil - Cantidad de estudiantes
   * @param {Object} usuario_accion - Usuario que realiza la acci贸n
   * @returns {Promise&lt;Object>} Resultado de la creaci贸n
   */
  static async CrearSecciones(idTrayecto, datos) {
    try {
      const { poblacionEstudiantil } = datos;
      const query = `CALL public.distribuir_estudiantes_secciones($1, $2, NULL)`;
      const params = [idTrayecto, poblacionEstudiantil];

      const { rows } = await pg.query(query, params);

      return FormatterResponseModel.respuestaPostgres(
        rows,
        `Secciones creadas correctamente para el trayecto ${idTrayecto}.`
      );
    } catch (error) {
      error.details = { path: "CurricularModel.CrearSecciones" };
      throw FormatterResponseModel.respuestaError(
        error,
        "Error al crear las secciones"
      );
    }
  }

  /**
   * @static
   * @async
   * @method asignacionTurnoSeccion
   * @description Asigna un turno a una secci贸n espec铆fica
   * @param {number} idSeccion - ID de la secci贸n
   * @param {number} idTurno - ID del turno
   * @param {Object} usuario_accion - Usuario que ejecuta la acci贸n
   * @returns {Promise&lt;Object>} Resultado de la asignaci贸n
   */
  static async asignacionTurnoSeccion(idSeccion, idTurno, usuario_accion) {
    try {
      console.log(
        "idSeccion:",
        idSeccion,
        "idTurno:",
        idTurno,
        "usuario_accion:",
        usuario_accion.id
      );
      const query = `CALL public.asignar_turno_seccion($1, $2, $3, NULL)`;
      const params = [usuario_accion.id, idSeccion, idTurno];

      const { rows } = await pg.query(query, params);

      return FormatterResponseModel.respuestaPostgres(
        rows,
        "Turno asignado correctamente a la secci贸n."
      );
    } catch (error) {
      console.log(error);
      error.details = { path: "CurricularModel.asignacionTurnoSeccion" };
      throw FormatterResponseModel.respuestaError(
        error,
        "Error al asignar el turno a la secci贸n"
      );
    }
  }

  /**
   * @static
   * @async
   * @method mostrarTurnos
   * @description Obtiene todos los turnos disponibles
   * @returns {Promise&lt;Object>} Resultado de la consulta
   */
  static async mostrarTurnos() {
    try {
      const { rows } = await pg.query(`
        SELECT 
          id_turno,
          nombre_turno,
          descripcion_turno
        FROM turnos
        ORDER BY id_turno ASC;
      `);

      return FormatterResponseModel.respuestaPostgres(
        rows,
        "Turnos obtenidos correctamente."
      );
    } catch (error) {
      error.details = { path: "CurricularModel.mostrarTurnos" };
      throw FormatterResponseModel.respuestaError(
        error,
        "Error al obtener los turnos"
      );
    }
  }
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.4</a> on Thu Dec 04 2025 12:35:39 GMT-0400 (hora de Venezuela) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
