<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>services/horario.service.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AdminController.html">AdminController</a></li><li><a href="AdminModel.html">AdminModel</a></li><li><a href="AdminService.html">AdminService</a></li><li><a href="AulaController.html">AulaController</a></li><li><a href="AulaModel.html">AulaModel</a></li><li><a href="AulaService.html">AulaService</a></li><li><a href="CoordinadorController.html">CoordinadorController</a></li><li><a href="CoordinadorService.html">CoordinadorService</a></li><li><a href="CurricularController.html">CurricularController</a></li><li><a href="CurricularModel.html">CurricularModel</a></li><li><a href="CurricularService.html">CurricularService</a></li><li><a href="DocumentServices.html">DocumentServices</a><ul class='methods'><li data-type='method'><a href="DocumentServices.html#.crearCeldaEstilizada">crearCeldaEstilizada</a></li><li data-type='method'><a href="DocumentServices.html#.crearDocumentoHorario">crearDocumentoHorario</a></li><li data-type='method'><a href="DocumentServices.html#.crearFilaInformacion">crearFilaInformacion</a></li><li data-type='method'><a href="DocumentServices.html#.crearFilasTabla">crearFilasTabla</a></li><li data-type='method'><a href="DocumentServices.html#.crearParrafoEstilizado">crearParrafoEstilizado</a></li><li data-type='method'><a href="DocumentServices.html#.crearTextoEstilizado">crearTextoEstilizado</a></li><li data-type='method'><a href="DocumentServices.html#.generarDocumentoHorario">generarDocumentoHorario</a></li><li data-type='method'><a href="DocumentServices.html#.generarHorasDisponibles">generarHorasDisponibles</a></li><li data-type='method'><a href="DocumentServices.html#.procesarHorario">procesarHorario</a></li><li data-type='method'><a href="DocumentServices.html#.traerLogoMarcaAgua">traerLogoMarcaAgua</a></li></ul></li><li><a href="EmailService.html">EmailService</a></li><li><a href="FormatterResponseController.html">FormatterResponseController</a></li><li><a href="FormatterResponseModel.html">FormatterResponseModel</a></li><li><a href="FormatterResponseService.html">FormatterResponseService</a></li><li><a href="HorarioController.html">HorarioController</a></li><li><a href="HorarioService.html">HorarioService</a></li><li><a href="NotificationController.html">NotificationController</a></li><li><a href="ProfesorController.html">ProfesorController</a></li><li><a href="ProfesorModel.html">ProfesorModel</a></li><li><a href="ProfesorService.html">ProfesorService</a></li><li><a href="SedeController.html">SedeController</a></li><li><a href="SedeModel.html">SedeModel</a></li><li><a href="SedeService.html">SedeService</a></li><li><a href="SystemController.html">SystemController</a></li><li><a href="SystemModel.html">SystemModel</a></li><li><a href="UserController.html">UserController</a></li><li><a href="UserModel.html">UserModel</a></li><li><a href="UserService.html">UserService</a></li><li><a href="ValidationService.html">ValidationService</a></li><li><a href="module.exports_module.exports.html">exports</a></li></ul><h3>Modules</h3><ul><li><a href="module-CoordinadorModel.html">CoordinadorModel</a><ul class='methods'><li data-type='method'><a href="module-CoordinadorModel.html#.actualizarCoordinador">actualizarCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.asignarCoordinador">asignarCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.destituirCoordinador">destituirCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerCoordinador">obtenerCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerCoordinadorPorId">obtenerCoordinadorPorId</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerCoordinadorPorPnf">obtenerCoordinadorPorPnf</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerCoordinadoresActivos">obtenerCoordinadoresActivos</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerDatosCoordinadorCompletos">obtenerDatosCoordinadorCompletos</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerHistorialCoordinador">obtenerHistorialCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerHistorialDestituciones">obtenerHistorialDestituciones</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.obtenerTodos">obtenerTodos</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.reasignarCoordinador">reasignarCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.restituirCoordinador">restituirCoordinador</a></li><li data-type='method'><a href="module-CoordinadorModel.html#.validarCoordinadorActivo">validarCoordinadorActivo</a></li></ul></li><li><a href="module-CurricularRouter.html">CurricularRouter</a></li><li><a href="module-passwordUtils.html">passwordUtils</a><ul class='methods'><li data-type='method'><a href="module-passwordUtils.html#~comparePassword">comparePassword</a></li><li data-type='method'><a href="module-passwordUtils.html#~generarPassword">generarPassword</a></li><li data-type='method'><a href="module-passwordUtils.html#~hashPassword">hashPassword</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html">CrearSecciones</a></li><li><a href="global.html#DELETE/admins/:id">DELETE /admins/:id</a></li><li><a href="global.html#DELETE/aulas/:id">DELETE /aulas/:id</a></li><li><a href="global.html#DELETE/coordinadores/:id/destituir">DELETE /coordinadores/:id/destituir</a></li><li><a href="global.html#DELETE/horarios/:id">DELETE /horarios/:id</a></li><li><a href="global.html#DELETE/profesores/:id">DELETE /profesores/:id</a></li><li><a href="global.html#DELETE/profesores/:id_profesor/disponibilidad/:id_disponibilidad">DELETE /profesores/:id_profesor/disponibilidad/:id_disponibilidad</a></li><li><a href="global.html#DELETE/sedes/:id">DELETE /sedes/:id</a></li><li><a href="global.html#DELETE/system/backups/:backupFileName">DELETE /system/backups/:backupFileName</a></li><li><a href="global.html#DELETE/system/backups/cleanup">DELETE /system/backups/cleanup</a></li><li><a href="global.html#DELETE/user/:id_usuario/desactivar">DELETE /user/:id_usuario/desactivar</a></li><li><a href="global.html#EMAIL_CONFIG">EMAIL_CONFIG</a></li><li><a href="global.html#EnviarTokenEmail">EnviarTokenEmail</a></li><li><a href="global.html#GET/admin/logs">GET /admin/logs</a></li><li><a href="global.html#GET/admin/profile">GET /admin/profile</a></li><li><a href="global.html#GET/admin/reports">GET /admin/reports</a></li><li><a href="global.html#GET/admin/stats">GET /admin/stats</a></li><li><a href="global.html#GET/admins">GET /admins</a></li><li><a href="global.html#GET/admins/search">GET /admins/search</a></li><li><a href="global.html#GET/api/aulas">GET /api/aulas</a></li><li><a href="global.html#GET/api/profesores">GET /api/profesores</a></li><li><a href="global.html#GET/api/system/backups">GET /api/system/backups</a></li><li><a href="global.html#GET/api/system/estadisticas">GET /api/system/estadisticas</a></li><li><a href="global.html#GET/api/system/metricas">GET /api/system/metricas</a></li><li><a href="global.html#GET/api/system/status">GET /api/system/status</a></li><li><a href="global.html#GET/auditory/system">GET /auditory/system</a></li><li><a href="global.html#GET/aulas">GET /aulas</a></li><li><a href="global.html#GET/aulas/:id">GET /aulas/:id</a></li><li><a href="global.html#GET/aulas/pnf/:codigoPNF">GET /aulas/pnf/:codigoPNF</a></li><li><a href="global.html#GET/aulas/sede/:sede">GET /aulas/sede/:sede</a></li><li><a href="global.html#GET/aulas/tipo/:tipo">GET /aulas/tipo/:tipo</a></li><li><a href="global.html#GET/auth/verify">GET /auth/verify</a></li><li><a href="global.html#GET/catalogos/areas-conocimiento">GET /catalogos/areas-conocimiento</a></li><li><a href="global.html#GET/catalogos/posgrados">GET /catalogos/posgrados</a></li><li><a href="global.html#GET/catalogos/pregrados">GET /catalogos/pregrados</a></li><li><a href="global.html#GET/coordinadores">GET /coordinadores</a></li><li><a href="global.html#GET/coordinadores/:id">GET /coordinadores/:id</a></li><li><a href="global.html#GET/coordinadores/:id/historial-destituciones">GET /coordinadores/:id/historial-destituciones</a></li><li><a href="global.html#GET/coordinadores/destituidos">GET /coordinadores/destituidos</a></li><li><a href="global.html#GET/exportar/seccion/:id_seccion">GET /exportar/seccion/:id_seccion</a></li><li><a href="global.html#GET/horarios/aula/:id_aula">GET /horarios/aula/:id_aula</a></li><li><a href="global.html#GET/horarios/profesor/:id_profesor">GET /horarios/profesor/:id_profesor</a></li><li><a href="global.html#GET/horarios/seccion/:id_seccion">GET /horarios/seccion/:id_seccion</a></li><li><a href="global.html#GET/notifications">GET /notifications</a></li><li><a href="global.html#GET/profesores">GET /profesores</a></li><li><a href="global.html#GET/profesores/:id">GET /profesores/:id</a></li><li><a href="global.html#GET/profesores/:id/imagen">GET /profesores/:id/imagen</a></li><li><a href="global.html#GET/profesores/search">GET /profesores/search</a></li><li><a href="global.html#GET/profile">GET /profile</a></li><li><a href="global.html#GET/sedes">GET /sedes</a></li><li><a href="global.html#GET/sedes/:id">GET /sedes/:id</a></li><li><a href="global.html#GET/system/backups">GET /system/backups</a></li><li><a href="global.html#GET/system/backups/download/:backupFileName">GET /system/backups/download/:backupFileName</a></li><li><a href="global.html#GET/system/estado">GET /system/estado</a></li><li><a href="global.html#GET/system/info">GET /system/info</a></li><li><a href="global.html#GET/system/logs">GET /system/logs</a></li><li><a href="global.html#GET/system/mapa-calor/horarios">GET /system/mapa-calor/horarios</a></li><li><a href="global.html#GET/system/metricas/academicas">GET /system/metricas/academicas</a></li><li><a href="global.html#GET/system/metricas/sistema">GET /system/metricas/sistema</a></li><li><a href="global.html#GET/system/reportes/estadisticas">GET /system/reportes/estadisticas</a></li><li><a href="global.html">GuardarTokenEmail</a></li><li><a href="global.html#PATCH/admins/:id/rol">PATCH /admins/:id/rol</a></li><li><a href="global.html#POST/admins">POST /admins</a></li><li><a href="global.html#POST/aulas">POST /aulas</a></li><li><a href="global.html#POST/aulas/to/horarios">POST /aulas/to/horarios</a></li><li><a href="global.html#POST/auth/login">POST /auth/login</a></li><li><a href="global.html#POST/catalogos/areas-conocimiento">POST /catalogos/areas-conocimiento</a></li><li><a href="global.html#POST/catalogos/posgrados">POST /catalogos/posgrados</a></li><li><a href="global.html#POST/catalogos/pregrados">POST /catalogos/pregrados</a></li><li><a href="global.html#POST/coordinadores">POST /coordinadores</a></li><li><a href="global.html#POST/coordinadores/:id/restitur">POST /coordinadores/:id/restitur</a></li><li><a href="global.html#POST/horarios">POST /horarios</a></li><li><a href="global.html#POST/profesores">POST /profesores</a></li><li><a href="global.html#POST/profesores/:id/disponibilidad">POST /profesores/:id/disponibilidad</a></li><li><a href="global.html#POST/profesores/:id/reingresar">POST /profesores/:id/reingresar</a></li><li><a href="global.html#POST/profesores/to/seccion/:id_seccion">POST /profesores/to/seccion/:id_seccion</a></li><li><a href="global.html#POST/sedes">POST /sedes</a></li><li><a href="global.html#POST/system/backup">POST /system/backup</a></li><li><a href="global.html#POST/system/backup/manual">POST /system/backup/manual</a></li><li><a href="global.html#POST/system/restore">POST /system/restore</a></li><li><a href="global.html#PUT/admin/profile">PUT /admin/profile</a></li><li><a href="global.html#PUT/admins/:id">PUT /admins/:id</a></li><li><a href="global.html#PUT/aulas/:id">PUT /aulas/:id</a></li><li><a href="global.html#PUT/auth/password">PUT /auth/password</a></li><li><a href="global.html#PUT/coordinadores/:cedula/reasignar-pnf">PUT /coordinadores/:cedula/reasignar-pnf</a></li><li><a href="global.html#PUT/coordinadores/:id">PUT /coordinadores/:id</a></li><li><a href="global.html#PUT/horarios/:id">PUT /horarios/:id</a></li><li><a href="global.html#PUT/profesores/:id">PUT /profesores/:id</a></li><li><a href="global.html#PUT/profesores/:id_profesor/disponibilidad">PUT /profesores/:id_profesor/disponibilidad</a></li><li><a href="global.html#PUT/sedes/:id">PUT /sedes/:id</a></li><li><a href="global.html#PUT/user/:id_usuario/activar">PUT /user/:id_usuario/activar</a></li><li><a href="global.html">VerificarToken</a></li><li><a href="global.html">activar</a></li><li><a href="global.html">activarUsuario</a></li><li><a href="global.html">actualizar</a></li><li><a href="global.html">actualizarAdmin</a></li><li><a href="global.html">actualizarAula</a></li><li><a href="global.html">actualizarContrase√±aYLimpiarToken</a></li><li><a href="global.html">actualizarCoordinador</a></li><li><a href="global.html">actualizarDescripcionTrayecto</a></li><li><a href="global.html">actualizarDisponibilidad</a></li><li><a href="global.html#actualizarHorario">actualizarHorario</a></li><li><a href="global.html">actualizarPNF</a></li><li><a href="global.html">actualizarPerfil</a></li><li><a href="global.html#actualizarProfesor">actualizarProfesor</a></li><li><a href="global.html">actualizarSede</a></li><li><a href="global.html">actualizarUltimoAcceso</a></li><li><a href="global.html">actualizarUnidadCurricular</a></li><li><a href="global.html#agregarRolDestinatario">agregarRolDestinatario</a></li><li><a href="global.html#agregarUsuarioDestinatario">agregarUsuarioDestinatario</a></li><li><a href="global.html#asegurarStringEnMinusculas">asegurarStringEnMinusculas</a></li><li><a href="global.html">asignacionTurnoSeccion</a></li><li><a href="global.html">asignarCoordinador</a></li><li><a href="global.html">asignarTurnoSeccion</a></li><li><a href="global.html">buscar</a></li><li><a href="global.html">buscarAdmin</a></li><li><a href="global.html">buscarPorEmail</a></li><li><a href="global.html">buscarPorId</a></li><li><a href="global.html#buscarProfesor">buscarProfesor</a></li><li><a href="global.html">cambiarContrase√±a</a></li><li><a href="global.html">cambiarRol</a></li><li><a href="global.html">cambiarRolAdmin</a></li><li><a href="global.html">cerrarSesion</a></li><li><a href="global.html#closeSession">closeSession</a></li><li><a href="global.html">conflict</a></li><li><a href="global.html#connectDB">connectDB</a></li><li><a href="global.html">contarPorRolYEstado</a></li><li><a href="global.html#corsOptions">corsOptions</a></li><li><a href="global.html">crear</a></li><li><a href="global.html">crearAreaConocimiento</a></li><li><a href="global.html">crearDisponibilidad</a></li><li><a href="global.html#crearNotificacionCompleta">crearNotificacionCompleta</a></li><li><a href="global.html#crearNotificacionIndividual">crearNotificacionIndividual</a></li><li><a href="global.html#crearNotificacionMasiva">crearNotificacionMasiva</a></li><li><a href="global.html">crearPosgrado</a></li><li><a href="global.html">crearPregrado</a></li><li><a href="global.html">crearRespaldo</a></li><li><a href="global.html">crearSecciones</a></li><li><a href="global.html#crearSede">crearSede</a></li><li><a href="global.html#createValidationResponse">createValidationResponse</a></li><li><a href="global.html">created</a></li><li><a href="global.html">desactivar</a></li><li><a href="global.html">desactivarAdmin</a></li><li><a href="global.html">desactivarUsuario</a></li><li><a href="global.html#descargarRespaldo">descargarRespaldo</a></li><li><a href="global.html#destituirProfesor">destituirProfesor</a></li><li><a href="global.html#disconnectDB">disconnectDB</a></li><li><a href="global.html">eliminar</a></li><li><a href="global.html">eliminarAula</a></li><li><a href="global.html">eliminarCoordinador</a></li><li><a href="global.html">eliminarDisponibilidad</a></li><li><a href="global.html#eliminarHorario">eliminarHorario</a></li><li><a href="global.html">eliminarPnf</a></li><li><a href="global.html">eliminarRespaldo</a></li><li><a href="global.html">eliminarSede</a></li><li><a href="global.html">eliminarUnidadCurricular</a></li><li><a href="global.html#enviarEmail">enviarEmail</a></li><li><a href="global.html#enviarEmailMultiple">enviarEmailMultiple</a></li><li><a href="global.html">error</a></li><li><a href="global.html#exportarHorarioWord">exportarHorarioWord</a></li><li><a href="global.html">extractData</a></li><li><a href="global.html">extractError</a></li><li><a href="global.html">filtrarPorEstado</a></li><li><a href="global.html">filtrarPorRol</a></li><li><a href="global.html">filtrarPorSede</a></li><li><a href="global.html">filtrarPorTipo</a></li><li><a href="global.html">forbidden</a></li><li><a href="global.html">formatValidationErrors</a></li><li><a href="global.html">fromDatabaseResponse</a></li><li><a href="global.html#generarDocumentoHorario">generarDocumentoHorario</a></li><li><a href="global.html#generateEmailTemplate">generateEmailTemplate</a></li><li><a href="global.html#get/auth/logout">get /auth/logout</a></li><li><a href="global.html#getCookie">getCookie</a></li><li><a href="global.html">getDefaultTitle</a></li><li><a href="global.html">getErrorCode</a></li><li><a href="global.html#getFilterCondition">getFilterCondition</a></li><li><a href="global.html#getImageProfesorDirect">getImageProfesorDirect</a></li><li><a href="global.html">getMinimalFallback</a></li><li><a href="global.html">getProfile</a></li><li><a href="global.html">getTranslation</a></li><li><a href="global.html">isError</a></li><li><a href="global.html">isSuccess</a></li><li><a href="global.html#joinRoleRooms">joinRoleRooms</a></li><li><a href="global.html#jsonSyntaxErrorHandler">jsonSyntaxErrorHandler</a></li><li><a href="global.html">limpiarRespaldosAntiguos</a></li><li><a href="global.html">listarCoordinadores</a></li><li><a href="global.html">listarCoordinadoresDestituidos</a></li><li><a href="global.html">listarRespaldos</a></li><li><a href="global.html#listenNotifications">listenNotifications</a></li><li><a href="global.html#loadEnv">loadEnv</a></li><li><a href="global.html">login</a></li><li><a href="global.html">loginUser</a></li><li><a href="global.html">manejarServicio</a></li><li><a href="global.html">marcarComoLeida</a></li><li><a href="global.html#markAsRead">markAsRead</a></li><li><a href="global.html#middlewareAuth">middlewareAuth</a></li><li><a href="global.html">mostrarAdmin</a></li><li><a href="global.html#mostrarAreasConocimiento">mostrarAreasConocimiento</a></li><li><a href="global.html#mostrarAulaCambiarHorario">mostrarAulaCambiarHorario</a></li><li><a href="global.html">mostrarAulas</a></li><li><a href="global.html#mostrarAulasParaHorario">mostrarAulasParaHorario</a></li><li><a href="global.html">mostrarDisponibilidad</a></li><li><a href="global.html#mostrarHorariosPorAula">mostrarHorariosPorAula</a></li><li><a href="global.html#mostrarHorariosPorSeccion">mostrarHorariosPorSeccion</a></li><li><a href="global.html#mostrarHorariosProfesores">mostrarHorariosProfesores</a></li><li><a href="global.html">mostrarLineasInvestigacion</a></li><li><a href="global.html">mostrarNotificacion</a></li><li><a href="global.html">mostrarPNF</a></li><li><a href="global.html#mostrarPosGrados">mostrarPosGrados</a></li><li><a href="global.html#mostrarPreGrados">mostrarPreGrados</a></li><li><a href="global.html#mostrarProfesor">mostrarProfesor</a></li><li><a href="global.html#mostrarProfesorAPI">mostrarProfesorAPI</a></li><li><a href="global.html#mostrarProfesorCambiarHorario">mostrarProfesorCambiarHorario</a></li><li><a href="global.html">mostrarProfesoresEliminados</a></li><li><a href="global.html#mostrarProfesoresParaHorario">mostrarProfesoresParaHorario</a></li><li><a href="global.html">mostrarSecciones</a></li><li><a href="global.html">mostrarSeccionesByPnfAndValueTrayecto</a></li><li><a href="global.html">mostrarSeccionesByPnfAndValueUnidadCurricular</a></li><li><a href="global.html">mostrarSedes</a></li><li><a href="global.html">mostrarTrayectos</a></li><li><a href="global.html">mostrarTurnos</a></li><li><a href="global.html">mostrarUnidadesCurriculares</a></li><li><a href="global.html">notFound</a></li><li><a href="global.html">obtenerAdminPorId</a></li><li><a href="global.html">obtenerAdminsPorEstado</a></li><li><a href="global.html">obtenerAdminsPorRol</a></li><li><a href="global.html">obtenerAreasConocimiento</a></li><li><a href="global.html#obtenerAuditoria">obtenerAuditoria</a></li><li><a href="global.html">obtenerAuditoriaCompleta</a></li><li><a href="global.html">obtenerAulaPorId</a></li><li><a href="global.html">obtenerAulasDisponibles</a></li><li><a href="global.html">obtenerAulasPorPnf</a></li><li><a href="global.html">obtenerAulasPorSede</a></li><li><a href="global.html">obtenerAulasPorTipo</a></li><li><a href="global.html">obtenerConFiltros</a></li><li><a href="global.html">obtenerCoordinador</a></li><li><a href="global.html">obtenerEstadoSistema</a></li><li><a href="global.html">obtenerHistorialDestituciones</a></li><li><a href="global.html#obtenerHorariosPorAula">obtenerHorariosPorAula</a></li><li><a href="global.html#obtenerHorariosPorProfesor">obtenerHorariosPorProfesor</a></li><li><a href="global.html#obtenerHorariosPorSeccion">obtenerHorariosPorSeccion</a></li><li><a href="global.html#obtenerIdUSerProfesor">obtenerIdUSerProfesor</a></li><li><a href="global.html">obtenerImagen</a></li><li><a href="global.html#obtenerInformacionSistema">obtenerInformacionSistema</a></li><li><a href="global.html#obtenerLogsSistema">obtenerLogsSistema</a></li><li><a href="global.html">obtenerMapaCalorHorarios</a></li><li><a href="global.html#obtenerMapaCalorOcupacion">obtenerMapaCalorOcupacion</a></li><li><a href="global.html">obtenerMetricasAcademicas</a></li><li><a href="global.html">obtenerMetricasSistema</a></li><li><a href="global.html">obtenerPerfil</a></li><li><a href="global.html#obtenerPorAula">obtenerPorAula</a></li><li><a href="global.html#obtenerPorId">obtenerPorId</a></li><li><a href="global.html#obtenerPorProfesor">obtenerPorProfesor</a></li><li><a href="global.html#obtenerPorSeccion">obtenerPorSeccion</a></li><li><a href="global.html">obtenerPosgrados</a></li><li><a href="global.html">obtenerPregrados</a></li><li><a href="global.html#obtenerProfesoresDisponibles">obtenerProfesoresDisponibles</a></li><li><a href="global.html">obtenerReportesEstadisticas</a></li><li><a href="global.html">obtenerRolesDisponibles</a></li><li><a href="global.html">obtenerSedePorId</a></li><li><a href="global.html">obtenerTodas</a></li><li><a href="global.html">obtenerTodos</a></li><li><a href="global.html">obtenerUnidadCurricularPorId</a></li><li><a href="global.html">obtenerUsuarioPorEmail</a></li><li><a href="global.html">obtenerUsuarioPorEmailConToken</a></li><li><a href="global.html">obtenerUsuarioPorId</a></li><li><a href="global.html">paginated</a></li><li><a href="global.html#parseJSONField">parseJSONField</a></li><li><a href="global.html#post/auth/logout">post /auth/logout</a></li><li><a href="global.html">quitarRol</a></li><li><a href="global.html">reactivarPnf</a></li><li><a href="global.html">reasignarCoordinador</a></li><li><a href="global.html#registerAreaConocimiento">registerAreaConocimiento</a></li><li><a href="global.html#registerAula">registerAula</a></li><li><a href="global.html#registerPosGrado">registerPosGrado</a></li><li><a href="global.html#registerPreGrado">registerPreGrado</a></li><li><a href="global.html#registerSede">registerSede</a></li><li><a href="global.html">registrarAdmin</a></li><li><a href="global.html">registrarAula</a></li><li><a href="global.html#registrarHorario">registrarHorario</a></li><li><a href="global.html">registrarLineaInvestigacion</a></li><li><a href="global.html">registrarLineasInvestigacion</a></li><li><a href="global.html">registrarPNF</a></li><li><a href="global.html#registrarProfesor">registrarProfesor</a></li><li><a href="global.html">registrarSede</a></li><li><a href="global.html">registrarUnidadCurricular</a></li><li><a href="global.html#regitrarPNF">regitrarPNF</a></li><li><a href="global.html#regitrarUnidadCurricular">regitrarUnidadCurricular</a></li><li><a href="global.html">reingresar</a></li><li><a href="global.html">reingresoProfesor</a></li><li><a href="global.html#reportesEstadisticas">reportesEstadisticas</a></li><li><a href="global.html">respuestaDatos</a></li><li><a href="global.html">respuestaError</a></li><li><a href="global.html">respuestaExito</a></li><li><a href="global.html">respuestaPaginada</a></li><li><a href="global.html">respuestaPostgres</a></li><li><a href="global.html">respuestaServicio</a></li><li><a href="global.html">respuestaSuccess</a></li><li><a href="global.html">respuestaValidacionError</a></li><li><a href="global.html">restaurarRespaldo</a></li><li><a href="global.html">restituirCoordinador</a></li><li><a href="global.html#searchNotificationDestinatario">searchNotificationDestinatario</a></li><li><a href="global.html#searchNotificationGlobales">searchNotificationGlobales</a></li><li><a href="global.html#searchNotificationRoles">searchNotificationRoles</a></li><li><a href="global.html#searchNotificationUser">searchNotificationUser</a></li><li><a href="global.html#searchNotifications">searchNotifications</a></li><li><a href="global.html#securityMiddleware">securityMiddleware</a></li><li><a href="global.html#sendToGlobals">sendToGlobals</a></li><li><a href="global.html#sendToRoles">sendToRoles</a></li><li><a href="global.html#sendToUser">sendToUser</a></li><li><a href="global.html#socketAuth">socketAuth</a></li><li><a href="global.html#storage">storage</a></li><li><a href="global.html">success</a></li><li><a href="global.html">unauthorized</a></li><li><a href="global.html">updateProfile</a></li><li><a href="global.html">validacionesComunes</a></li><li><a href="global.html#validarFormatoEmail">validarFormatoEmail</a></li><li><a href="global.html#validateAdmins">validateAdmins</a></li><li><a href="global.html#validateAreaConocimiento">validateAreaConocimiento</a></li><li><a href="global.html#validateAsignacionCoordinador">validateAsignacionCoordinador</a></li><li><a href="global.html#validateAula">validateAula</a></li><li><a href="global.html#validateContrasenia">validateContrasenia</a></li><li><a href="global.html#validateCoordinador">validateCoordinador</a></li><li><a href="global.html">validateCreacionSecciones</a></li><li><a href="global.html#validateDestitucion">validateDestitucion</a></li><li><a href="global.html#validateDisponibilidadDocente">validateDisponibilidadDocente</a></li><li><a href="global.html#validateHorario">validateHorario</a></li><li><a href="global.html#validateId">validateId</a></li><li><a href="global.html#validateLineaInvestigacion">validateLineaInvestigacion</a></li><li><a href="global.html#validateLogin">validateLogin</a></li><li><a href="global.html">validateNuevaAreaConocimiento</a></li><li><a href="global.html">validateNuevoPosgrado</a></li><li><a href="global.html">validateNuevoPregrado</a></li><li><a href="global.html#validatePartialAdmins">validatePartialAdmins</a></li><li><a href="global.html#validatePartialAreaConocimiento">validatePartialAreaConocimiento</a></li><li><a href="global.html#validatePartialAula">validatePartialAula</a></li><li><a href="global.html#validatePartialCoordinador">validatePartialCoordinador</a></li><li><a href="global.html#validatePartialDestitucion">validatePartialDestitucion</a></li><li><a href="global.html#validatePartialDisponibilidadDocente">validatePartialDisponibilidadDocente</a></li><li><a href="global.html#validatePartialHorario">validatePartialHorario</a></li><li><a href="global.html#validatePartialLogin">validatePartialLogin</a></li><li><a href="global.html#validatePartialPnf">validatePartialPnf</a></li><li><a href="global.html#validatePartialPosgrado">validatePartialPosgrado</a></li><li><a href="global.html#validatePartialPregrado">validatePartialPregrado</a></li><li><a href="global.html#validatePartialProfesor">validatePartialProfesor</a></li><li><a href="global.html#validatePartialSeccion">validatePartialSeccion</a></li><li><a href="global.html#validatePartialSede">validatePartialSede</a></li><li><a href="global.html#validatePartialUnidadCurricular">validatePartialUnidadCurricular</a></li><li><a href="global.html#validatePartialUser">validatePartialUser</a></li><li><a href="global.html#validatePnf">validatePnf</a></li><li><a href="global.html#validatePosgrado">validatePosgrado</a></li><li><a href="global.html#validatePregrado">validatePregrado</a></li><li><a href="global.html#validateProfesor">validateProfesor</a></li><li><a href="global.html#validateQueryParams">validateQueryParams</a></li><li><a href="global.html#validateRecoveryPassword">validateRecoveryPassword</a></li><li><a href="global.html#validateReingreso">validateReingreso</a></li><li><a href="global.html#validateRequiredFields">validateRequiredFields</a></li><li><a href="global.html#validateSeccion">validateSeccion</a></li><li><a href="global.html#validateSede">validateSede</a></li><li><a href="global.html#validateUnidadCurricular">validateUnidadCurricular</a></li><li><a href="global.html#validateUser">validateUser</a></li><li><a href="global.html">validationError</a></li><li><a href="global.html#verificarConexion">verificarConexion</a></li><li><a href="global.html#verificarConexionInternet">verificarConexionInternet</a></li><li><a href="global.html#verificarDependencias">verificarDependencias</a></li><li><a href="global.html#verificarEmailConAPI">verificarEmailConAPI</a></li><li><a href="global.html">verificarSesion</a></li><li><a href="global.html#verificarUsers">verificarUsers</a></li><li><a href="global.html#verificarYValidarEmails">verificarYValidarEmails</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">services/horario.service.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import HorarioModel from "../models/horario.model.js";
import validationService from "./validation.service.js";
import FormatterResponseService from "../utils/FormatterResponseService.js";
import DocumentServices from "./document.service.js";
import NotificationService from "./notification.service.js";

/**
 * @class HorarioService
 * @description Contiene la l√≥gica de negocio relacionada con los horarios acad√©micos
 */
export default class HorarioService {
  /**
   * Mostrar los horarios de un profesor en espec√≠fico
   * @param {number} id_profesor
   * @returns {Object} Respuesta formateada con los horarios del profesor
   */
  static async mostrarHorariosProfesores(id_profesor) {
    try {
      const validation = validationService.validateId(id_profesor, "profesor");
      if (!validation.isValid) {
        return FormatterResponseService.validationError(
          validation.errors,
          "ID de profesor inv√°lido"
        );
      }

      const dbResponse = await HorarioModel.obtenerPorProfesor(id_profesor);

      // Si el modelo retorna una respuesta formateada, la adaptamos
      if (dbResponse &amp;&amp; dbResponse.state === "error") {
        return FormatterResponseService.fromDatabaseResponse(dbResponse);
      }

      const rows = dbResponse.data || dbResponse;

      // Validar que hay datos
      if (!rows || rows.length === 0) {
        return FormatterResponseService.notFound(
          "No hay Horarios del profesor",
          id_profesor
        );
      }

      // Usar los nombres correctos de las columnas seg√∫n tu consulta SQL
      const { nombres_profesor, apellidos_profesor } = rows[0];

      // ‚úÖ CORREGIDO: Filtrar solo filas que tengan datos reales de horarios
      const filasConHorarios = rows.filter(
        (row) => row.nombre_unidad_curricular &amp;&amp; row.hora_inicio &amp;&amp; row.hora_fin
      );

      let horario = [];

      // ‚úÖ CORREGIDO: Solo procesar si hay horarios reales
      if (filasConHorarios.length > 0) {
        const diasUnicos = [
          ...new Set(filasConHorarios.map((d) => d.dia_semana)),
        ];

        // ‚úÖ CORREGIDO: Sintaxis del map corregida
        horario = diasUnicos.map((dia) => ({
          nombre: dia,
          clases: filasConHorarios
            .filter((clase) => clase.dia_semana === dia)
            .map((clase) => ({
              codigo_pnf: clase.codigo_pnf,
              valor_seccion: clase.valor_seccion,
              valor_trayecto: clase.valor_trayecto,
              id: clase.id_horario,
              id_profesor: clase.id_profesor,
              id_aula: clase.id_aula,
              id_unidad_curricular: clase.id_unidad_curricular,
              codigo_aula: clase.codigo_aula,
              nombre_unidad_curricular: clase.nombre_unidad_curricular,
              hora_inicio: clase.hora_inicio,
              hora_fin: clase.hora_fin,
              id_seccion: clase.id_seccion,
              valor_seccion: clase.valor_seccion,
              nombre_pnf: clase.nombre_pnf,
            })),
        }));
      }
      // ‚úÖ Si no hay horarios reales, Horario ser√° un array vac√≠o []

      // Crear configuraci√≥n con nombres consistentes
      const configuracion = {
        profesor: { id_profesor, nombres_profesor, apellidos_profesor },
        turno: {
          nombre: "Completo",
          hora_inicio: "07:00",
          hora_fin: "20:00",
        },
        horario,
      };

      console.log("‚úÖ Configuraci√≥n formateada:", configuracion.horario);

      return FormatterResponseService.success(
        configuracion,
        "Horarios del profesor obtenidos exitosamente"
      );
    } catch (error) {
      // Si ya es un error formateado, lo propagamos
      if (error.success === false) {
        throw error;
      }
      // Si es un error crudo, lo formateamos
      return FormatterResponseService.error(
        "Error al obtener horarios del profesor",
        error.message,
        500,
        "HORARIO_PROFESOR_ERROR"
      );
    }
  }

  /**
   * Mostrar los horarios de una secci√≥n en espec√≠fico
   * @param {number} id_seccion
   * @returns {Object} Respuesta formateada con los horarios de la secci√≥n
   */
  static async mostrarHorariosPorSeccion(id_seccion) {
    try {
      const validation = validationService.validateId(id_seccion, "secci√≥n");
      if (!validation.isValid) {
        return FormatterResponseService.validationError(
          validation.errors,
          "ID de secci√≥n inv√°lido"
        );
      }

      const dbResponse = await HorarioModel.obtenerPorSeccion(id_seccion);

      if (dbResponse &amp;&amp; dbResponse.state === "error") {
        return FormatterResponseService.fromDatabaseResponse(dbResponse);
      }

      console.log("üìä Respuesta de la base de datos:", dbResponse);

      const rows = dbResponse.data || dbResponse;

      // Validar que hay datos
      if (!rows || rows.length === 0) {
        return FormatterResponseService.notFound("Secci√≥n", id_seccion);
      }

      // Usar los nombres correctos de las columnas seg√∫n tu consulta SQL
      const {
        id_pnf,
        nombre_pnf,
        codigo_pnf,
        valor_trayecto,
        id_trayecto,
        valor_seccion,
        nombre_turno,
        turno_hora_inicio,
        turno_hora_fin,
      } = rows[0];

      // ‚úÖ CORREGIDO: Filtrar solo filas que tengan datos reales de horarios
      const filasConHorarios = rows.filter(
        (row) => row.nombre_unidad_curricular &amp;&amp; row.hora_inicio &amp;&amp; row.hora_fin
      );

      let horario = [];

      // ‚úÖ CORREGIDO: Solo procesar si hay horarios reales
      if (filasConHorarios.length > 0) {
        const diasUnicos = [
          ...new Set(filasConHorarios.map((d) => d.dia_semana)),
        ];

        // ‚úÖ CORREGIDO: Sintaxis del map corregida
        horario = diasUnicos.map((dia) => ({
          nombre: dia,
          clases: filasConHorarios
            .filter((clase) => clase.dia_semana === dia)
            .map((clase) => ({
              id: clase.id_horario,
              id_profesor: clase.id_profesor,
              id_aula: clase.id_aula,
              id_unidad_curricular: clase.id_unidad_curricular,
              nombre_profesor: clase.nombres_profesor,
              codigo_aula: clase.codigo_aula,
              apellido_profesor: clase.apellidos_profesor,
              nombre_unidad_curricular: clase.nombre_unidad_curricular,
              hora_inicio: clase.hora_inicio,
              hora_fin: clase.hora_fin,
              id_seccion: clase.id_seccion,
              valor_seccion: clase.valor_seccion,
              nombre_pnf: clase.nombre_pnf,
            })),
        }));
      }
      // ‚úÖ Si no hay horarios reales, horario ser√° un array vac√≠o []

      // Crear configuraci√≥n con nombres consistentes
      const configuracion = {
        pnf: { nombre_pnf, codigo_pnf, id_pnf },
        trayecto: { id_trayecto, valor_trayecto },
        seccion: { valor_seccion, id_seccion },
        turno: {
          nombre: nombre_turno,
          hora_inicio: turno_hora_inicio || "07:00",
          hora_fin: turno_hora_fin || "20:00",
        },
        horario, // ‚úÖ Ahora ser√° [] cuando no haya horarios
      };

      console.log("‚úÖ Configuraci√≥n formateada:", configuracion.horario);

      return FormatterResponseService.success(
        configuracion,
        "Horarios de la secci√≥n obtenidos exitosamente"
      );
    } catch (error) {
      if (error.success === false) {
        throw error;
      }
      return FormatterResponseService.error(
        "Error al obtener horarios de la secci√≥n",
        error.message,
        500,
        "HORARIO_SECCION_ERROR"
      );
    }
  }

  /**
   * Mostrar los horarios de un aula en espec√≠fico
   * @param {number} id_aula
   * @returns {Object} Respuesta formateada con los horarios del aula
   */
  static async mostrarHorariosPorAula(id_aula) {
    try {
      const validation = validationService.validateId(id_aula, "aula");
      if (!validation.isValid) {
        return FormatterResponseService.validationError(
          validation.errors,
          "ID de aula inv√°lido"
        );
      }

      const dbResponse = await HorarioModel.obtenerPorAula(id_aula);

      if (dbResponse &amp;&amp; dbResponse.state === "error") {
        return FormatterResponseService.fromDatabaseResponse(dbResponse);
      }

      const rows = dbResponse.data || dbResponse;
      // Validar que hay datos
      if (!rows || rows.length === 0) {
        return FormatterResponseService.notFound(
          "No hay Horarios del profesor",
          id_profesor
        );
      }

      // Usar los nombres correctos de las columnas seg√∫n tu consulta SQL
      const { codigo_aula } = rows[0];

      // ‚úÖ CORREGIDO: Filtrar solo filas que tengan datos reales de horarios
      const filasConHorarios = rows.filter(
        (row) => row.nombre_unidad_curricular &amp;&amp; row.hora_inicio &amp;&amp; row.hora_fin
      );

      let horario = [];

      // ‚úÖ CORREGIDO: Solo procesar si hay horarios reales
      if (filasConHorarios.length > 0) {
        const diasUnicos = [
          ...new Set(filasConHorarios.map((d) => d.dia_semana)),
        ];

        // ‚úÖ CORREGIDO: Sintaxis del map corregida
        horario = diasUnicos.map((dia) => ({
          nombre: dia,
          clases: filasConHorarios
            .filter((clase) => clase.dia_semana === dia)
            .map((clase) => ({
              codigo_pnf: clase.codigo_pnf,
              valor_seccion: clase.valor_seccion,
              valor_trayecto: clase.valor_trayecto,
              id: clase.id_horario,
              id_profesor: clase.id_profesor,
              id_unidad_curricular: clase.id_unidad_curricular,
              nombre_profesor: clase.nombres_profesor,
              apellido_profesor: clase.apellidos_profesor,
              nombre_unidad_curricular: clase.nombre_unidad_curricular,
              hora_inicio: clase.hora_inicio,
              hora_fin: clase.hora_fin,
              id_seccion: clase.id_seccion,
              valor_seccion: clase.valor_seccion,
              nombre_pnf: clase.nombre_pnf,
            })),
        }));
      }
      // ‚úÖ Si no hay horarios reales, Horario ser√° un array vac√≠o []

      // Crear configuraci√≥n con nombres consistentes
      const configuracion = {
        aula: { id_aula, codigo_aula },
        turno: {
          nombre: "Completo",
          hora_inicio: "07:00",
          hora_fin: "20:00",
        },
        horario,
      };

      console.log("‚úÖ Configuraci√≥n formateada:", configuracion.horario);

      return FormatterResponseService.success(
        configuracion,
        "Horarios del aula obtenidos exitosamente"
      );
    } catch (error) {
      if (error.success === false) {
        throw error;
      }
      return FormatterResponseService.error(
        "Error al obtener horarios del aula",
        error.message,
        500,
        "HORARIO_AULA_ERROR"
      );
    }
  }

  /**
   * Mostrar profesores disponibles seg√∫n horas necesarias
   * @param {number} id_seccion
   * @param {number} horas_necesarias
   * @param {number} id_unidad_curricular
   * @returns {Object} Respuesta formateada con profesores disponibles
   */
  static async mostrarProfesoresParaHorario(
    id_seccion,
    horas_necesarias,
    id_unidad_curricular = null,
    search = null
  ) {
    try {
      const validationidSeccion = validationService.validateId(
        id_seccion,
        "Id Seccion"
      );
      if (!validationidSeccion.isValid) {
        return FormatterResponseService.validationError(
          validationidSeccion.errors,
          "Id de la seccion inv√°lido"
        );
      }

      const validation = validationService.validateId(
        horas_necesarias,
        "horas necesarias"
      );
      if (!validation.isValid) {
        return FormatterResponseService.validationError(
          validation.errors,
          "Horas necesarias inv√°lidas"
        );
      }
      if (id_unidad_curricular != null) {
        const validationIdUnidad = validationService.validateId(
          id_unidad_curricular,
          "id unidad curricular"
        );
        if (!validationIdUnidad.isValid) {
          return FormatterResponseService.validationError(
            validationIdUnidad.errors,
            "Id de la unidad curricular inv√°lido"
          );
        }
      }

      const dbResponse = await HorarioModel.obtenerProfesoresDisponibles(
        id_seccion,
        horas_necesarias,
        id_unidad_curricular,
        search
      );

      if (dbResponse &amp;&amp; dbResponse.state === "error") {
        return FormatterResponseService.fromDatabaseResponse(dbResponse);
      }

      const rows = dbResponse.data || dbResponse;

      return FormatterResponseService.success(
        rows,
        "Profesores disponibles obtenidos exitosamente"
      );
    } catch (error) {
      if (error.success === false) {
        throw error;
      }
      return FormatterResponseService.error(
        "Error al obtener profesores disponibles",
        error.message,
        500,
        "PROFESORES_DISPONIBLES_ERROR"
      );
    }
  }

  /**
   * Mostrar profesores disponibles seg√∫n horas necesarias
   * @param {number} id_profesor
   * @returns {Object} Respuesta formateada con profesores disponibles
   */
  static async mostrarProfesorCambiarHorario(id_profesor) {
    try {
      const validationidSeccion = validationService.validateId(
        id_profesor,
        "Id de profesor"
      );
      if (!validationidSeccion.isValid) {
        return FormatterResponseService.validationError(
          validationidSeccion.errors,
          "Id del profesor inv√°lido"
        );
      }

      const dbResponse = await HorarioModel.mostrarProfesorCambiarHorario(
        id_profesor
      );

      if (dbResponse &amp;&amp; dbResponse.state === "error") {
        return FormatterResponseService.fromDatabaseResponse(dbResponse);
      }

      const rows = dbResponse.data || dbResponse;

      return FormatterResponseService.success(
        rows,
        "Profesores disponibles obtenidos exitosamente"
      );
    } catch (error) {
      if (error.success === false) {
        throw error;
      }
      return FormatterResponseService.error(
        "Error al obtener profesores disponibles",
        error.message,
        500,
        "PROFESORES_DISPONIBLES_ERROR"
      );
    }
  }

  /**
   * Mostrar profesores disponibles seg√∫n horas necesarias
   * @param {number} id_aula
   * @returns {Object} Respuesta formateada con profesores disponibles
   */
  static async mostrarAulaCambiarHorario(id_aula) {
    try {
      const validationidSeccion = validationService.validateId(
        id_aula,
        "Id del aula"
      );
      if (!validationidSeccion.isValid) {
        return FormatterResponseService.validationError(
          validationidSeccion.errors,
          "Id del aula inv√°lido"
        );
      }

      const dbResponse = await HorarioModel.mostrarAulaCambiarHorario(id_aula);

      if (dbResponse &amp;&amp; dbResponse.state === "error") {
        return FormatterResponseService.fromDatabaseResponse(dbResponse);
      }

      const rows = dbResponse.data || dbResponse;

      return FormatterResponseService.success(
        rows,
        "Profesores disponibles obtenidos exitosamente"
      );
    } catch (error) {
      if (error.success === false) {
        throw error;
      }
      return FormatterResponseService.error(
        "Error al obtener profesores disponibles",
        error.message,
        500,
        "PROFESORES_DISPONIBLES_ERROR"
      );
    }
  }

  /**
   * Mostrar aulas disponibles para una seccion y un profesor
   * @param {number} id_seccion - id de la seccion
   * @param {number} id_profesor - id del profesor
   * @param {number} horas_necesarias - horas necesarias
   * @param {number} id_unidad_curricular - id de la unidad curricular (opcional)
   * @param {string} busqueda_aula - t√©rmino de b√∫squeda (opcional)
   * @returns {Object} Respuesta formateada con aulas disponibles
   */
  static async mostrarAulasParaHorario(
    id_seccion,
    id_profesor,
    horas_necesarias,
    id_unidad_curricular = null,
    busqueda_aula = null
  ) {
    try {
      console.log("üéØ Servicio: Buscando aulas disponibles", {
        id_seccion,
        id_profesor,
        horas_necesarias,
        id_unidad_curricular,
        busqueda_aula,
      });

      // Validaciones
      const validationidSeccion = validationService.validateId(
        id_seccion,
        "id seccion"
      );
      if (!validationidSeccion.isValid) {
        return FormatterResponseService.validationError(
          validationidSeccion.errors,
          "Id de la seccion inv√°lido"
        );
      }

      const validationidProfesor = validationService.validateId(
        id_profesor,
        "id profesor"
      );
      if (!validationidProfesor.isValid) {
        return FormatterResponseService.validationError(
          validationidProfesor.errors,
          "Id del profesor inv√°lido"
        );
      }

      const validationHoras = validationService.validateId(
        horas_necesarias,
        "horas necesarias"
      );
      if (!validationHoras.isValid) {
        return FormatterResponseService.validationError(
          validationHoras.errors,
          "Horas necesarias inv√°lidas"
        );
      }

      // ‚úÖ LLAMADA CORREGIDA: Orden correcto que coincide con el modelo
      const dbResponse = await HorarioModel.obtenerAulasDisponibles(
        id_seccion, // 1ro: id_seccion
        horas_necesarias, // 2do: horas_necesarias
        id_profesor, // 3ro: id_profesor
        id_unidad_curricular, // 4to: opcional
        busqueda_aula // 5to: opcional
      );

      console.log("üì• Respuesta del modelo:", dbResponse);

      if (dbResponse &amp;&amp; dbResponse.state === "error") {
        return FormatterResponseService.fromDatabaseResponse(dbResponse);
      }

      const rows = dbResponse.data || dbResponse;

      return FormatterResponseService.success(
        rows,
        "Aulas disponibles obtenidas exitosamente"
      );
    } catch (error) {
      console.error("üí• Error en servicio aulas:", error);
      if (error.success === false) {
        throw error;
      }
      return FormatterResponseService.error(
        "Error al obtener aulas disponibles",
        error.message,
        500,
        "AULAS_DISPONIBLES_ERROR"
      );
    }
  }

  /**
   * Registrar un nuevo horario
   * @param {object} datos
   * @param {object} usuario_accion
   * @returns {Object} Respuesta formateada del registro
   */
  static async registrarHorario(datos, usuario_accion) {
    try {
      const userValidation = validationService.validateId(
        usuario_accion.id,
        "usuario"
      );
      if (!userValidation.isValid) {
        return FormatterResponseService.validationError(
          userValidation.errors,
          "ID de usuario inv√°lido"
        );
      }

      const horarioValidation = validationService.validateHorario(datos);
      if (!horarioValidation.isValid) {
        return FormatterResponseService.validationError(
          horarioValidation.errors,
          "Error de validaci√≥n en datos del horario"
        );
      }

      const dbResponse = await HorarioModel.crear(datos, usuario_accion.id);

      if (dbResponse &amp;&amp; dbResponse.state === "error") {
        return FormatterResponseService.fromDatabaseResponse(dbResponse);
      }

      const resultado = dbResponse.data || dbResponse;

      // Enviar notificaciones espec√≠ficas a los involucrados
      console.log("üîî Enviando notificaciones de horario...");
      const notificationService = new NotificationService();

      const id_profesor = await HorarioModel.obtenerIdUSerProfesor(
        datos.id_profesor
      );

      // Notificaci√≥n individual para el PROFESOR asignado
      await notificationService.crearNotificacionIndividual({
        titulo: "Nueva Asignaci√≥n de Horario",
        tipo: "horario_asignado",
        user_id: id_profesor.data[0].id, // El profesor que recibe el horario
        contenido: `Se le ha asignado un nuevo horario para la unidad curricular "${
          datos.nombre_unidad_curricular || "N/A"
        }" en el aula ${datos.codigo_aula || "N/A"}`,
        metadatos: {
          horario_id: resultado.id_horario || resultado.id,
          profesor_id: datos.id_profesor,
          unidad_curricular: datos.nombre_unidad_curricular,
          aula: datos.codigo_aula,
          dia_semana: datos.dia_semana,
          hora_inicio: datos.hora_inicio,
          hora_fin: datos.hora_fin,
          usuario_asignador: usuario_accion.id,
          fecha_asignacion: new Date().toISOString(),
          url_action: `/horarios/profesor/${datos.id_profesor}`,
        },
      });

      // Notificaci√≥n para COORDINADORES y DIRECTORES relacionados
      await notificationService.crearNotificacionMasiva({
        titulo: "Nuevo Horario Registrado",
        tipo: "horario_creado",
        contenido: `Se ha registrado un nuevo horario para el profesor en el aula ${
          datos.codigo_aula || "N/A"
        }`,
        metadatos: {
          horario_id: resultado.id_horario || resultado.id,
          profesor_id: datos.id_profesor,
          profesor_nombre: datos.nombres_profesor || "Profesor",
          unidad_curricular: datos.nombre_unidad_curricular,
          aula: datos.codigo_aula,
          dia_semana: datos.dia_semana,
          hora_inicio: datos.hora_inicio,
          hora_fin: datos.hora_fin,
          usuario_creador: usuario_accion.id,
          fecha_registro: new Date().toISOString(),
          url_action: `/horarios/gestion`,
        },
        roles_ids: [2, 7, 8, 20], // Solo Coordinador, Directores y SuperAdmin
        users_ids: [usuario_accion.id], // Usuario que cre√≥ el horario
      });

      return FormatterResponseService.created(
        resultado,
        "Horario registrado exitosamente"
      );
    } catch (error) {
      if (error.success === false) {
        throw error;
      }
      return FormatterResponseService.error(
        "Error al registrar horario",
        error.message,
        error.status,
        "REGISTRO_HORARIO_ERROR"
      );
    }
  }

  /**
   * Generar documento PDF del horario de una secci√≥n
   * @param {number} id_seccion
   * @param {object} usuario_accion - Usuario que genera el documento
   * @returns {Object} Respuesta formateada con el buffer del PDF
   */
  static async generarDocumentoHorario(id_seccion, usuario_accion) {
    try {
      const validation = validationService.validateId(id_seccion, "secci√≥n");
      if (!validation.isValid) {
        return FormatterResponseService.validationError(
          validation.errors,
          "ID de secci√≥n inv√°lido"
        );
      }

      console.log("üì• Generando documento para la secci√≥n:", id_seccion);

      // 1Ô∏è‚É£ Obtener datos desde el modelo
      const response = await this.mostrarHorariosPorSeccion(id_seccion);

      if (FormatterResponseService.isError(response)) {
        return response;
      }

      const { data } = response;
      console.log("üìä Datos obtenidos para el documento:", data);

      // 4Ô∏è Generar documento
      const { buffer, extension } =
        await DocumentServices.generarDocumentoHorario(data);

      return FormatterResponseService.success(
        {
          buffer,
          fileName: `Horario: ${data.pnf.nombre_pnf.toLowerCase()}-${
            data.trayecto.valor_trayecto
          }-${data.seccion.valor_seccion}.${extension}`,
        },
        "Documento de horario generado exitosamente"
      );
    } catch (error) {
      console.error("‚ùå Error en HorarioService:", error);

      if (error.success === false) {
        throw error;
      }

      return FormatterResponseService.error(
        "Error al generar documento del horario",
        error.message,
        500,
        "GENERAR_DOCUMENTO_ERROR"
      );
    }
  }

  /**
   * Actualizar un horario existente
   * @param {number} idHorario
   * @param {object} datos
   * @param {object} usuario_accion
   * @returns {Object} Respuesta formateada de la actualizaci√≥n
   */
  static async actualizarHorario(idHorario, datos, usuario_accion) {
    try {
      const userValidation = validationService.validateId(
        usuario_accion.id,
        "usuario"
      );
      if (!userValidation.isValid) {
        return FormatterResponseService.validationError(
          userValidation.errors,
          "ID de usuario inv√°lido"
        );
      }

      const horarioIdValidation = validationService.validateId(
        idHorario,
        "horario"
      );
      if (!horarioIdValidation.isValid) {
        return FormatterResponseService.validationError(
          horarioIdValidation.errors,
          "ID de horario inv√°lido"
        );
      }

      const horarioValidation = validationService.validatePartialHorario(datos);
      if (!horarioValidation.isValid) {
        return FormatterResponseService.validationError(
          horarioValidation.errors,
          "Error de validaci√≥n en datos del horario"
        );
      }

      const dbResponse = await HorarioModel.actualizar(
        idHorario,
        datos,
        usuario_accion.id
      );

      if (dbResponse &amp;&amp; dbResponse.state === "error") {
        return FormatterResponseService.fromDatabaseResponse(dbResponse);
      }

      const resultado = dbResponse.data || dbResponse;

      // Enviar notificaciones espec√≠ficas por actualizaci√≥n de horario
      console.log("üîî Enviando notificaciones de actualizaci√≥n de horario...");
      const notificationService = new NotificationService();

      // Obtener informaci√≥n del horario actualizado para notificar al profesor
      const horarioInfo = await HorarioModel.obtenerPorId(idHorario);
      const id_profesor = await HorarioModel.obtenerIdUSerProfesor(
        datos.id_profesor
      );

      if (horarioInfo &amp;&amp; horarioInfo.data &amp;&amp; horarioInfo.data.length > 0) {
        const horario = horarioInfo.data[0];

        // Notificaci√≥n individual para el PROFESOR afectado
        await notificationService.crearNotificacionIndividual({
          titulo: "Horario Actualizado",
          tipo: "horario_actualizado",
          user_id: id_profesor.data[0].id,
          contenido: `Se han realizado modificaciones en su horario asignado. Verifique los cambios realizados.`,
          metadatos: {
            horario_id: idHorario,
            profesor_id: horario.id_profesor,
            campos_actualizados: Object.keys(datos),
            usuario_actualizador: usuario_accion.id,
            fecha_actualizacion: new Date().toISOString(),
            url_action: `/horarios/profesor/${horario.id_profesor}`,
          },
        });
      }

      // Notificaci√≥n para coordinadores/directores
      await notificationService.crearNotificacionMasiva({
        titulo: "Horario Actualizado",
        tipo: "horario_modificado",
        contenido: `Se han realizado cambios en el horario ID: ${idHorario}`,
        metadatos: {
          horario_id: idHorario,
          campos_actualizados: Object.keys(datos),
          usuario_actualizador: usuario_accion.id,
          fecha_actualizacion: new Date().toISOString(),
          url_action: `/horarios/gestion`,
        },
        roles_ids: [2, 7, 8, 20], // Solo Coordinador, Directores y SuperAdmin
        users_ids: [usuario_accion.id],
      });

      return FormatterResponseService.success(
        resultado,
        "Horario actualizado exitosamente"
      );
    } catch (error) {
      if (error.success === false) {
        throw error;
      }
      return FormatterResponseService.error(
        "Error al actualizar horario",
        error.message,
        error.status,
        "ACTUALIZAR_HORARIO_ERROR"
      );
    }
  }

  /**
   * Eliminar un horario
   * @param {number} idHorario
   * @param {object} usuario_accion
   * @returns {Object} Respuesta formateada de la eliminaci√≥n
   */
  static async eliminarHorario(idHorario, usuario_accion) {
    try {
      console.log("üö® Iniciando proceso de eliminaci√≥n de horario:", idHorario);
      const userValidation = validationService.validateId(
        usuario_accion.id,
        "usuario"
      );
      if (!userValidation.isValid) {
        return FormatterResponseService.validationError(
          userValidation.errors,
          "ID de usuario inv√°lido"
        );
      }

      const horarioValidation = validationService.validateId(
        idHorario,
        "horario"
      );
      if (!horarioValidation.isValid) {
        return FormatterResponseService.validationError(
          horarioValidation.errors,
          "ID de horario inv√°lido"
        );
      }

      // Obtener informaci√≥n del horario antes de eliminarlo para notificar
      const horarioInfo = await HorarioModel.obtenerPorId(idHorario);
      if (!horarioInfo || !horarioInfo.data || horarioInfo.data.length === 0) {
        return FormatterResponseService.notFound("Horario", idHorario);
      }

      const horario = horarioInfo.data[0];

      const dbResponse = await HorarioModel.eliminar(
        idHorario,
        usuario_accion.id
      );

      if (dbResponse &amp;&amp; dbResponse.state === "error") {
        return FormatterResponseService.fromDatabaseResponse(dbResponse);
      }

      // Enviar notificaciones espec√≠ficas por eliminaci√≥n de horario
      console.log("üîî Enviando notificaciones de eliminaci√≥n de horario...");
      const notificationService = new NotificationService();

      const id_profesor = await HorarioModel.obtenerIdUSerProfesor(
        horario.id_profesor
      );

      // Notificaci√≥n individual para el PROFESOR afectado
      await notificationService.crearNotificacionIndividual({
        titulo: "Horario Eliminado",
        tipo: "horario_eliminado",
        user_id: id_profesor.data[0].id,
        contenido: `Se ha eliminado su horario asignado para ${horario.nombre_unidad_curricular} en el aula ${horario.codigo_aula}`,
        metadatos: {
          horario_id: idHorario,
          profesor_id: horario.id_profesor,
          unidad_curricular: horario.nombre_unidad_curricular,
          aula: horario.codigo_aula,
          dia_semana: horario.dia_semana,
          usuario_eliminador: usuario_accion.id,
          fecha_eliminacion: new Date().toISOString(),
        },
      });

      // Notificaci√≥n para coordinadores/directores
      await notificationService.crearNotificacionMasiva({
        titulo: "Horario Eliminado",
        tipo: "horario_eliminado_admin",
        contenido: `Se ha eliminado el horario del profesor ${horario.nombres_profesor} ${horario.apellidos_profesor}`,
        metadatos: {
          horario_id: idHorario,
          profesor_id: horario.id_profesor,
          profesor_nombre: `${horario.nombres_profesor} ${horario.apellidos_profesor}`,
          unidad_curricular: horario.nombre_unidad_curricular,
          aula: horario.codigo_aula,
          usuario_eliminador: usuario_accion.id,
          fecha_eliminacion: new Date().toISOString(),
          url_action: `/horarios/gestion`,
        },
        roles_ids: [2, 7, 8, 20], // Solo Coordinador, Directores y SuperAdmin
        users_ids: [usuario_accion.id],
      });

      return FormatterResponseService.success(
        { horario_id: idHorario },
        "Horario eliminado exitosamente"
      );
    } catch (error) {
      if (error.success === false) {
        throw error;
      }
      return FormatterResponseService.error(
        "Error al eliminar horario",
        error.message,
        error.status,
        "ELIMINAR_HORARIO_ERROR"
      );
    }
  }
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.4</a> on Thu Dec 04 2025 12:35:39 GMT-0400 (hora de Venezuela) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
